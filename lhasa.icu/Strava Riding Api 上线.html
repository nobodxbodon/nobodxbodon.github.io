<h2><a href="https://github.com/achuanya/lhasa.github.io/blob/master/_posts/2025-04-10-StravaRidingApi.md">仓库源文</a>，<a href="https://lhasa.icu/StravaRidingApi">站点原文</a></h2>
<p>该脚本基于 Strava API v3 获取指定用户当年的所有骑行活动数据，并将其保存为JSON格式</p>
<h2>功能特性</h2>
<p>Strava Riding Api 只实现了 OAuth 2.0 授权流程的部分自动化，由于技术限制，目前无法实现完全自动化：</p>
<p>已实现部分</p>
<ul>
<li>半自动 OAuth 2.0 授权流程，轻松访问您的 Strava 数据</li>
<li>自动获取任意年份的所有骑行记录</li>
<li>获取每个活动的完整运动数据</li>
<li>智能令牌管理：自动保存和刷新过期的访问令牌</li>
<li>数据自动转换：公里、时间、速度单位等数据格式化</li>
<li>内置多重容错机制，确保数据获取的可靠性</li>
</ul>
<h2>使用前设置</h2>
<p><strong>重要：</strong> 在使用此脚本前，请确保在Strava开发者平台上正确配置您的应用：</p>
<ol>
<li>访问 <a href="https://www.strava.com/settings/api">Strava开发者设置</a></li>
<li>将以下URL添加到"授权回调域"：<pre><code>localhost
</code></pre>
注意：只需输入 <code>localhost</code> 而不是完整的 <code>http://localhost:8000</code></li>
<li>保存设置</li>
</ol>
<h2>使用方法</h2>
<ol>
<li><p>安装依赖：</p>
<pre><code>yarn install
</code></pre>
</li>
<li><p>获取并处理授权码：</p>
<pre><code>yarn auth
</code></pre>
<p>获取授权后，您会收到一个授权码。将其粘贴到命令行中。</p>
</li>
<li><p>获取骑行数据：</p>
<pre><code>yarn start
</code></pre>
</li>
<li><p>查看输出的JSON文件，文件名格式为：<code>strava_data.json</code></p>
</li>
</ol>
<h2>解决认证问题</h2>
<p>如果您遇到API相关错误，请尝试以下解决方案：</p>
<ol>
<li><p><strong>更新令牌</strong>：</p>
<pre><code>yarn auth
</code></pre>
<p>重新获取授权并更新令牌</p>
</li>
<li><p><strong>检查API状态</strong>：</p>
<p>访问 <a href="https://status.strava.com/">Strava API状态</a> 确认服务是否正常</p>
</li>
</ol>
<h2>常见问题解决</h2>
<ol>
<li><p><strong>"protocol mismatch"错误</strong>：</p>
<ul>
<li>此问题已在最新版本中解决，使用了原生HTTPS模块发送请求</li>
<li>确保在Strava开发者设置中添加了<code>localhost</code>作为授权回调域
&lt;br/&gt;&lt;br/&gt;</li>
</ul>
</li>
<li><p><strong>无法获取活动数据</strong>：</p>
<ul>
<li>确认您的账户中确实有骑行活动</li>
<li>检查筛选条件是否正确（默认只获取"Ride"类型活动）
&lt;br/&gt;&lt;br/&gt;</li>
</ul>
</li>
<li><p><strong>API错误或限流</strong>：</p>
<ul>
<li>Strava API有使用限制(每15分钟100次，每天1000次)</li>
<li>数据量大时，脚本已添加延迟以避免触发限流</li>
</ul>
</li>
</ol>
<h2>许可证</h2>
<p>本项目采用 Mozilla 公共许可证 2.0 版发布</p>
<p>Strava API v3：<a href="https://developers.strava.com/docs/reference">https://developers.strava.com/docs/reference</a></p>
<p>Strava Riding Api：<a href="https://github.com/achuanya/Strava-Riding-Api">https://github.com/achuanya/Strava-Riding-Api</a></p>
