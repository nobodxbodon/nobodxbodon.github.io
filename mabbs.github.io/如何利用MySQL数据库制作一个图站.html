<h2>åŸæ–‡ï¼š<a href="https://mabbs.github.io/2019/06/24/up">å¦‚ä½•åˆ©ç”¨MySQLæ•°æ®åº“åˆ¶ä½œä¸€ä¸ªå›¾ç«™</a></h2>
<hr/>
<h2>layout: post
title: å¦‚ä½•åˆ©ç”¨MySQLæ•°æ®åº“åˆ¶ä½œä¸€ä¸ªå›¾ç«™
tags: [MySQL, æ•°æ®åº“, å›¾ç«™, PHP]</h2>
<p>æœ€è¿‘ç™½å«–äº†ä¸€ä¸ª500GBçš„æ•°æ®åº“ï¼Œæƒ³æƒ³æ€ä¹ˆåˆ©ç”¨ä¸€ä¸‹ï¼Ÿ&lt;!--more--&gt;</p>
<h1>Talk is cheap,show me the code</h1>
<p>æ•°æ®åº“å»ºè¡¨ï¼š</p>
<pre><code class="language-sql">CREATE TABLE `FileUP` (
 `ID` int(11) NOT NULL AUTO_INCREMENT,
 `Name` text NOT NULL,
 `File` longblob NOT NULL,
 `Size` int(11) NOT NULL,
 PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=gb2312; 
</code></pre>
<p>PHPä»£ç ï¼š</p>
<pre><code class="language-php">&lt;?php
$con=mysqli_connect("æ•°æ®åº“åœ°å€","ç”¨æˆ·å","å¯†ç ","æ•°æ®åº“å"); 
if (mysqli_connect_errno($con)) 
{ 
    die("è¿æ¥ MySQL å¤±è´¥: " . mysqli_connect_error()); 
}

if ( $_GET[ID] != '' ) {
    header('Access-Control-Allow-Origin: *');
    $sql = "SELECT * FROM `FileUP` WHERE `ID` = '".addslashes($_GET[ID])."' ";
    $result = $con-&gt;query($sql);
    if ($result-&gt;num_rows &gt; 0) {
        while($row = $result-&gt;fetch_assoc()){ 
         Header ( "Content-type: application/octet-stream" ); 
         Header ( "Accept-Ranges: bytes" ); 
         Header ( "Accept-Length: " . $row["Size"] ); 
         Header ( "Content-Disposition: attachment; filename=" . $row["Name"] );
        echo $row["File"];
    }
} 
    else {
 header('HTTP/1.1 404 NOT FOUND'); 
}
} else {
echo '&lt;title&gt;Mayxå›¾åºŠ&lt;/title&gt;
&lt;h1&gt;Mayxå›¾åºŠ&lt;/h1&gt;&lt;hr&gt;
è¯·é€‰æ‹©éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶
&lt;form enctype="multipart/form-data" method="post" action=""&gt;
  &lt;input type="file" name="File" /&gt;
  &lt;input type="submit" name="submit" value="submit" /&gt;
&lt;/form&gt;
&lt;br /&gt;';
if ( $_SERVER['REQUEST_METHOD'] == "POST" ) {
 $error = $_FILES['File']['error'];
 $tmp_name = $_FILES['File']['tmp_name'];
 $size = $_FILES['File']['size'];
 $name = $_FILES['File']['name'];
 print("\n");
 if ($error == UPLOAD_ERR_OK &amp;&amp; $size &gt; 0) {
  $fp = fopen($tmp_name, 'r');
  $content = fread($fp, $size);
  fclose($fp);  
  $content = addslashes($content);
  $sql = "INSERT INTO `FileUP` (`Name`, `File`, `Size`)
 VALUES ('".$name."', '".$content."', '".$size."');";
  $con-&gt;query($sql);
  $sql = "select @@identity;";
  $result = $con-&gt;query($sql);
while($row = $result-&gt;fetch_assoc()) {
echo 'ä¸Šä¼ å®Œæˆï¼Œæ–‡ä»¶ä¸‹è½½åœ°å€ï¼š&lt;a href="//'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']."?ID=".$row['@@identity'].'" &gt;'.$_SERVER['HTTP_X_FORWARDED_PROTO'].'://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']."?ID=".$row['@@identity'].'&lt;/a&gt;';
}

 } else {
  echo "æ–‡ä»¶ä¸Šä¼ é”™è¯¯ï¼";
 }

}

echo '&lt;hr /&gt;
&lt;center&gt;&lt;a href="https://mabbs.github.io/"&gt;By Mayx&lt;/a&gt;&lt;/center&gt;';

}

mysqli_close($con);
</code></pre>
<h1>ç¼ºç‚¹</h1>
<p>~~MySQLä¿å­˜æ–‡ä»¶æœ‰é™åˆ¶ï¼Œå¥½åƒåªèƒ½å­˜16MBå·¦å³ğŸ˜“~~ï¼ˆæ”¹max_allowed_packetå°±å¯ä»¥äº†ï¼‰<br/>
å¦å¤–å°±æ˜¯æ–­ç‚¹ç»­ä¼ çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘å›å¤´å†æƒ³ä¸€æƒ³å§ã€‚</p>
<h1>æ¼”ç¤ºï¼ˆéšæ—¶GGï¼‰</h1>
<p><a href="https://mayx.leanapp.cn/up.php">https://mayx.leanapp.cn/up.php</a></p>
<h1>ä¸‹ä¸€æ­¥æ”¹è¿›çš„æ‰“ç®—</h1>
<p>~~æƒ³ææˆåˆ‡ç‰‡ä¸Šä¼ ï¼Œè¿™æ ·å°±æ²¡æœ‰æ–‡ä»¶å¤§å°ä¸Šä¼ çš„é™åˆ¶äº†ã€‚<br/>
ä¸è¿‡è¿™ä¸ªå¥½åƒå¾—å‰ç«¯æ”¯æŒï¼Œå…ˆæ”¾ä¸ªé“¾æ¥åœ¨è¿™é‡Œå§ï¼š<a href="https://github.com/fex-team/webuploader">https://github.com/fex-team/webuploader</a>~~<br/>
ä¸æ‰“ç®—æ”¹è¿›äº†â€¦â€¦</p>
