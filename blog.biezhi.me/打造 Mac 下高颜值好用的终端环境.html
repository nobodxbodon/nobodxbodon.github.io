<h2><a href="https://github.com/biezhi/blog/blob/master/_posts/2018-11-06-build-a-beautiful-mac-terminal-environment.md">仓库源文</a>，<a href="https://blog.biezhi.me/2018/11/06/build-a-beautiful-mac-terminal-environment">站点原文</a></h2>
<hr/>
<h2>layout: post
title: 打造 Mac 下高颜值好用的终端环境
tags: ["命令行", "Mac"]</h2>
<p>如果你觉得当前的终端操作不符合你的气质，可以看看我今天来介绍的 Mac 终端利器，不过不会介绍太多细节操作。</p>
<p>![biezhi iterm]({{ "/public/images/2018/11/biezhi_iterm2.png" | prepend: site.cdnurl }} "biezhi")</p>
<p>&lt;!-- more --&gt;</p>
<h1>它们是谁？</h1>
<ul>
<li>iTerm2：号称 Mac 下最好的终端工具（嗯，我也这么认为，毕竟我不会别的了）</li>
<li>zsh：一款强大的终端工具，能帮助你更高效地编写和执行命令。</li>
</ul>
<h1>安装 iTerm2</h1>
<p>下面的安装我几乎都用 <a href="https://brew.sh/">brew</a>{:target="_blank"} 方式了，如果你还不懂什么是 brew 可以看看 <a href="http://zhailiange.com/2016/06/04/Homebrew/">这个</a>{:target="_blank"}。</p>
<p>所以下面我假设你已经安装了 <code>Homebrew</code>。</p>
<p>如果你从来没有运行过 <code>brew cask</code> 命令，可以先执行：</p>
<pre><code class="language-shell">brew tap caskroom/cask
</code></pre>
<blockquote>
<p>多执行也不会怀孕的，放心！</p>
</blockquote>
<p>然后开始安装 <code>iTerm2</code></p>
<pre><code class="language-shell">brew cask install iterm2
</code></pre>
<p>安装成功后在 Launchpad 中可以看到有一个新图标出现，打开 iTerm2。</p>
<h2>代码配色</h2>
<p>默认的界面还是略显丑陋的，我们来设置一下代码配色吧。</p>
<p>&lt;img src='{{ "/public/images/2018/11/open_settings.png" | prepend: site.cdnurl }}'  alt="iTerm2 设置" width="400px"/&gt;</p>
<p>先检查下终端颜色配置为 <code>xterm-256color</code>，位置在 <code>iTerm2 -&gt; Preferences -&gt; Profiles -&gt; Terminal</code>。</p>
<p>![iTerm2 终端颜色值]({{ "/public/images/2018/11/iterm_terminal_color.png" | prepend: site.cdnurl }} "iTerm2 终端颜色值")</p>
<p>然后就可以设置配色了，默认情况下 <code>iTerm2</code> 只有 7 种自带的配色，当然满足不了我们高颜值的需求了。有人就开源了一款叫 <a href="https://github.com/mbadolato/iTerm2-Color-Schemes">iTerm2-Color-Schemes</a>{:target="_blank"} 的配色合集，里面有各种经典、常用的配色方案，来使用 Git 下载到本地。</p>
<pre><code class="language-shell">mkdir ~/.iterm2 &amp;&amp; cd ~/.iterm2

git clone https://github.com/mbadolato/iTerm2-Color-Schemes
</code></pre>
<p>这里我创建了一个 <code>~/.iterm2</code> 的目录，放在别的目录都可以，它的目录结构是这样的：</p>
<pre><code class="language-shell"> ~/.iterm2/iTerm2-Color-Schemes $ ls -la
total 72
-rw-r--r--    1 biezhi  staff  34131 Nov  6 11:34 README.md
drwxr-xr-x  198 biezhi  staff   6336 Nov  6 11:34 Xresources
drwxr-xr-x    3 biezhi  staff     96 Nov  6 11:34 backgrounds
drwxr-xr-x  198 biezhi  staff   6336 Nov  6 11:34 konsole
drwxr-xr-x  198 biezhi  staff   6336 Nov  6 11:34 putty
drwxr-xr-x  198 biezhi  staff   6336 Nov  6 11:34 remmina
drwxr-xr-x  198 biezhi  staff   6336 Nov  6 11:34 schemes
drwxr-xr-x  200 biezhi  staff   6400 Nov  6 11:34 screenshots
drwxr-xr-x  180 biezhi  staff   5760 Nov  6 11:34 terminal
drwxr-xr-x  198 biezhi  staff   6336 Nov  6 11:34 terminator
drwxr-xr-x  199 biezhi  staff   6368 Nov  6 11:34 termite
drwxr-xr-x  162 biezhi  staff   5184 Nov  6 11:34 tilda
drwxr-xr-x   19 biezhi  staff    608 Nov  6 11:34 tools
drwxr-xr-x    3 biezhi  staff     96 Nov  6 11:34 xfce4terminal
drwxr-xr-x  198 biezhi  staff   6336 Nov  6 11:34 xrdb
</code></pre>
<p>下面需要导入配色方案。</p>
<p>![导入配色方案]({{ "/public/images/2018/11/import_color_schemes.png" | prepend: site.cdnurl }} "导入配色方案")</p>
<p>![导入配色方案]({{ "/public/images/2018/11/choose_color_schemes.png" | prepend: site.cdnurl }} "导入配色方案")</p>
<blockquote>
<p>选择 <code>schemes</code> 文件夹内的所有配色方案。</p>
</blockquote>
<p>导入成功后就可以选择一些流行的配色方案了。</p>
<p>![选择配色方案]({{ "/public/images/2018/11/select_color_scheme.png" | prepend: site.cdnurl }} "选择配色方案")</p>
<p>选择配色后再去你的 iTerm 里面看会发现，已经好看了那么一点。</p>
<h2>安装字体</h2>
<p>为什么要安装字体呢？我们电脑的字体其实是可以用的，但是想要图标的这种字体就没法儿了：</p>
<p>&lt;img src='{{ "/public/images/2018/11/hack_font.png" | prepend: site.cdnurl }}'  alt="iTerm2 设置" width="70%"/&gt;</p>
<p>而这些图标字体其实是非 <code>ASCII</code> 码字体，在 iTerm2 中可以进行配置，所以先要安装这个字体。这款字体叫 <a href="https://github.com/ryanoasis/nerd-fonts">nerd-fonts</a>{:target="_blank"}，它支持下面这么多种图标。</p>
<p>![nerd-fonts]({{ "/public/images/2018/11/sankey-glyphs-combined-diagram.svg" | prepend: site.cdnurl }} "nerd-fonts")</p>
<p>使用 brew 安装</p>
<pre><code class="language-shell">brew tap caskroom/fonts
brew cask install font-hack-nerd-font
</code></pre>
<blockquote>
<p>注意：安装的时候会去 Github 下载字体，如果你下载失败可能是被墙了。</p>
<p>那么可以通过 <code>https_proxy=127.0.0.1:1087 brew cask reinstall font-hack-nerd-font</code> 的方式安装，前提是你开启了代理。</p>
</blockquote>
<p>安装成功后需要在 iTerm2 中配置一下，在 <code>iTerm2 -&gt; Preferences -&gt; Profiles -&gt; Text -&gt; Font -&gt; Change Font</code> 栏位中，Text 下面勾选 <code>Use a different font for non-ASCII text</code>，然后在 <code>Non-ASCII font</code> 点击 <code>Change font</code> 修改：</p>
<p>![设置字体]({{ "/public/images/2018/11/settings_hack_font.png" | prepend: site.cdnurl }} "设置字体")</p>
<p>![选择字体]({{ "/public/images/2018/11/choose_font.png" | prepend: site.cdnurl }} "选择字体")</p>
<p>这里选择的字体是非 ASCII 码字符的字体，不要设置错了！选择好之后关闭即可。</p>
<h1>安装 zsh</h1>
<pre><code class="language-shell">brew install zsh
</code></pre>
<p>![安装 zsh]({{ "/public/images/2018/11/install_zsh.png" | prepend: site.cdnurl }} "安装 zsh")</p>
<p>默认的 shell 是 bash，需要修改为 zsh：</p>
<pre><code class="language-shell">sudo sh -c "echo $(which zsh) &gt;&gt; /etc/shells"
chsh -s $(which zsh)
</code></pre>
<p>修改时会提示你输入密码。</p>
<p>现在 zsh 安装完成了，安装虽简单，可配置麻烦啊，这你能忍吗？？当然不能！</p>
<p>于是，<a href="https://github.com/robbyrussell/oh-my-zsh">oh-my-zsh</a>{:target="_blank"} 出现了，有了它 zsh 配置起来就方便多了，来安装一下它。</p>
<pre><code class="language-shell">sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
</code></pre>
<p>![安装 oh-my-zsh]({{ "/public/images/2018/11/install_oh_my_zsh.png" | prepend: site.cdnurl }} "安装 oh-my-zsh")</p>
<p>安装好之后可以看到界面发生了一点点变化，同时会产生一个名为 <code>.zshrc</code> 的配置文件，在用户家目录下面，我们以后主要就是修改它了。</p>
<h1>配置主题</h1>
<p>上面看到界面发生变化是因为 <code>oh-my-zsh</code> 默认帮我们配置了一个终端主题，你可以打开 <code>~/.zshrc</code> 文件看看：</p>
<pre><code class="language-shell">ZSH_THEME="robbyrussell"
</code></pre>
<p>这些主题文件存储在 <code>~/.oh-my-zsh/themes</code> 目录下，你也可以使用其他的。</p>
<p>为了实现前面想要的酷炫的终端主题，有人写了一个名为 <a href="https://github.com/bhilburn/powerlevel9k">powerlevel9k</a>{:target="_blank"} 的高颜值主题。</p>
<p>![nerd-fonts]({{ "/public/images/2018/11/powerlevel9k.gif" | prepend: site.cdnurl }} "nerd-fonts")</p>
<p>看到这么骚的操作，赶紧来安装吧！先将主题下载到本地的主题目录中：</p>
<pre><code class="language-shell">git clone https://github.com/bhilburn/powerlevel9k.git ~/.oh-my-zsh/custom/themes/powerlevel9k
</code></pre>
<p>然后修改 <code>zsh</code> 主题配置：</p>
<pre><code class="language-shell">ZSH_THEME="powerlevel9k/powerlevel9k"
</code></pre>
<p>修改配置文件后一定要记得让配置生效，使用 <code>source</code> 命令：</p>
<pre><code class="language-shell">source ~/.zshrc
</code></pre>
<p>现在来看看终端变成什么样子了！</p>
<p>![powerlevel9k]({{ "/public/images/2018/11/powerlevel9k.png" | prepend: site.cdnurl }} "powerlevel9k")</p>
<blockquote>
<p>我这里 iTerm2 的代码配色选择的是：<strong>Dracula</strong></p>
</blockquote>
<p>如果你喜欢这个风格的话可以不用进行其他主题设置了，为了让它看起来简洁一点，我在 <code>.zshrc</code> 配置中又添加了几行：</p>
<pre><code class="language-shell">POWERLEVEL9K_MODE="nerdfont-complete"
# Customise the Powerlevel9k prompts
POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(ssh dir vcs newline status)
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=()
POWERLEVEL9K_PROMPT_ADD_NEWLINE=true
</code></pre>
<ul>
<li><code>POWERLEVEL9K_MODE</code>：设置 powerlevel9k 的字体是我们前面下载的</li>
<li><code>POWERLEVEL9K_LEFT_PROMPT_ELEMENTS</code>：将前面居右的几个元素放在左边了</li>
<li><code>POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS</code>：右边不放置任何元素（如果你喜欢在右边也可以加）</li>
<li><code>POWERLEVEL9K_PROMPT_ADD_NEWLINE</code>：在每个提示之前添加换行符</li>
</ul>
<p>现在它变成这样了</p>
<p>![simple powerlevel9k]({{ "/public/images/2018/11/simple_powerlevel9k.png" | prepend: site.cdnurl }} "simple powerlevel9k")</p>
<p>更详细的配置可以参考 <a href="https://github.com/bhilburn/powerlevel9k#prompt-customization">Prompt Customization</a>{:target="_blank"} 和 <a href="https://github.com/bhilburn/powerlevel9k/wiki/Stylizing-Your-Prompt">Stylizing Your Prompt</a>{:target="_blank"}。</p>
<h1>别名设置</h1>
<p>装好 zsh 之后顺手就添加一下我自己常用的别名：</p>
<pre><code class="language-shell">alias cls='clear'
alias ll='ls -l'
alias la='ls -a'
alias vi='vim'
alias ssr="http_proxy=http://127.0.0.1:1087 https_proxy=http://127.0.0.1:1087"
alias grep='grep --color=auto'
</code></pre>
<p>这样我们只需要输入较短的命令就可以干大事情了！当然这里你可以设置更多自己熟悉的一些操作，比如和编程语言相关的等等。</p>
<h1>zsh 插件推荐</h1>
<p>zsh 那些酷插件可多了去了，我只推荐几个我认为比较实用的。</p>
<h2>extract</h2>
<p>这个插件是用于解压的，解压各种包命令多可能会手误，用它只需要输入 <code>x biezhi.zip</code> 即可。</p>
<p>在 <code>.zshrc</code> 的 plugins 中添加 <code>extract</code> 配置即可，它支持解压 <a href="https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins/extract">这些</a>{:target="_blank"} 文件。</p>
<h2>autojump</h2>
<p>这个插件主要帮助我们记住目录，一键直达。只要你脑海里有目录的几个字母，然后使用 <code>j [你知道的]</code> 按下 tab 即可，不用 <code>cd cd cd</code> 慢慢找。举个栗子：</p>
<p>我使用 <code>cd</code> 进入了 <code>blog</code> 这个目录，还进入了 <code>gitmoji</code> 目录。</p>
<pre><code class="language-shell">cd workspace/projects/github/blog
</code></pre>
<p>如果用 <code>autojump</code> 的话，现在想进入 <code>blog</code> 目录只需要 <code>j blog</code> 即可，一般我们都会按下 <code>tab</code> 确定目录位置，当遇到多个类似的目录名的时候它会提示你输入数字进入。</p>
<p><strong>安装</strong></p>
<pre><code class="language-shell">brew install autojump
</code></pre>
<p>安装后添加到 <code>autojump</code> 到 <code>zsh</code> 的 插件配置（plugins）里，再追加一句命令：</p>
<pre><code class="language-shell">[[ -s $(brew --prefix)/etc/profile.d/autojump.sh ]] &amp;&amp; . $(brew --prefix)/etc/profile.d/autojump.sh
</code></pre>
<p>让配置文件生效即可。</p>
<h2>zsh-syntax-highlighting</h2>
<p>zsh-syntax-highlighting 用于高亮你的 zsh 可用命令，比如输入 <code>sleep</code>、<code>cat</code> 这些命令的时候就会高亮（功能上确实没啥乱用）。</p>
<pre><code class="language-shell">brew install zsh-syntax-highlighting
</code></pre>
<p>安装好就行了，不用在 plugins 中追加。</p>
<h2>zsh-autosuggestions</h2>
<p>这是一个神奇的终端自动提示插件，当你输入 <code>ps</code> 的时候它可能会出现 <code>ps -ef | grep helloworld</code>。是因为它会记住你曾经输入过的命令，当你再次输入前几个命令的时候帮你自动匹配，让你工作更高效。下面是一个演示：</p>
<p>&lt;script id="asciicast-37390" data-size="big" src="https://asciinema.org/a/37390.js" async&gt;&lt;/script&gt;</p>
<p>你可以直接使用 brew 安装</p>
<pre><code class="language-shell">brew install zsh-autosuggestions
</code></pre>
<h2>colors</h2>
<p><a href="https://github.com/athityakumar/colorls">colors</a>{:target="_blank"} 是一个 Ruby 实现的脚本，它可以配合 powerlevel9k 显示电脑上的文件图标（应该是通过后缀判断的），使用的效果如下：</p>
<p>![colors]({{ "/public/images/2018/11/colors.png" | prepend: site.cdnurl }} "colors")</p>
<p>安装后就可以使用了</p>
<pre><code class="language-shell">gem install colorls
</code></pre>
<h1>其他技巧</h1>
<ul>
<li>连续按两次 <code>tab</code> 会补全列表，补全项可以使用 <code>ctrl+n/p/f/b</code> 上下左右切换</li>
<li>输入目录名即可进入，不用 <code>cd</code> 了，输入 <code>..</code> 即可到上级目录，返回上次目录输入 <code>-</code></li>
<li>输入 <code>d</code> 即可看到目录列表</li>
<li>智能的命令纠错功能（需开启 <code>ENABLE_CORRECTION</code> 配置）</li>
</ul>
<h1>注意点</h1>
<p>这样配置后打开 VSCode 就变成这幅样子：</p>
<p>&lt;img src='{{ "/public/images/2018/11/vscode_font.png" | prepend: site.cdnurl }}'  alt="vscode 字体错误" width="450px"/&gt;</p>
<p>如何修复呢？只需要在 vscode 的配置文件中加入下面的配置：</p>
<pre><code class="language-vscode">"terminal.integrated.fontFamily": "Hack Nerd Font",
"terminal.integrated.fontSize": 14,
</code></pre>
<p>这样就会变成下面这个样子了。</p>
<p>&lt;img src='{{ "/public/images/2018/11/vscode_new_font.png" | prepend: site.cdnurl }}'  alt="修复 vscode 字体" width="450px"/&gt;</p>
