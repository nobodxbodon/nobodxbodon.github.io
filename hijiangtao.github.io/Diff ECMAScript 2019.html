<h2>åŸæ–‡ï¼š<a href="https://hijiangtao.github.io/2019/07/05/Diff-ECMAScript-2019">Diff ECMAScript 2019</a></h2>
<hr/>
<h2>title: Diff ECMAScript 2019
layout: post
thread: 227
date: 2019-07-05
author: Joe Jiang
categories: Document
tags: [2019, ECMAScript, JavaScript, è¯­è¨€ç‰¹æ€§]
excerpt: ECMAScriptÂ® 2019 å·²å®šç¨¿ï¼Œé€šè¿‡ ECMA å¯ä»¥æŸ¥çœ‹åˆ° ECMAScript ç¬¬åç‰ˆè¯­è¨€æ ‡å‡†çš„æ‰€æœ‰å†…å®¹ã€‚ç”±äºè¯¥è¯­è¨€äºå‡ å¹´å‰å¼€å§‹çš„å¹´æ›´èŠ‚å¥ï¼Œæ¯å¹´çš„å˜åŒ–å¹¶ä¸å¦‚å½“åˆ ES5 åˆ° ES6 çš„æ”¹åŠ¨å¤§ï¼Œäºæ˜¯æƒ³çŸ¥é“æ ‡å‡†æœ‰å“ªäº›æ”¹åŠ¨ï¼Œçœ‹çœ‹åœ¨ä»Šå¹´å‘å¸ƒæœŸå†…å®Œç»“çš„ææ¡ˆå€’æ˜¯æ›´æœ‰å¸®åŠ©äº›ã€‚</h2>
<p>ECMAScriptÂ® 2019 å·²å®šç¨¿ï¼Œé€šè¿‡ ECMA <a href="https://www.ecma-international.org/ecma-262/10.0/index.html">é“¾æ¥</a>å¯ä»¥æŸ¥çœ‹åˆ° ECMAScript ç¬¬åç‰ˆè¯­è¨€æ ‡å‡†çš„æ‰€æœ‰å†…å®¹ã€‚</p>
<p>ç”±äºè¯¥è¯­è¨€äºå‡ å¹´å‰å¼€å§‹çš„å¹´æ›´èŠ‚å¥ï¼Œæ¯å¹´çš„å˜åŒ–å¹¶ä¸å¦‚å½“åˆ ES5 åˆ° ES6 çš„æ”¹åŠ¨å¤§ï¼Œäºæ˜¯æƒ³çŸ¥é“æ ‡å‡†æœ‰å“ªäº›æ”¹åŠ¨ï¼Œçœ‹çœ‹åœ¨ä»Šå¹´å‘å¸ƒæœŸå†…å®Œç»“çš„<a href="https://github.com/tc39/proposals/blob/master/finished-proposals.md">ææ¡ˆ</a>å€’æ˜¯æ›´æœ‰å¸®åŠ©äº›ã€‚</p>
<p>| ææ¡ˆ                                                                 | ä½œè€…                                                 | ä¸»å¸­                                             | TC39 ä¼šè®®çºªè¦                          | é¢„æœŸå‘å¸ƒå¹´ä»½ |
| ------------------------------------------------------------------------ | ------------------------------------------------------ | ------------------------------------------------------- | ------------------------------------------- | ------------------------- |
| <a href="https://github.com/tc39/proposal-optional-catch-binding">Optional <code>catch</code> binding</a>                               | Michael Ficarra                                        | Michael Ficarra                                         | <a href="https://github.com/tc39/tc39-notes/blob/master/meetings/2018-05/may-22.md#conclusionresolution-7">May 2018</a>            | 2019                      |
| <a href="https://github.com/tc39/proposal-json-superset">JSON superset</a>                                           | Richard Gibson                                         | Mark Miller&lt;br /&gt;Mathias Bynens                         | <a href="https://github.com/tc39/tc39-notes/blob/master/meetings/2018-05/may-22.md#conclusionresolution-8">May 2018</a>             | 2019                      |
| <a href="https://github.com/tc39/proposal-Symbol-description"><code>Symbol.prototype.description</code></a>                     | Michael Ficarra                                        | Michael Ficarra                                         | <a href="https://github.com/rwaldron/tc39-notes/blob/master/meetings/2018-11/nov-27.md#conclusionresolution-12">November 2018</a>   | 2019                      |
| <a href="https://github.com/tc39/Function-prototype-toString-revision"><code>Function.prototype.toString</code> revision</a>             | Michael Ficarra                                        | Michael Ficarra                                         | <a href="https://github.com/rwaldron/tc39-notes/blob/master/meetings/2018-11/nov-27.md#conclusionresolution-13">November 2018</a>   | 2019                      |
| <a href="https://github.com/tc39/proposal-object-from-entries"><code>Object.fromEntries</code></a>                              | Darien Maillet Valentine                               | Jordan Harband&lt;br /&gt;Kevin Gibbons                       | <a href="https://github.com/tc39/tc39-notes/blob/master/meetings/2019-01/jan-29.md#objectfromentries-for-stage-4">January 2019</a>   | 2019                      |
| <a href="https://github.com/tc39/proposal-well-formed-stringify">Well-formed <code>JSON.stringify</code></a>                    | Richard Gibson                                         | Mathias Bynens                                          | <a href="https://github.com/tc39/tc39-notes/blob/master/meetings/2019-01/jan-29.md#well-formed-jsonstringify-for-stage-4">January 2019</a> | 2019                      |
| <a href="https://github.com/tc39/proposal-string-left-right-trim"><code>String.prototype.{trimStart,trimEnd}</code></a>                          | Sebastian MarkbÃ¥ge                                     | Sebastian MarkbÃ¥ge&lt;br /&gt;Mathias Bynens                  | <a href="https://github.com/tc39/tc39-notes/blob/master/meetings/2019-01/jan-29,md#stringprototypetrimstarttrimend-for-stage-4">January 2019</a>                 | 2019                      |
| <a href="https://github.com/tc39/proposal-flatMap"><code>Array.prototype.{flat,flatMap}</code></a>                                 | Brian Terlson&lt;br /&gt;Michael Ficarra&lt;br /&gt;Mathias Bynens | Brian Terlson&lt;br /&gt;Michael Ficarra                      | <a href="https://github.com/tc39/tc39-notes/blob/master/meetings/2019-01/jan-29.md#arrayprototypeflatflatmap-for-stage-4">January 2019</a>                  | 2019                      |</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€ä¸€ç»†è¯»ã€‚å…¶ä¸­ï¼Œéƒ¨åˆ†æ–°ç‰¹æ€§æˆ‘åœ¨<a href="/2018/11/24/Write-JavaScript-in-2018/">èµ¶ä¸Š ECMAScript æ½®æµï¼šç”¨ç°ä»£ JavaScript ç¼–ç¨‹</a>ä¸€æ–‡ä¸­å·²ç»™å‡ºè¯¦ä¾‹è§£é‡Šï¼Œæ•…æ­¤å¤„é’ˆå¯¹å‰©ä½™å…­ä¸ªææ¡ˆ/ç‰¹æ€§è¿›è¡Œä»‹ç»ã€‚</p>
<h2>1. JSON superset</h2>
<p>ä»€ä¹ˆæ˜¯ JSON è¶…é›†ï¼Ÿè¿˜è®°å¾— <code>âŠ‚</code> è¿™ä¸ªç¬¦å·çš„å¯ä»¥è¿™æ ·è§£é‡Šè¯¥ææ¡ˆ <code>JSON âŠ‚ ECMAScript</code>ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯è®© ECMAScript å…¼å®¹æ‰€æœ‰ JSON æ”¯æŒçš„æ–‡æœ¬ã€‚ECMAScript æ›¾åœ¨æ ‡å‡† <a href="https://tc39.github.io/ecma262/#sec-json.parse">JSON.parse</a> éƒ¨åˆ†é˜æ˜ JSON ç¡®ä¸ºå…¶ä¸€ä¸ªå­é›†ï¼Œä½†ç”±äº JSON å†…å®¹å¯ä»¥æ­£å¸¸åŒ…å« <code>U+2028</code> è¡Œåˆ†éš”ç¬¦ä¸ <code>U+2029</code> æ®µè½åˆ†éš”ç¬¦è€Œ ECMAScript å´ä¸è¡Œã€‚</p>
<p>è¯¥è‰æ¡ˆæ—¨åœ¨è§£å†³è¿™ä¸€é—®é¢˜ã€‚åœ¨è¿™ä¹‹å‰ï¼Œå¦‚æœä½ ä½¿ç”¨ <code>JSON.parse()</code> æ‰§è¡Œå¸¦å¦‚ä¸Šç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²æ—¶ï¼Œåªä¼šæ”¶åˆ° <code>SyntaxError</code> çš„é”™è¯¯æç¤ºã€‚è¯¥è‰æ¡ˆåŒæ ·æ˜¯å‘åå…¼å®¹çš„ï¼Œå…¶å¯¹ç”¨æˆ·å”¯ä¸€çš„å½±å“æ˜¯ä¿æŒåŸæ ·ï¼Œå³åœ¨æš‚ä¸æ”¯æŒç‰¹æ®Šå­—ç¬¦è§£æçš„è¿è¡Œç¯å¢ƒä¸­ä¿æŒ <code>SyntaxError</code> çš„æŠ¥é”™ã€‚</p>
<h2>2. <code>Symbol.prototype.description</code></h2>
<p>ECMAScript åœ¨è¯¥<a href="https://tc39.es/proposal-Symbol-description/">ææ¡ˆ</a>ä¸­è§„å®šï¼Œ<code>Symbol.prototype.description </code> æ˜¯ä¸€ä¸ªè®¿é—®å™¨å±æ€§ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒè·å– Symbol å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨è¿°ï¼Œè€Œåœ¨æ­¤ä¹‹å‰ï¼Œä½ å¿…é¡»é€šè¿‡è°ƒç”¨ <code>Symbol.prototype.toString</code> æ–¹æ³•è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­ç†Ÿæ‚‰ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">const testSymbol = Symbol('Test')
testSymbol.description // 'Test'

Symbol("foo") + "bar";      
// TypeError: Can't convert symbol to string

Symbol("foo").toString() + "bar"
// "Symbol(foo)bar"
</code></pre>
<h2>3. <code>Function.prototype.toString</code></h2>
<p>è¿™æ˜¯ä¸€ä¸ªæ ¡è®¢ææ¡ˆï¼Œå†…å®¹å¾ˆé•¿è¯¦è§ <a href="https://tc39.es/Function-prototype-toString-revision/">https://tc39.es/Function-prototype-toString-revision/</a>ï¼Œä½†è§£é‡Šèµ·æ¥ç›¸å¯¹å®¹æ˜“ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œè°ƒç”¨ <code>Function</code> åŸå‹é“¾ä¸Šçš„ <code>toString()</code> æ–¹æ³•å¯ä»¥è¿”å›å‡½æ•°çš„æºç å­—ç¬¦ä¸²ï¼Œä½†æ˜¯åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œç©ºæ ¼ã€ä»£ç æ³¨é‡Šç­‰å†…å®¹ä¼šè¢«å»é™¤ã€‚</p>
<p>åœ¨æ ¡è®¢ä¸­ï¼Œè¿™äº›å†…å®¹å¾—ä»¥æ­£å¸¸è§£æä¿ç•™ï¼Œä½¿å¾—è°ƒç”¨ <code>toString()</code> æ–¹æ³•è·å¾—çš„ç»“æœä¸å‡½æ•°çš„å®é™…å®šä¹‰æ›´åŠ æ¥è¿‘ï¼Œæ¥çœ‹ä¸ªä¾‹å­åŠ æ·±å°è±¡ï¼š</p>
<pre><code class="language-js">function /* this is bar */ bar () {
  // Hello
  return 'Hello, bar!';
}

bar.toString()
// â†’ "function /* this is bar */ bar () {
// â†’   // Hello
// â†’   return 'Hello, bar!';
// â†’ }"
</code></pre>
<h2>4. <code>Object.fromEntries</code></h2>
<p>åœ¨ JavaScript æ“ä½œä¸­ï¼Œæ•°æ®åœ¨å„ç§æ•°æ®ç»“æ„ä¹‹é—´çš„è½¬æ¢éƒ½æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œæ¯”å¦‚ Map åˆ°æ•°ç»„ã€Map åˆ° Setã€å¯¹è±¡åˆ° Map ç­‰ç­‰ï¼š</p>
<pre><code class="language-js">const map = new Map().set('foo', true).set('bar', false);
const arr = Array.from(map);
const set = new Set(map.values());

const obj = { foo: true, bar: false };
const newMap = new Map(Object.entries(obj));
</code></pre>
<p>å…¶ä¸­ï¼Œ<code>Object.entries()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªç»™å®šå¯¹è±¡è‡ªèº«å¯æšä¸¾å±æ€§çš„é”®å€¼å¯¹æ•°ç»„ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">const obj = { foo: 'bar', baz: 42 };
console.log(Object.entries(obj)); // [ ['foo', 'bar'], ['baz', 42] ]
</code></pre>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªé”®å€¼å¯¹åˆ—è¡¨è½¬æ¢ä¸ºå¯¹è±¡ï¼Œç›¸å¯¹è¿˜æ˜¯å¾ˆéº»çƒ¦çš„ï¼š</p>
<pre><code class="language-js">const map = new Map().set('foo', true).set('bar', false);

const obj = Array.from(map).reduce((acc, [ key, val ]) =&gt; {
  return Object.assign(acc, { 
    [key]: val 
  });
}, {});
</code></pre>
<p>è¯¥ææ¡ˆçš„ç›®çš„åœ¨äºä¸ºå¯¹è±¡æ·»åŠ ä¸€ä¸ªæ–°çš„é™æ€æ–¹æ³• <code>Object.fromEntries</code>ï¼Œç”¨äºå°†ç¬¦åˆé”®å€¼å¯¹çš„åˆ—è¡¨ï¼ˆä¾‹å¦‚ Mapã€æ•°ç»„ç­‰ï¼‰è½¬æ¢ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä»¥ä¸Šè½¬æ¢æˆ‘ä»¬åªéœ€è¦ä¸€è¡Œä»£ç å³å¯æå®šï¼š</p>
<pre><code class="language-js">Object.fromEntries(map);
</code></pre>
<h2>5. <code>JSON.stringify</code></h2>
<p>å½“ä½ ä½¿ç”¨ <code>JSON.stringify</code> å¤„ç†ä¸€äº›æ— æ³•ç”¨ UTF-8 ç¼–ç è¡¨ç¤ºçš„å­—ç¬¦æ—¶ï¼ˆU+D800 è‡³ U+DFFFï¼‰ï¼Œæ›¾ç»è¿”å›çš„ç»“æœä¼šæ˜¯ä¸€ä¸ªä¹±ç  Unicode å­—ç¬¦ï¼Œå³â€œï¿½â€ã€‚è¯¥ææ¡ˆæå‡ºï¼Œç”¨ JSON è½¬ä¹‰åºåˆ—æ¥å®‰å…¨çš„è¡¨ç¤ºè¿™äº›ç‰¹æ®Šå­—ç¬¦ã€‚</p>
<p>æ­£å¸¸å­—ç¬¦çš„è¡¨ç¤ºä¸å˜ï¼š</p>
<pre><code class="language-js">JSON.stringify('ğŒ†')
// â†’ '"ğŒ†"'
JSON.stringify('\uD834\uDF06')
// â†’ '"ğŒ†"'
</code></pre>
<p>è€Œæ— æ³•ç”¨ UTF-8 ç¼–ç è¡¨ç¤ºçš„å­—ç¬¦ä¼šè¢«åºåˆ—åŒ–ä¸ºè½¬ç§»åºåˆ—ï¼š</p>
<pre><code class="language-js">JSON.stringify('\uDF06\uD834')
// â†’ '"\\udf06\\ud834"'
JSON.stringify('\uDEAD')
// â†’ '"\\udead"'
</code></pre>
<h2>6. <code>Array.prototype.{flat,flatMap}</code></h2>
<p>è¿™ä¸ªææ¡ˆæå‡ºäº†ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li><code>Array.prototype.flat</code> è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ä¸­æ‰€æœ‰å­æ•°ç»„å…ƒç´ ä¼šä»¥æŒ‡å®šçš„æ·±åº¦é€’å½’çš„è¿æ¥åˆ°ä¸€èµ·ï¼›</li>
<li><code>Array.prototype.flatMap</code> æ–¹æ³•é¦–å…ˆä¼šè°ƒç”¨æä¾›çš„å‡½æ•°æ‰§è¡Œä¸€æ¬¡ map() æ–¹æ³•ï¼Œç„¶åå†é€šè¿‡ç±»ä¼¼ flat æ–¹æ³•ã€Œæ‰“å¹³ã€æ•°ç»„ã€‚å®ƒç­‰ä»·äºæ‰§è¡Œå®Œ <code>map()</code> åå†æ‰§è¡Œä¸€æ¬¡ <code>flat()</code> æ–¹æ³•ï¼Œä½†å½“ä½ æ‰§è¡Œ <code>map()</code> æ—¶è¿”å›çš„ç»“æœå¦‚æœæ˜¯ä¸ªæ•°ç»„æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ˜¾å¾—é¢å¤–æœ‰ç”¨ä¸ç®€ä¾¿ï¼›</li>
</ul>
<p>æ¥çœ‹å‡ ä¸ªä¾‹å­è§£é‡Šä¸€ä¸‹ï¼Œé¦–å…ˆ <code>flat()</code> æ–¹æ³•æ”¯æŒä¸åŒæ·±åº¦çš„ã€Œæ‰“å¹³ã€ï¼Œå…¶ä¸­ â€œInfinityâ€ å¯ä»¥å°†æ‰€æœ‰æ·±åº¦æ‰“å¹³æˆä¸€çº§ï¼š</p>
<pre><code class="language-js">['Dog', ['Sheep', ['Wolf']]].flat()
//[ 'Dog', 'Sheep', [ 'Wolf' ] ]

['Dog', ['Sheep', ['Wolf']]].flat(2)
//[ 'Dog', 'Sheep', 'Wolf' ]

['Dog', ['Sheep', ['Wolf']]].flat(Infinity)
//[ 'Dog', 'Sheep', 'Wolf' ]
</code></pre>
<p>ç”¨å¦ä¸€ä¸ªä¾‹å­æ¥è§£é‡Š <code>flatMap()</code> æ–¹æ³•çš„ä¾¿åˆ©ä¹‹å¤„ï¼š</p>
<pre><code class="language-js">['My dog', 'is awesome'].map(words =&gt; words.split(' '))
//[ [ 'My', 'dog' ], [ 'is', 'awesome' ] ]

['My dog', 'is awesome'].flatMap(words =&gt; words.split(' '))
//[ 'My', 'dog', 'is', 'awesome' ]
</code></pre>
<h2>å‚è€ƒ</h2>
<ul>
<li><a href="https://github.com/tc39/proposals">https://github.com/tc39/proposals</a></li>
<li><a href="https://tc39.es/ecma262/">https://tc39.es/ecma262/</a></li>
</ul>
