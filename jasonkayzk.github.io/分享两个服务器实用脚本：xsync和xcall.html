<h2><a href="https://github.com/jasonkayzk/jasonkayzk.github.io/blob/master/source/_posts/分享两个服务器实用脚本：xsync和xcall.md">仓库源文</a>，<a href="https://jasonkayzk.github.io/2025/07/21/分享两个服务器实用脚本：xsync和xcall">站点原文</a></h2>
<p>如果同时需要维护多台服务器，可能会需要在多台服务器之间同步文件、执行命令。</p>
<p>本文介绍了两个简单的脚本实现这一功能！</p>
<p>源代码：</p>
<ul>
<li><a href="https://gist.github.com/JasonkayZK/e8bbe840d4b4d9d0ed15d4385e1c0a07">https://gist.github.com/JasonkayZK/e8bbe840d4b4d9d0ed15d4385e1c0a07</a></li>
<li><a href="https://gist.github.com/JasonkayZK/6847064a739bd08232e2da938d5e34ef">https://gist.github.com/JasonkayZK/6847064a739bd08232e2da938d5e34ef</a></li>
</ul>
<p>&lt;br/&gt;</p>
&lt;!--more--&gt;

<h1><strong>分享两个服务器实用脚本：xsync和xcall</strong></h1>
<h2><strong>文件同步：xsync</strong></h2>
<h3><strong>1、前置依赖</strong></h3>
<p>xsync 依赖于 rsync 工具，可以通过 yum 或者 apt 简单的安装：</p>
<pre><code class="lang-bash">apt或yum install -y rsync
</code></pre>
<p><strong>此外，还需要配置 SSH 无密码登录！</strong></p>
<p>&lt;br/&gt;</p>
<h3><strong>2、编写脚本</strong></h3>
<p>脚本内容：</p>
<p>xsync</p>
<pre><code class="lang-bash">#!/bin/bash
# Dependency:
#  1. rsync: yum/apt install -y rsync
#  2. password-less SSH login
#

# 0. Define server list
servers=("server-1" "server-2" "server-3")

# 1. check param num
if [ $# -lt 1 ]; then
  echo "Not Enough Arguement!"
  exit 1
fi

# 2. traverse all machines
for host in "${servers[@]}"; do
  echo "====================  $host  ===================="
  # 3. traverse dir for each file
  for file in "$@"; do
    # 4. check file exist
    if [ -e "$file" ]; then
      # 5. get parent dir
      pdir=$(cd -P "$(dirname "$file")" &amp;&amp; pwd)
      # 6. get file name
      fname=$(basename "$file")
      ssh "$host" "mkdir -p $pdir"
      rsync -av "$pdir/$fname" "$host:$pdir"
    else
      echo "$file does not exist!"
    fi
  done
done
</code></pre>
<blockquote><p><strong>使用时，上面的文件中 servers 数组中的配置，为你服务器集群！</strong></p>
</blockquote>
<p>&lt;br/&gt;</p>
<h3><strong>3、使用</strong></h3>
<p>增加可执行权限、并将文件放在 PATH 下；</p>
<p>然后直接使用，例如：</p>
<pre><code class="lang-bash">xsync ~/.bashrc
</code></pre>
<p>&lt;br/&gt;</p>
<h2><strong>命令执行：xcall</strong></h2>
<p>和 xsync 类似，编写：</p>
<p>xcall</p>
<pre><code class="lang-bash">#!/bin/bash
# Dependency: password-less SSH login
#

# Define server array (easily extensible)
servers=(
  "server-1"
  "server-2"
  "server-3"
)

# Check if command arguments are provided
if [ $# -eq 0 ]; then
  echo "Error: Please provide a command to execute" &gt;&amp;2
  exit 1
fi

# Execute command across all servers
for server in "${servers[@]}"; do
  echo "--------- $server ----------"

  # Execute remote command and handle errors
  if ssh "$server" "$*"; then
    echo "✓ Command executed successfully"
  else
    echo "✗ Command failed on server: $server" &gt;&amp;2
    # Uncomment below line to exit script on first failure
    # exit 1
  fi
done
</code></pre>
<p>使用也是类似：</p>
<p>增加可执行权限、并将文件放在 PATH 下；</p>
<p>然后直接使用，例如：</p>
<pre><code class="lang-bash">xcall ls
</code></pre>
<p>&lt;br/&gt;</p>
<h1><strong>附录</strong></h1>
<p>源代码：</p>
<ul>
<li><a href="https://gist.github.com/JasonkayZK/e8bbe840d4b4d9d0ed15d4385e1c0a07">https://gist.github.com/JasonkayZK/e8bbe840d4b4d9d0ed15d4385e1c0a07</a></li>
<li><a href="https://gist.github.com/JasonkayZK/6847064a739bd08232e2da938d5e34ef">https://gist.github.com/JasonkayZK/6847064a739bd08232e2da938d5e34ef</a></li>
</ul>
<p>&lt;br/&gt;</p>
