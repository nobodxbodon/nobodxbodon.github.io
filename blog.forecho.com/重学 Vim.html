<h2>原文：<a href="https://blog.forecho.com/re-study-vim.html">重学 Vim</a></h2>
<hr/>
<h2>title: "重学 Vim"
date: 2019-10-08T22:48:00+08:00
tags: ["vim"]
draft: false
toc: true</h2>
<h2>引言</h2>
<p>2013 年的时候我才开始接触 Vim，简单学了一下，也没用起来，后来只记得普通模式以及怎么进入插入模式，然后就是保存退出这几个命令了。</p>
<p>直到最近买了一个 HHKB 键盘以及发现使用 Vim 编码效率要高很多，所以我决定重拾 Vim，为了加强自己的记忆，于是我就整理了这篇文章。</p>
<p>&lt;!--more--&gt;</p>
<h2>模式</h2>
<p>这个是 Vim 区别普通编辑器的最大差别。Vim 有好几种模式，在不同的模式下可以干不同的事情。</p>
<h3>普通模式</h3>
<p>这个是 Vim 的默认模式，在这种模式下，你可以通过键盘移动光标，可以删除文字。</p>
<p><strong>方向键</strong></p>
<ul>
<li><code>h</code>：左 ←</li>
<li><code>j</code>：下 ↓</li>
<li><code>k</code>：上 ↑</li>
<li><code>l</code>：右 →</li>
</ul>
<p>这几个是最常用的方向键盘，怎么记呢？除了记住『<code>j</code> 长得有点像 ↓』之外就是勤加练习了。</p>
<p><strong>其他</strong></p>
<ul>
<li><code>w</code>：移动到下一个单词的开头</li>
<li><code>e</code>：移动到下一个单词的结尾</li>
<li><code>0</code>：移动到行首</li>
<li><code>$</code>：移动到行尾</li>
<li><code>b</code>：移动到上一个单词的开头</li>
<li><code>gg</code>：移动到文件的开头</li>
<li><code>G</code>：移动到文件的结尾</li>
<li><code>nG</code>：移动到第 n 行</li>
<li><code>dd</code>：删除当前行</li>
<li><code>d$</code> 或者 <code>D</code>：删除当前光标到行尾</li>
<li><code>d0</code>：删除当前光标到行首</li>
<li><code>yy</code>：剪切当前行</li>
<li><code>p</code>：粘贴内容到下一行</li>
<li><code>v$yjp</code>：选中光标到行尾内容，跳转下一行粘贴内容</li>
</ul>
<h3>插入模式</h3>
<p>专门用来插入文字的模式，你可以把其他编辑器的默认模式理解为 Vim 的插入模式。</p>
<p><strong>如何从普通模式进入插入模式？</strong></p>
<ul>
<li><code>i</code>：在光标之前插入（insert 插入）</li>
<li><code>a</code>：在光标之后插入（append 追加）</li>
<li><code>I</code>：在光标行行首插入</li>
<li><code>A</code>：在光标行行尾插入</li>
<li><code>o</code>：在光标行下面插入新一行并且保持插入模式</li>
<li><code>O</code>：在光标行上面插入新一行并且保持插入模式</li>
</ul>
<p>除了以上命令我们还可以使用 <code>c</code> 命令进入插入模式：</p>
<ul>
<li><code>cc</code>：删除当前行内容，并且进入插入模式</li>
<li><code>c$</code> 或者 <code>C</code>：删除当前光标到行尾，并且进入插入模式</li>
<li><code>cw</code>：从光标处删除到单词结尾并且进入插入模式</li>
<li><code>caw</code>：删除整个单词并且进入插入模式（即使你的光标在单词中间）</li>
</ul>
<p><strong>如何回到普通模式？</strong></p>
<p>按 <code>Esc</code> 键最方便。</p>
<h3>可视模式</h3>
<p>可以理解为选中模式，通过一些命令选中字符、行、块，再针对选中区域做操作。</p>
<p><strong>普通模式和可视模式可以这样互相切换</strong></p>
<ul>
<li><code>v</code>：切换面向字符的可视模式</li>
<li><code>V</code>：切换面向行的可视模式</li>
<li><code>Control</code> + <code>v</code>：切换面向块的可视模式（当你需要对几行字符做相同操作的时候，这种模式非常有用）</li>
</ul>
<p><strong>相关命令</strong></p>
<ul>
<li><code>gv</code>：进入上次可视模式状态</li>
<li><code>o</code>：切换选中区域的活动端（试一下 <code>vwwoe</code> 自己感受一下）</li>
</ul>
<p><strong>实际场景示例</strong></p>
<ul>
<li><code>vi'c</code>：从当前光标位置删除 <code>'</code> 之前的内容，并且进入插入模式</li>
<li><code>vi}</code>：选中 <code>{}</code> 之间的内容，同理 <code>}</code> 可以换成 <code>'</code>、<code>"</code>、<code>]</code> 等（i 可以立即为 inside）</li>
<li><code>va}</code>：选中 <code>{}</code> 以及其之间的内容，同理 <code>}</code> 可以换成 <code>'</code>、<code>"</code>、<code>]</code> 等（a 可以理解为 around）</li>
<li><code>vit</code>：选中两个标签之间的内容</li>
<li><code>viw</code>：选中当前字符</li>
<li><code>viW</code>：选中当前字串（字串含义见后面内容）</li>
</ul>
<p>更多可以参考下图，来源<a href="http://yyq123.blogspot.com/2016/12/vim-text-objects.html">《VIM 学习笔记 文本对象（Text Objects）》</a></p>
<p><img alt="" src="https://blog-1251237404.cos.ap-guangzhou.myqcloud.com/20191011095932.png"/></p>
<h3>命令行模式</h3>
<p>进入命令行模式之后我们可以执行一些命令对文本进行操作。</p>
<p><strong>进入命令行模式</strong></p>
<ul>
<li><code>:</code>：进入命令行模式</li>
<li><code>/</code>：向下进行搜索，按 <code>n</code> 跳转到下一个，按 <code>N</code> 跳转到上一个</li>
<li><code>?</code>：向上进行搜索，按 <code>n</code> 跳转到下一个，按 <code>N</code> 跳转到上一个</li>
</ul>
<p><strong>一些常用的命令</strong></p>
<ul>
<li><code>:x</code>：保存并且退出</li>
<li><code>:wq</code>：保存并且退出</li>
<li><code>:w</code>：保存</li>
<li><code>:q</code>：退出</li>
<li><code>:0</code>：跳转到文件头，0 代表行号</li>
<li><code>:t</code>：复制，把一行或者多行复制到指定位置</li>
<li><code>:m</code>：移动，在用法上和复制类似</li>
</ul>
<p><strong>一些示例</strong></p>
<ul>
<li><code>:2,3t.</code>：把第 2 和 3 行的内容复制到当前光标行下方</li>
<li><code>:2,.t5</code>：把第 2 行到当前光标行复制到第 5 行下方</li>
<li><code>:2m.</code>：把第 2 行移动到当前行下方</li>
<li><code>:t5</code>：把当前行复制到第 5 行下方</li>
<li><code>:t$</code>：把当前行复制到最后一行</li>
<li><code>:t.</code>：把当前行复制到下一行，同 <code>yyp</code></li>
<li><code>:%s/echocai/forecho</code>：把当前文件每行第一个 <code>echocai</code> 替换为 <code>forecho</code></li>
<li><code>:%s/echocai/forecho/g</code>：把当前文件的所有 <code>echocai</code> 替换为 <code>forecho</code></li>
<li><code>:'&lt;,'&gt;s/field/echo</code>：把当前高亮区域中所有的 <code>field</code> 替换为 <code>echo</code> （高亮区域可以事先通过 <code>Vjjj</code> 选中，再输入 <code>:</code> 的时候，会自动输入 <code>'&lt;,'&gt;</code>）</li>
<li><code>:![cmd]</code>：运行 shell 命令（示例：<code>:!pwd</code>、<code>:!ls</code>）</li>
</ul>
<h2>移动光标</h2>
<p>这个是非常常用的功能，在普通模式下我们除了使用 <code>h</code>、<code>j</code>、<code>k</code>、<code>l</code> 移动外，我们还可以：</p>
<ul>
<li><code>Control</code> + <code>d</code>：向下滚动半屏幕</li>
<li><code>Control</code> + <code>u</code>：向上滚动半屏幕</li>
<li><code>gg</code>：跳转到文件头部</li>
<li><code>12gg</code>：跳转到第 12 行</li>
<li><code>G</code>：跳转到文件末尾</li>
<li><code>f{char}</code>：行内搜索，跳转到下一个{char}所在的位置上（示例：<code>fx</code> 跳转到下一个 x 所在的位置）</li>
<li><code>F{char}</code>：行内搜索，跳转到上一个{char}所在的位置上。（示例：<code>Fx</code> 跳转到上一个 x 所在的位置）</li>
<li><code>t{char}</code>：行内搜索，跳转到下一个{char}的前一个位置上。（示例：光标在行首的时候，在有 ActiveForm 的行内使用 <code>tc</code> 跳转到 A 所在的位置）</li>
<li><code>T{char}</code>：行内搜索，跳转到上一个{char}的前一个位置上。</li>
<li><code>w</code>：跳转到下一个单词的第一个单词上</li>
<li><code>b</code>：跳转到上一个单词的第一个单词上</li>
<li><code>e</code>：跳转到下一个单词的最后一个单词上</li>
<li><code>ge</code>：跳转到上一个单词的最后一个单词上</li>
<li><code>zz</code>：让光标处于屏幕正中间，不会移动光标。</li>
</ul>
<p>上面的 <code>w</code>、<code>b</code>、<code>e</code> 都有对应的大写 <code>W</code>、<code>B</code>、<code>E</code>，区别就是大写范围更大。小写范围是单词（word），大写范围是字串（WORD），区别：</p>
<ul>
<li>单词（word）：由数字、字母、下划线或者其他非空白字符串组成</li>
<li>字串（WORD）：以空白字符串分割</li>
</ul>
<p>另外在使用 <code>f</code>、<code>F</code>、<code>t</code>、<code>T</code> 命令的时候，要注意：</p>
<ul>
<li>尽量找低频字母</li>
<li><code>;</code>：重复上一次行内搜索，可以理解为跳转到下一个目标位置</li>
<li><code>,</code>：撤回上一次行内搜索，可以理解为跳转到上一个目标位置</li>
</ul>
<h2>动作</h2>
<p>动作是指再普通模式下执行的一些行为，需要跟其他指令一起使用。最常用的有这些：</p>
<ul>
<li><code>d</code>：删除</li>
<li><code>c</code>：删除并且进入插入模式</li>
<li><code>r</code>：替换，在普通模式下替换一个字符，比方说把光标移动 t 上，按下 <code>rT</code> 会直接把 t 替换为 T 并且还处于普通模式下</li>
<li><code>R</code>: 进入替换模式，会替换光标所在的文字，直到按 <code>Esc</code> 为止</li>
<li><code>x</code>：普通模式下删除一个字符，保持普通模式</li>
<li><code>u</code>：撤销操作</li>
<li><code>Control</code> + <code>r</code>：重做</li>
</ul>
<p>以上这些动作都可以用数字或者其他指令组合，一些示例：</p>
<ul>
<li><code>daw</code>：即使你处于单词中间，你也可以通过这个命令把整个单词删除。</li>
<li><code>4dd</code>：<code>dd</code> 是删除一行，<code>4dd</code> 是删除 4 行</li>
</ul>
<h2>宏录制</h2>
<p>Vim 的录制宏是一个非常强大的功能，当我们需要对一些重复的操作进行批量处理的时候，可以使用宏来完成。比方说，我们需要下面每行文字都用双引号包起来，并且在结尾加上逗号</p>
<pre><code>972ea750-3ff7-48a0-b7b9-9e07532765e
97303b94-e378-4c70-9cfe-9a2d1781b67
973085e8-0c6a-487a-8e95-5f217f79b39
963b60c9-a441-44cf-a7f0-eecda25bb50
96d3a702-ff06-42d5-996e-ab0349f4d3b
9736e7da-aaa1-4368-8a27-90442a13da0
9739b00e-caa5-4628-a870-5e71e1eefd6
973d3fd4-7a2b-4d75-8ba8-596856a0e8c
963b6240-e78a-41bf-9e84-601f7218535
969df9b8-4d30-4ada-9c04-276a3e11aed
9747ade0-efc3-466d-84f8-6fc51c212a6
9747c63e-59b2-4232-8518-658bb339bc4
9747c73b-a341-4bcd-b474-205fe3b5255
9747c7b5-fc70-4532-ab6c-31193c84447
9747c817-bad5-43d6-95cd-b13243cfd2a
9747cc8a-e236-4ea6-b38e-a3effe1b90b
9747d202-3332-40e0-b7c5-46626df88a8
9747dccf-6ef7-4fe8-9e31-74d69e0b8b8
9747ddf8-a243-4c5d-adf4-ad1c0879244
</code></pre>
<p>不用 Vim 宏录制功能的话，我一般用 Sublime Text 的批量选中（按住 <code>Option</code> 然后按住鼠标往下拉就能批量选中），然后批量操作来完成。</p>
<p>要处理的行数比较少，这种方式还挺快的。但是遇到要处理几百甚至几千行，这种方式就不太适合了。这时候就可以用 Vim 的宏录制功能来完成了。</p>
<p>宏录制的功能你可以理解为记录一系列按键操作，然后批量「播放」执行。</p>
<h3>宏录制步骤：</h3>
<ul>
<li>普通模式下 <code>q</code> + <code>a</code>，然后开始录制，这里的 <code>a</code> 是宏的名字，可以是任意字母或者数字</li>
<li>开始正常的 Vim 操作，比方说移动光标，删除，插入等等。这里需要注意的是不能用方向键移动光标，只能用 <code>hjkl</code> 或者 <code>w</code> 等移动光标的命令</li>
<li>普通模式下 <code>q</code>，结束录制。如果是批量操作行，记得在结束之前要按一下 <code>j</code> 换行</li>
</ul>
<h3>宏使用步骤：</h3>
<p>普通模式下 <code>@</code> + <code>a</code>，这里的 <code>a</code> 是你之前保存的宏的名字，100 行的话，按一下 <code>100@a</code> 就可以了，依次类推。</p>
<h3>实战</h3>
<p>上面的需求，我们可以用下面的宏来完成：</p>
<ul>
<li>开始录制：<code>Esc + q + 1</code></li>
<li>具体操作：<code>0 + i + " + Esc + A + " + , + Esc + j + q</code> 这个操作可以用宏来完成，具体操作如下：</li>
<li>执行宏：<code>Esc + 18@1</code></li>
</ul>
<h2>配置 Vim</h2>
<h2>插件</h2>
<p>安装插件有几种方式，我是使用的是 <a href="https://github.com/tpope/vim-pathogen">pathogen.vim</a> 的方式，方法：</p>
<pre><code>mkdir -p ~/.vim/autoload ~/.vim/bundle &amp;&amp; \
curl -LSso ~/.vim/autoload/pathogen.vim https://tpo.pe/pathogen.vim
vim ~/.vimrc
</code></pre>
<p>然后插入：</p>
<pre><code>execute pathogen#infect()
syntax on
filetype plugin indent on
</code></pre>
<p>下面推荐几个插件</p>
<h3><a href="https://github.com/tpope/vim-abolish">vim-abolish</a></h3>
<p>转换单词，示例：</p>
<ul>
<li><code>crm</code>：把下划线风格转换成大驼峰风格（<code>foo_bar</code> 转换为 <code>FooBar</code>）</li>
<li><code>crc</code>：把下划线风格转换成小驼峰风格（<code>foo_bar</code> 转换为 <code>fooBar</code>）</li>
<li><code>crs</code>：把小驼峰风格转换成下划线风格（<code>fooBar</code> 转换为 <code>foo_bar</code>）</li>
<li><code>cru</code>：转化为下划线分割全大写风格</li>
<li><code>cr-</code>：转化为小写中划线分割风格</li>
<li><code>cr.</code>：转化为小写点分割风格</li>
<li><code>cr.</code>：转化为小写点分割风格</li>
<li><code>cr.</code>：转化为小写点分割风格</li>
<li>其他功能看文档吧</li>
</ul>
<p>安装</p>
<pre><code>cd ~/.vim/bundle
git clone git://github.com/tpope/vim-abolish.git
</code></pre>
<h3><a href="https://github.com/ybian/smartim">ybian/smartim</a></h3>
<p>自动切换输入法，保证回到普通模式的时候是英文输入法。</p>
<p>安装</p>
<pre><code>cd ~/.vim/bundle
git clone git@github.com:ybian/smartim.git
im-select
</code></pre>
<p>如果不是 <code>com.apple.keylayout.US</code> 就要修改设置：</p>
<pre><code>vim ~/.vimrc
</code></pre>
<p>添加这行</p>
<pre><code>let g:smartim_default = 'com.apple.keylayout.ABC'
</code></pre>
<h2>最后</h2>
<p>Vim 要了解 Vim 的哲学，学 Vim 带来的收益我认为是<a href="https://zh.wikipedia.org/wiki/%E6%8C%87%E6%95%B8%E5%A2%9E%E9%95%B7">指数增长</a>的，但是绝对是值得的，虽然现在很少有人直接在终端用 Vim 写代码，但是几乎所有的编辑器都可以开启 Vim 模式了。</p>
<p>《Vim 实用技巧 第二版》这本书我还没看完，所以本篇文章会持续更新。</p>
<h2>参考链接</h2>
<ul>
<li><a href="http://einverne.github.io/post/2015/05/vim-mode.html">Vim 多模式介绍</a></li>
<li><a href="https://github.com/wsdjeg/vim-galore-zh_cn/blob/master/README.md">Vim 从入门到精通</a></li>
<li><a href="http://yyq123.github.io/learn-vim/learn-vi-00-List.html">VIM 学习笔记</a></li>
</ul>
