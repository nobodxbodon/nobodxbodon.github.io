<h2>原文：<a href="https://blog.forecho.com/re-engineering-legacy-software">遗留系统重建实战</a></h2>
<hr/>
<h2>title: "遗留系统重建实战"
date: 2021-12-27T15:28:00+08:00
tags: ["技术分享"]
draft: false
toc: true</h2>
<h2>引言</h2>
<p>入职新公司，我们希望去写新系统，但是实际上你的工作往往是去维护一个遗留系统。那么这边文章就来分享一下如何重建一个遗留系统。</p>
<h2>定义遗留系统</h2>
<p>我们可以把一个已经存在的、难以维护或者扩展的系统统称为遗留系统。遗留系统往往有这些特征：</p>
<ul>
<li>老旧：项目代码写于很多年前，经历过几代人开发和维护。</li>
<li>庞大：代码越多，Bug 也越多，维护越困难。</li>
<li>继承而来：代码的创建者和维护者已经不是同一批人了。</li>
<li>文档不完善：文档没有及时的更新，甚至是没有文档。</li>
</ul>
<p>&lt;!--more--&gt;</p>
<h2>重建遗留系统难点</h2>
<p>为什么说重建遗留系统是一件很难的事情？因为：</p>
<ul>
<li>害怕改变：项目复杂、缺少文档，谁也不想维护这种系统。写新需求或者改动老代码都害怕出现新的 Bug。</li>
<li>缺少测试，或者连测试都很困难。</li>
<li>过时的依赖：项目依赖于过时的第三方库，不敢升级。</li>
</ul>
<h2>实战</h2>
<h3>下定决心</h3>
<p>首先要明白一点，重建遗留系统是一件很难的事情。你们是否下定决心去重建？克服恐惧和沮丧。</p>
<h3>建立信心</h3>
<ul>
<li>探索性重构：你对代码了解的越多，恐惧就越少。</li>
<li>使用工具：<ul>
<li>Git 版本管理</li>
<li>IDE 编辑器</li>
<li>代码规范和代码检查工具</li>
<li>其他同事：互相 review 代码</li>
</ul>
</li>
</ul>
<h3>快速部署</h3>
<p>新人能快速部署项目，也是一个重要的指标。我们可以使用 Docker 简化部署，持续更新部署文档。可以把部署步骤放在 README.md 中，方便大家了解。</p>
<h3>日志系统</h3>
<p>可在线方便快速的日志系统，你可以使用 <a href="https://www.elastic.co/cn/what-is/elk-stack">ELK</a> 自主搭建，或者使用云服务器平台提供的日志服务。</p>
<p>针对小型项目还可以使用 <a href="https://sentry.io/">Sentry</a> 等 SaaS 服务进行错误收集，接入基本上无门槛，非常的方便。</p>
<h3>自动化部署</h3>
<ul>
<li>如果你们使用的 GitHub 那就可以用 GitHub Actions 来自动化部署。</li>
<li>如果使用的是 Gitlab，那就可以用 Gitlab CI 来自动化部署。</li>
<li><a href="https://jenkins.io/">Jenkins</a> 也是一个不错的自动化部署工具。</li>
</ul>
<h3>自动化测试</h3>
<p>编写单元测试，配置 CI 来运行单元测试、集成测试。</p>
<h3>系统监控</h3>
<p>可以自己部署开源的 <a href="https://grafana.com/">Grafana</a> 和 <a href="https://prometheus.io/">Prometheus</a> 监控系统，也可以使用 <a href="https://www.datadoghq.com/">DataDog</a> 提供的 SaaS 监控系统。</p>
<p>这样就可以监控系统的性能和状态。</p>
<p>有了日志和系统监控就算系统有 Bug 我们也能及时响应，更快的解决问题。</p>
<h3>重搭架构</h3>
<p>拆分系统：拆分成多个模块，每个模块都有自己的角色，每个模块都有自己的职责。</p>
<p>把一个大的系统拆分成很多小的系统，这个每个系统的代码量就会很小，这样就可以更好的维护和扩展。</p>
<h2>最后</h2>
<p>为什么项目最后会变成无法维护？</p>
<p>有时候我们为了快速实现某个需求，走了一些捷径，这种实现方案类似于贷款，到了某些时候我们必须偿还这些贷款，如果没有按时还款，这只会积累更多的贷款和利息，最终你需要支付的债务就会超过你的支付能力。我们把这称之为 code debt。</p>
