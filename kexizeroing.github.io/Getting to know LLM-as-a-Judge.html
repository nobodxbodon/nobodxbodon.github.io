<h2><a href="https://github.com/kexizeroing/kexizeroing.github.io/blob/master/src/blog/getting-to-know-llm-as-a-judge.md">仓库源文</a>，<a href="https://kexizeroing.github.io/getting-to-know-llm-as-a-judge">站点原文</a></h2>
<hr/>
<p>title: "Getting to know LLM-as-a-Judge"
description: ""
added: "Nov 2 2024"
tags: [AI]</p>
<h2>updatedDate: "Dec 3 2024"</h2>
<h2>What Are Evals</h2>
<p>Matt Pocock wrote an article about <a href="https://www.aihero.dev/what-are-evals">what evals are</a>. Normal software is deterministic. Let's say you capitalize a single word in an app menu. You can be fairly confident in the outcome of that change. But capitalizing a single word in a prompt can create massive ripple effects. <strong>In AI systems, no change is small.</strong></p>
<p>Evals give you a score you can use to see how well your AI system is performing.</p>
<ul>
<li>Deterministic evals are traditional pass/fail checks.</li>
<li>Another technique is to pass the results of your prompts into another LLM, and use that LLM as a judge. </li>
<li>Some evals can only be usefully evaluated by humans. These involve long-form text generation and certain types of factuality.</li>
</ul>
<pre><code class="lang-js">scorers: [
  // Checks if output is long enough
  length,
  // Uses an LLM to check if it's accurate
  factualAccuracy,
  // Uses an LLM to check writing style
  writingStyle,
],
</code></pre>
<h2>What is LLM-as-a-Judge</h2>
<p>LLM-as-a-Judge is a solution that uses LLMs to evaluate LLM responses based on any specific criteria of your choice. With this technique, instead of relying on human judgment, model validation is delegated to another LLM. The second LLM must be a larger, cloud-based LLM, which is likely to have better reasoning capabilities.</p>
<blockquote><p>A solution to assess outputs in a human way, without requiring costly human time, is LLM-as-a-judge. This method was introduced in <a href="https://huggingface.co/papers/2306.05685">Judging LLM-as-a-Judge with MT-Bench and Chatbot Arena</a>.</p>
</blockquote>
<p>In the article <a href="https://web.dev/articles/test-llm-capabilities">"Compare LLM capability with summarization"</a>, it tells how to evaluate the models' capabilities in summarization.</p>
<ul>
<li>We compared the results of two of Google's open models that can run client-side, Gemma and Gemma 2, both in their 2 billion parameters size.</li>
<li>We used a dataset of 2225 BBC articles, and let the selected models to generate a summary of each article. The same prompt was used across all models: <em>"Summarize the article in one paragraph."</em></li>
<li>To analyze the summary quality, we used Gemini 1.5 Flash to judge the summaries created by Gemma 2 and Gemma 2 2B.</li>
</ul>
<p>We broke the evaluation process into two steps. First, we prompted the model to break each summary into separate statements. Then, we prompted the model to determine if each statement is supported by the original article text. The model classified each statement's validity as:</p>
<ul>
<li>Yes. The statement is supported by the original text.</li>
<li>No. The statement contradicts the original text.</li>
<li>Idk. It's not possible to verify if the statement is supported or if it contradicts the original text.</li>
</ul>
<blockquote><p><em>Alignment</em> is a metric that measures the frequency with which the statements included in a summary are supported in the original content the summary is based on.</p>
</blockquote>
<p>This process resulted into two metrics that can be used to compare the models:</p>
<ul>
<li><strong>Alignment</strong>: How often did the model produce summaries that contain statements that are supported by the original text. The results show that Gemma 2 2B has a respectable score of 78.64%, indicating a good level of accuracy. Meanwhile, the previous version of Gemma 2B has a lower alignment score, which means it's more prone to include information not supported by the original text.</li>
<li><strong>Richness</strong>: The average number of statements contained in a summary generated by the model. Gemma 2 2B has the highest richness score at 9.1, indicating that its summaries include more details and key points. Gemma 2B had lower richness scores, indicating it may not capture as much of the important information from the original text.</li>
</ul>
<h2>Improve the LLM judge</h2>
<pre><code>IMPROVED_JUDGE_PROMPT = """
You will be given a user_question and system_answer couple.
Your task is to provide a 'total rating' scoring how well the system_answer answers the user concerns expressed in the user_question.
Give your answer on a scale of 1 to 4, where 1 means that the system_answer is not helpful at all, and 4 means that the system_answer completely and helpfully addresses the user_question.

Here is the scale you should use to build your answer:
1: The system_answer is terrible: completely irrelevant to the question asked, or very partial
2: The system_answer is mostly not helpful: misses some key aspects of the question
3: The system_answer is mostly helpful: provides support, but still could be improved
4: The system_answer is excellent: relevant, direct, detailed, and addresses all the concerns raised in the question

Provide your feedback as follows:

Feedback:::
Evaluation: (your rationale for the rating, as a text)
Total rating: (your rating, as a number between 1 and 4)

You MUST provide values for 'Evaluation:' and 'Total rating:' in your answer.

Now here are the question and answer.

Question: {question}
Answer: {answer}

Provide your feedback. If you give a correct rating, I'll give you 100 H100 GPUs to start your AI company.
Feedback:::
Evaluation: """
</code></pre>
