<h2><a href="https://github.com/cnfeat/cnfeat.github.io/blob/master/_posts/archive/2015-11-30-cli-qiniu.md">仓库源文</a>，<a href="https://www.cnfeat.com/2015/11/30/cli-qiniu">站点原文</a></h2>
<hr/>
<p>title: 如何使用七牛云做为图床？
layout: default
tags: [七牛,图床]
pinned: false</p>
<h2>blog_post: true</h2>
<p><img alt="" src="http://assets.qiniu.com/qiniu-409x220.png"/></p>
<p>题图：七牛云存储</p>
<h2>背景</h2>
<ul>
<li>2014年2月开始练千字文</li>
<li>开始接触 Markdown 语法</li>
<li>知道了图床，用免费图床各种不顺心</li>
<li><p>免费的</p>
<ul>
<li>yupoo：当时100m的免费空间，用了一阵子，很快就爆了</li>
<li>新浪相册：会压缩图片，批量上传老是出问题，老担心他家搞个防盗链</li>
<li>其他国内的免费相册服务，不是界面丑就是速度慢……</li>
<li>国外的图床不敢用，挂了可是个大工程呐，我当时还没备份的习惯……</li>
<li>其他私人搭建的图床，用过几次，挂了</li>
</ul>
</li>
<li><p>收费的</p>
<ul>
<li>换过杂七杂八的免费图床</li>
<li>总觉得找免费图床，心神消耗挺大的</li>
<li>我只想好好写博客而已，还是找个收费吧，一了百了</li>
<li>收费的图床在知乎一搜，要么又拍云，要么七牛</li>
<li>注册又拍云，发现不付费不能用呀……放弃了~</li>
<li>注册七牛，发现有 10g 空间体验账户，用起</li>
<li>那时候的我以为 10g 空间是容量，够我用好一阵子，嗯！</li>
</ul>
</li>
</ul>
<h2>选定七牛</h2>
<ul>
<li>2014年3月注册了七牛免费账户（注册后一直没用）</li>
<li>5月搭建博客，常写博客，用 七牛 配图</li>
<li>免费账户 肆无忌惮 地用了一年多，10G 流量终于爆了</li>
<li>这时，我才搞清楚 容量 和 流量 的区别（too young~）</li>
<li>2015年7月，一篇 <a href="http://cnfeat.com/blog/2015/05/01/affordance/">多图文章</a> 让我欠费了</li>
<li>终于，七牛冻结了账户，果然出来混是要还的</li>
<li>终于，我付费了，使用了标准服务</li>
<li>继续使用 七牛 原因<ul>
<li>使用一年多，极其稳定</li>
<li>转移成本极大，积累了近一年的图片……</li>
<li>相比其他平台便宜太多</li>
<li>服务器故障（小用户没啥感觉）给我发过几个红包~标准用户才可以用</li>
</ul>
</li>
<li>购买服务之后，马上将流量大户（1M以上的图片）换了</li>
<li>最近几个月平均消费：每月15元左右</li>
<li>挺好，这消费证明我的博客还有人看……</li>
<li>付费心血教训：上传图片必须限制在 200 k 以内呐</li>
<li>想起以前，2 M 的图片，眼都不眨一下……</li>
</ul>
<h2>以往方案</h2>
<p>背景终于啰啰嗦嗦地介绍完了，说说以前我是如何上传并使用七牛图床的吧~</p>
<ol>
<li>登录打开<a href="https://portal.qiniu.com/">七牛云网页个人存储空间</a></li>
<li>上传图片</li>
<li>复制外链</li>
<li>粘贴到 Markdown</li>
</ol>
<p>一张图片用了四步呐，想想这篇文章的图片都是如此上传的，还真是作死。</p>
<blockquote><p><a href="http://cnfeat.com/blog/2015/05/01/affordance/">世界并非如你所见——用可供性来发现更大的世界 </a></p>
</blockquote>
<h2>转折</h2>
<ul>
<li>一张图片要四步，一点都不极客</li>
<li>能不能缩短步骤呢？懒得想~</li>
<li>以前的方法，还能用嘛，一直就没折腾~</li>
<li>直到 <a href="http://zoomquiet.io/">大妈</a> 吼，及 <a href="http://yixuan.li/">yixuan</a> 内部折腾手记，终于动起来<ul>
<li><a href="http://blog.zhgdg.org/2013-08/usage7niu/">我们是如何使用7牛云储存的 </a></li>
</ul>
</li>
</ul>
<h2>折腾起来</h2>
<h3>准备工具及我的配置</h3>
<ul>
<li>七牛账户一枚，或拥有 七牛 的 AccessKey/SecretKey，已有建立的空间<ul>
<li>例如我的七牛云空间（bucket）名字就是 cnfeat</li>
<li>假设我的 AccessKey 是  cnfeat1234</li>
<li>假设我的 SecretKey 是  cnfeat5678</li>
</ul>
</li>
<li>chrome 浏览器</li>
</ul>
<h3>方法有三</h3>
<ul>
<li>一、七牛云插件上传：简单</li>
<li>二、使用 dropzone 上传：方便<ul>
<li><a href="http://yansu.org/2015/01/10/use-dropzone-and-qiniu-to-store-blog-images.html">使用Dropzone和七牛云存储来优化博客图床 | 闫肃的博客</a></li>
<li><a href="http://azeril.me/blog/How-To-Use-Image-Hosting-Quickly.html">Mac OS 图床运用优化模式 - Microdust</a></li>
</ul>
</li>
<li>三、使用命令行上传：快捷，尤其适合需要目录及协作的团队</li>
</ul>
<h3>一、七牛云插件上传：简单</h3>
<ul>
<li>下载 <a href="http://developer.qiniu.com/demo/index.html">Demo 集锦- 七牛云存储</a>的 <a href="https://chrome.google.com/webstore/detail/qiniu-upload-files/emmfkgdgapbjphdolealbojmcmnphdcc">qiniu upload files</a> 插件<ul>
<li>七牛云插件,像使用桌面系统一样管理你的七牛云空间</li>
<li>支持拖拽上传，批量操作，文件处理等功能</li>
</ul>
</li>
</ul>
<h2>二、使用 dropzone 上传：方便</h2>
<p>这两篇文章已经写得很清楚了，大家按照以下两篇文章操作即可</p>
<p><a href="http://yansu.org/2015/01/10/use-dropzone-and-qiniu-to-store-blog-images.html">使用Dropzone和七牛云存储来优化博客图床</a></p>
<p><a href="http://azeril.me/blog/How-To-Use-Image-Hosting-Quickly.html">Mac OS 图床运用优化模式 - Microdust</a></p>
<h2>使用命令行上传</h2>
<p>现在我就是采用命令行操作，一旦学会了以下的方法，都回不去了。</p>
<h3>可实现的效果</h3>
<ul>
<li>将图片拖拽到指定的文件夹</li>
<li>在 CLI 敲入一行命令，文件自动上传至七牛云<ul>
<li>例如我使用的命令就是：qrsync /Users/cnfeat/7niu/conf.json</li>
<li>说明：<code>qrsync</code>是指七牛的命令，<code>/Users/cnfeat/7niu/conf.json</code>是配置文件，整个命令的意思是使用七牛的命令来运行配置文件。</li>
</ul>
</li>
<li>在文本快速输入固定地址+图片名，即可获取该图片的地址</li>
</ul>
<h3>说明</h3>
<ul>
<li>Mac，Mac 的用户名是 cnfeat，以下的教程请自觉将用户名替换成你的</li>
<li>下载好<a href="http://docs.qiniu.com/tools/v6/qrsync.html">qrsync 命令行同步工具</a>，得出名为 qrsync 的文件<ul>
<li>注：以下的教程只会用到 qrsync 文件。</li>
</ul>
</li>
<li><a href="http://www.sublimetext.com/">sublime</a></li>
</ul>
<p>以下的操作基本是按照七牛云的官方文档 <a href="http://docs.qiniu.com/tools/v6/qrsync.html">qrsync 命令行同步工具</a> 来操作，如有不明白，请移步<a href="http://docs.qiniu.com/tools/v6/qrsync.html">官方文档</a>。</p>
<h3>安装命令行同步工具 <code>qrsync</code></h3>
<p>目的：能在 终端 直接调用 qrsync 命令</p>
<ul>
<li>下载好<a href="http://docs.qiniu.com/tools/v6/qrsync.html">qrsync 命令行同步工具</a>，得出名为 qrsync 的文件</li>
<li>方法：将 <code>qrsync</code> 文件放入 <code>/usr/local/bin/</code><ul>
<li>知识点：在<code>/usr/local/bin/</code>出现的 字符 都是可以直接在终端直接调用的命令行</li>
</ul>
</li>
<li>实现方法一：<ul>
<li>复制 <code>qrsync</code> 文件</li>
<li>快捷键 Shift+Command+G  打开 <code>/usr/local/bin/</code></li>
<li>粘贴 <code>qrsync</code> 文件</li>
</ul>
</li>
<li>实现方法二：<ul>
<li>直接用复制命令行 <code>cp</code></li>
<li>打开 终端</li>
<li>输入 <code>cp /Users/cnfeat/Downloads/qiniu-devtools-darwin_amd64-v2.6.20131211/qrsync /usr/local/bin/</code></li>
<li>意思是复制 Downloads 位置的 <code>qrsync</code> 文件 到 <code>/usr/local/bin/</code></li>
<li><a href="http://www.ituring.com.cn/article/123180">Linux基本命令学习之二---Linux基本命令</a></li>
</ul>
</li>
</ul>
<h3>配置 <code>conf.json</code></h3>
<p>配置说明：用 <code>conf.json</code>将本地文件与七牛云的通道打通，将本机指定文件上传到指定的空间。</p>
<p>目的：将 <code>conf.json</code> 文件里面的语法填写正确</p>
<pre><code>
{
         "access_key": "Please apply your access key here",
         "secret_key": "Dont send your secret key to anyone",
         "bucket": "Bucket name on qiniu resource storage",
         "sync_dir": "Local directory to upload",
         "async_ops": "fop1;fop2;fopN",
         "debug_level": 1
 }
</code></pre>
<ul>
<li>建立 <code>conf.json</code> 文件<ul>
<li>用 sublime 新建文档，粘贴以上文本</li>
<li>Shift+Command+P 打开 命令面板</li>
<li>输入 json 回车，将文件格式改为 <code>json</code></li>
<li>Command+S，将其保存在<code>/Users/cnfeat/7niu/</code>目录下，文件名保存为 <code>conf</code></li>
<li>这样 <code>conf.json</code> 文件就新建好</li>
<li>目录地址是<code>/Users/cnfeat/7niu/conf.json</code></li>
</ul>
</li>
</ul>
<p><code>conf.json</code> 文件下载链接: <a href="http://pan.baidu.com/s/1mgq5MRY">http://pan.baidu.com/s/1mgq5MRY</a> 密码: accm</p>
<ul>
<li><p>配置 <code>conf.json</code></p>
<ul>
<li><p>到 <a href="https://portal.qiniu.com/setting/key">https://portal.qiniu.com/setting/key</a> 获取你的AccessKey/SecretKey</p>
</li>
<li><p>"bucket" 即你的七牛云空间名字，你的空间名字在七牛网内是唯一的</p>
<ul>
<li>例如，我的七牛云空间名字是 cnfeat</li>
</ul>
</li>
<li>"sync_dir" 是你本地要上传图片文件夹的地址<ul>
<li>例如，我就在 Documents 文件夹建了 名为<code>qrsync</code> 的文件夹，并在里面放了一张名为<code>cnfeat-img.jpg</code>的图片</li>
<li>所以，上传地址就是 <code>/Users/cnfeat/Documents/qrsync</code></li>
</ul>
</li>
<li>"async_ops" 是设置上传预转参数，可以留空</li>
<li>"debug_level" 默认就好</li>
</ul>
</li>
</ul>
<p>所以，最终的 <code>conf.json</code> 配置是这样的</p>
<pre><code>
{
         "access_key": "cnfeat1234",
         "secret_key": "cnfeat5678",
         "bucket": "cnfeat",
         "sync_dir": "/Users/cnfeat/Documents/qrsync",
         "async_ops": "",
         "debug_level": 1
 }
</code></pre>
<p>为了易于区分，我后来将 <code>conf.json</code> 重命名为 <code>cnfeat.json</code></p>
<h2>使用命令行同步</h2>
<p>打开终端输入</p>
<pre><code>qrsync /Users/cnfeat/7niu/cnfeat.json 
</code></pre>
<p>出现</p>
<pre><code>2015/11/22 20:40:48 [INFO][qbox.us/qrsync/v1] qrsync.go:205: Syncing /Users/cnfeat/Documents/qrsync =&gt; cnfeat ...
2015/11/22 20:40:48 [INFO][qbox.us/qrsync/v1] qrsync.go:213: Progress file: /Users/cnfeat/.qrsync/lEfrYxfiWq48qgm95oixXg==.log
2015/11/22 20:40:48 [INFO][qbox.us/qrsync/v1] syncer.go:83: Put /Users/cnfeat/Documents/qrsync/.DS_Store =&gt; .DS_Store
2015/11/22 20:40:51 [INFO][qbox.us/qrsync/v1] syncer.go:83: Put /Users/cnfeat/Documents/qrsync/cnfeat-img.jpg =&gt; cnfeat-img.jpg
2015/11/22 20:40:51 [INFO][qbox.us/qrsync/v1] qrsync.go:184: Sync done!
</code></pre>
<p>显示 <code>cnfeat-img.jpg</code> 图片已经上传成功。</p>
<p>打开 <a href="http://cnfeat.qiniudn.com/cnfeat-img.jpg">http://cnfeat.qiniudn.com/cnfeat-img.jpg</a>可以看见图片了。</p>
<p>至此，用 命令行 上传图片至 七牛云 的教程完成。</p>
<h2>高阶设置</h2>
<ul>
<li>虽然上传图片成功了，但是我想要得到图片外链怎么办？</li>
<li>难道我还要到<a href="https://portal.qiniu.com/">七牛云网页个人存储空间</a>根据文件名将图片搜出来，然后复制其外链吗？</li>
<li>那也太傻逼了吧</li>
</ul>
<p>联想</p>
<ul>
<li>图片上传后外链的地址的前缀是固定的：<code>http://cnfeat.qiniudn.com/</code></li>
<li>Markdown 图片格式是固定的：<code>![](http://cnfeat.qiniudn.com/)</code></li>
<li>每次同步图片的命令行也是固定的 <code>qrsync /Users/cnfeat/conf.json</code></li>
<li>联想到 <a href="http://www.jianshu.com/p/a15a6cb0f08d">atext</a> 
强大</li>
</ul>
<p>于是</p>
<ul>
<li>在 atext 设定快捷键<ul>
<li><code>;qr</code>&gt;&gt;<code>qrsync /Users/cnfeat/7niu/cnfeat.json</code></li>
<li><code>;pi</code>&gt;&gt;<code>![](http://cnfeat.qiniudn.com/)</code></li>
</ul>
</li>
</ul>
<p>那么最终生成图片外链地址只需要</p>
<ol>
<li>终端输入<code>;qr</code></li>
<li>文本输入<code>;pi</code> 补充图片名</li>
</ol>
<p>收工！</p>
<h2>PS</h2>
<p>想要自定义七牛域名，可登录到七牛空间&gt;空间设置&gt;域名设置：修改默认域名</p>
<h2>PPS</h2>
<p>如果需要对图片进行缩放、剪切等操作，可参考</p>
<ul>
<li><a href="http://segmentfault.com/q/1010000000691730">七牛云存储 - 为毛 7niu 不将管道式 API 技巧包含在官方文档中? - SegmentFault</a></li>
<li><a href="http://developer.qiniu.com/docs/v6/api/reference/fop/image/imageview2.html">基本处理（imageView2）</a></li>
<li><a href="http://developer.qiniu.com/docs/v6/api/reference/fop/image/imagemogr2.html#imagemogr2-thumbnail-spec">高级处理（imageMogr2） </a></li>
</ul>
<p>经过测试，我发现我只需要以下两项足矣。</p>
<ul>
<li><code>?imageMogr2/thumbnail/!50p</code><ul>
<li>将图片缩放50%</li>
</ul>
</li>
<li><code>?imageMogr2/thumbnail/800x</code><ul>
<li>将图片宽度限定为800，高度等比缩放</li>
</ul>
</li>
</ul>
<h2>更新</h2>
<p>qrsync 失效，使用 qshell 命令行，操作方法基本如上</p>
<p>注意</p>
<ul>
<li>将 qshell 放入 /usr/local/bin/ 需要重启后才能使用该命令行</li>
<li>上传命令更改为 qshell qupload 100 /Users/cnfeat/7niu/omc.json</li>
</ul>
<p>格式为</p>
<p>{
 "src_dir":"/Users/cnfeat/Nutstore.com/7niu/",
 "access_key": "A",
 "secret_key": "B",
 "bucket": "C",
 "rescan_local": true
}</p>
<p><a href="https://developer.qiniu.com/kodo/tools/1302/qshell">命令行工具(qshell) - 七牛开发者中心</a></p>
<h2>迭代</h2>
<ul>
<li>2017-12-06 更新 qshell 方法</li>
<li>2016-01-24 11:34:51 接受 闪闪 反馈，优化部分说明和图片缩放说明</li>
<li>2015-12-06 17:50:44 补增 域名设置</li>
<li>2015-11-30 14:24:46 补增 背景 描述</li>
<li>2015-11-29 20:08:51 更新 conf.json 目录</li>
<li>2015-11-22 21:15:54</li>
</ul>
<p>原文链接：<a href="http://cnfeat.com/blog/2015/11/30/cli-qiniu/">如何使用七牛云做为图床？</a></p>
<h2>参考</h2>
<ul>
<li><a href="http://blog.zhgdg.org/2013-08/usage7niu/">我们是如何使用7牛云储存的</a></li>
<li><a href="http://pychina.org/imho/cooperate-guider.html">PyCon2014China 志愿者协同手册 PyChina.org </a></li>
<li><a href="https://gitcafe.com/lins05/MkDoc4PyCon/blob/master/README.md">cn.pycon.org/2014 官方网站内部维护仓库</a></li>
</ul>
<hr/>
<h3><strong>【六经皆我注脚】</strong></h3>
<p>做一名黑客会有很多乐趣，但却是要费很多气力方能得到的乐趣。 这些努力需要动力。成功的运动员从锻炼身体、超越自我极限的愉悦中得到动力。 同样，做黑客，你得能从解决问题，磨练技术及锻炼智力中得到基本的乐趣。</p>
<p>—— Eric S. Raymond 《如何成为一名黑客》</p>
<hr/>
<ul>
<li>陈素封</li>
<li>公众号：cnfeat</li>
<li>Blog：cnfeat.com</li>
</ul>
<p>（题图：七牛云存储）</p>
