<h2>原文：<a href="http://codeinchinese.com/2018/12/16/VS-Code%E8%8B%B1%E6%B1%89%E8%AF%8D%E5%85%B8%E8%BF%9B%E5%8C%96%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA:-%E7%BF%BB%E8%AF%91%E6%96%87%E4%BB%B6%E6%89%80%E6%9C%89%E5%91%BD%E5%90%8D.markdown">VS Code英汉词典进化效果演示: 翻译文件所有命名</a></h2>
<hr/>
<h2>layout: post
comments: true
title:   "VS Code英汉词典进化效果演示: 翻译文件所有命名"
description: 实现VS code插件, 基于本地词典数据, 提供英汉翻译功能, 演示批量命名翻译功能. Demonstrate a new feature in vscode extension to translate English word or phrase to Chinese, by supporting translating all identifiers in a file.
date:   2018-12-16 00:00:00 -0700
categories: 命名 翻译</h2>
<p>续<a href="https://zhuanlan.zhihu.com/p/51525136">VS Code英汉词典插件v0.0.7-尝试词性搭配</a>, 下一个功能打算实现文件的批量命名翻译: <a href="https://github.com/program-in-chinese/overview/issues/86#issuecomment-436745681">批量代码汉化工具 · Issue #86 · program-in-chinese/overview</a></p>
<p><em><strong>功能仍未完成. 下面仅为效果演示之用. 并未实际调用英汉词典数据:</strong></em></p>
<p>![2018-12-16-vscode_翻译命名_演示]({{ "/assets/2018-12-16-vscode_翻译命名_演示.gif" | absolute_url }})</p>
<h3>相关源码</h3>
<p>新建编辑器内容提供者:</p>
<pre><code class="language-typescript">'use strict';

import * as vscode from 'vscode';

export default class Provider implements vscode.TextDocumentContentProvider{

	static scheme = 'references';
	private _演示字典: Map&lt;String, String&gt; = new Map([
		["BasicCalculator", "基本的计算器"],
		["Calculator", "计算器类"],
		["calculator", "计算器"],
		["add", "加"],
		["subtract", "減"],
		["multiply", "乘"],
		["divide", "除"],
		["first", "第一"],
		["second", "第二"],
		["number", "数"],
		["divisor", "被除数"]
	]);

	dispose() {
	}

	provideTextDocumentContent(uri: vscode.Uri): string | Thenable&lt;string&gt; {
		var 新内容 = vscode.window.activeTextEditor.document.getText();
		for (var 原命名 of this._演示字典.keys()) {
		  新内容 = this._replaceAll(新内容, 原命名, this._演示字典.get(原命名));
		}
		return 新内容;
	}

	private _replaceAll(str, find, replace) {
    return str.replace(new RegExp(find, 'g'), replace);
  }
}

let seq = 0;

export function encodeLocation(uri: vscode.Uri, pos: vscode.Position): vscode.Uri {
	const query = JSON.stringify([uri.toString(), pos.line, pos.character]);
	return vscode.Uri.parse(`${Provider.scheme}:test.java?${query}#${seq++}`);
}
</code></pre>
<p>添加并列编辑器("状态框"为现有功能):</p>
<pre><code class="language-typescript">    const provider = new ContentProvider();

    const providerRegistrations = Disposable.from(
		workspace.registerTextDocumentContentProvider(ContentProvider.scheme, provider)
    );

	const commandRegistration = commands.registerTextEditorCommand('editor.翻译标识符', editor =&gt; {
		const uri = encodeLocation(editor.document.uri, editor.selection.active);
		return workspace.openTextDocument(uri).then(doc =&gt; window.showTextDocument(doc, editor.viewColumn + 1));
    });

    const 状态框 = window.createStatusBarItem(StatusBarAlignment.Right, 100);
    状态框.command = 'extension.翻译选中文本';
    context.subscriptions.push(
        provider,
        commandRegistration,
        providerRegistrations,
        状态框
    );
</code></pre>
<h3>发现问题</h3>
<p>似乎vscode对中文命名的高亮有些问题:</p>
<p>![2018-12-16-vscode高亮问题]({{ "/assets/2018-12-16-vscode高亮问题.png" | absolute_url }})</p>
<p>对比英文命名的高亮:</p>
<p>![2018-12-16-vscode高亮对比]({{ "/assets/2018-12-16-vscode高亮对比.png" | absolute_url }})</p>
<hr/>
<p>尴尬的彩蛋:</p>
<p>经<a href="https://www.v2ex.com/t/518148#r_6612887">VS Code 英汉词典进化效果演示: 翻译文件所有命名 - V2EX</a>指出, "演示字典"部分有个错误: divisor是"除数". 当然, 本身英汉词典数据是正确的(如下). 功能实现之后应该不会有此问题:</p>
<p>![2018-12-16-vscode翻译divisor]({{ "/assets/2018-12-16-vscode翻译divisor.png" | absolute_url }})</p>
