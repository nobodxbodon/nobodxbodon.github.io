<h2><a href="https://github.com/jerkwin/jerkwin.github.io//blob/master/_posts/2016-09-19-GROMACS如何做之膜模拟.md">仓库源文</a>，<a href="https://jerkwin.github.io/2016/09/19/GROMACS如何做之膜模拟">站点原文</a></h2>
<ul>
<li><a href="http://www.gromacs.org/Documentation/How-tos/Membrane_Simulations">原文链接</a></li>
<li>2016-09-19 21:11:59 翻译: 刘恒江; tcl代码: 刘胜堂; 补充整理: 李继存</li>
</ul>
<h2>运行膜模拟</h2>
<p>GROMACS用户在运行双脂质层模拟时往往会遇到各种问题, 尤其是体系中还包含蛋白质的时候. 推荐模拟双脂质层和膜蛋白的用户参考教程<a href="http://jerkwin.github.io/9999/10/31/GROMACS%E4%B8%AD%E6%96%87%E6%95%99%E7%A8%8B/#dppckalpsub15subgmx-50">KALP-15 in DPPC</a>.</p>
<p>对膜蛋白体系完成一次模拟需要执行下列步骤:</p>
<ol>
<li>选择一个能用于蛋白质和脂质分子的力场.</li>
<li>将蛋白质插入到膜结构中. (例如, 在预备好的双分子层上使用<code>g_membed</code>命令, 或进行一个粗粒化自组装模拟然后再转换回全原子表示)</li>
<li>向体系中加入溶剂. 并加入离子中和多余的电荷, 确保整个体系最终呈电中性, 同时调整最终的离子浓度</li>
<li>运行能量最小化.</li>
<li>让膜适应蛋白质. 典型的方法是, 在限制蛋白质所有重原子的情况下(力常数可取1000 kJ/mol-nm&lt;sup&gt;2&lt;/sup&gt;)运行约5~10 ns的MD.</li>
<li>去掉限制进行平衡.</li>
<li>运行成品MD.</li>
</ol>
<h2>使用<code>genbox</code>命令添加水</h2>
<p>当使用<code>genbox</code>命令(5.0以后版本中为<code>gmx solvate</code>)向预备好的双层膜体系中添加水时, 水分子往往会进入到膜的夹层中, 去除这些水分子的解决办法有以下几种:</p>
<ul>
<li>将<code>vdwradii.dat</code>文件从你的<code>$GMXLIB</code>复制到当前的工作目录下, 调大脂质层分子中原子的范德华半径(建议调整碳原子的半径为0.35~0.5 nm)以阻止<code>genbox</code>命令将水分子加入夹层中;</li>
<li>运行一段短时间的MD, 让脂质层分子的憎水作用将水分子排出;</li>
<li>编辑结构文件, 手动删除双脂层内部的水分子(记住, 不要忘了修改gro文件中的原子数目, 以及top文件中的水分子数目); 或者</li>
<li>借助一些脚本来删除;</li>
</ul>
<h2>删除膜内部的水分子</h2>
<h3>awk脚本</h3>
<p>此脚本可自动计算保留的水分子个数, 更新总原子数目.</p>
<p>&lt;table class="highlighttable"&gt;&lt;th colspan="2" style="text-align:left"&gt;rmWat.bsh&lt;/th&gt;&lt;tr&gt;&lt;td&gt;&lt;div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"&gt;&lt;pre style="line-height: 125%"&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%"&gt;&lt;span style="color: #B8860B"&gt;usage&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;"\&lt;/span&gt;
&lt;span style="color: #BB4444"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;    rmWat      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;/span&gt;
&lt;span style="color: #BB4444"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;    Jicun LI    &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;/span&gt;
&lt;span style="color: #BB4444"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;     2016-09-19 11:24:51     &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;/span&gt;
&lt;span style="color: #BB4444"&gt;&gt;&gt;   Usage: rmWat &lt;File.gro&gt; {Zmin} {Zmax} {Nsit} {Ncol}&lt;/span&gt;
&lt;span style="color: #BB4444"&gt;&gt;&gt; Default: rmWat     N/A       2     6      3      0&lt;/span&gt;
&lt;span style="color: #BB4444"&gt;&gt;&gt;     Zmin: 水分子中原子z坐标的最小值&lt;/span&gt;
&lt;span style="color: #BB4444"&gt;&gt;&gt;     Zmax: 水分子中原子z坐标的最大值, 删除 Zmin&lt;z&lt;Zmax 的水分子原子&lt;/span&gt;
&lt;span style="color: #BB4444"&gt;&gt;&gt;     Nsit: 水模型的位点数; 3/4/5&lt;/span&gt;
&lt;span style="color: #BB4444"&gt;&gt;&gt;     Ncol: gro文件中的速度列数, 不含速度为0, 含速度为3"&lt;/span&gt;</p>
<p>&lt;span style="color: #666666"&gt;[[&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$#&lt;/span&gt; -lt &lt;span style="color: #666666"&gt;1&lt;/span&gt; &lt;span style="color: #666666"&gt;]]&lt;/span&gt; &lt;span style="color: #666666"&gt;&amp;&amp;&lt;/span&gt; &lt;span style="color: #666666"&gt;{&lt;/span&gt; &lt;span style="color: #AA22FF"&gt;echo&lt;/span&gt; &lt;span style="color: #BB4444"&gt;"&lt;/span&gt;$&lt;span style="color: #BB4444"&gt;usage"&lt;/span&gt;; exit; &lt;span style="color: #666666"&gt;}&lt;/span&gt;</p>
<p>&lt;span style="color: #B8860B"&gt;File&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$1&lt;/span&gt;
&lt;span style="color: #B8860B"&gt;Zmin&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;2; &lt;span style="color: #666666"&gt;[[&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$#&lt;/span&gt; -ge &lt;span style="color: #666666"&gt;2&lt;/span&gt; &lt;span style="color: #666666"&gt;]]&lt;/span&gt; &lt;span style="color: #666666"&gt;&amp;&amp;&lt;/span&gt; &lt;span style="color: #666666"&gt;{&lt;/span&gt; &lt;span style="color: #B8860B"&gt;Zmin&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$2&lt;/span&gt;; &lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;span style="color: #B8860B"&gt;Zmax&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;6; &lt;span style="color: #666666"&gt;[[&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$#&lt;/span&gt; -ge &lt;span style="color: #666666"&gt;3&lt;/span&gt; &lt;span style="color: #666666"&gt;]]&lt;/span&gt; &lt;span style="color: #666666"&gt;&amp;&amp;&lt;/span&gt; &lt;span style="color: #666666"&gt;{&lt;/span&gt; &lt;span style="color: #B8860B"&gt;Zmax&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$3&lt;/span&gt;; &lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;span style="color: #B8860B"&gt;Nsit&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;3; &lt;span style="color: #666666"&gt;[[&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$#&lt;/span&gt; -ge &lt;span style="color: #666666"&gt;4&lt;/span&gt; &lt;span style="color: #666666"&gt;]]&lt;/span&gt; &lt;span style="color: #666666"&gt;&amp;&amp;&lt;/span&gt; &lt;span style="color: #666666"&gt;{&lt;/span&gt; &lt;span style="color: #B8860B"&gt;Nsit&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$4&lt;/span&gt;; &lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;span style="color: #B8860B"&gt;Ncol&lt;/span&gt;&lt;span style="color: #666666"&gt;=0&lt;/span&gt;  &lt;span style="color: #666666"&gt;[[&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$#&lt;/span&gt; -ge &lt;span style="color: #666666"&gt;5&lt;/span&gt; &lt;span style="color: #666666"&gt;]]&lt;/span&gt; &lt;span style="color: #666666"&gt;&amp;&amp;&lt;/span&gt; &lt;span style="color: #666666"&gt;{&lt;/span&gt; &lt;span style="color: #B8860B"&gt;Ncol&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$5&lt;/span&gt;; &lt;span style="color: #666666"&gt;}&lt;/span&gt;</p>
<p>&lt;span style="color: #B8860B"&gt;Fout&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB6688; font-weight: bold"&gt;${&lt;/span&gt;&lt;span style="color: #B8860B"&gt;File&lt;/span&gt;%.gro&lt;span style="color: #BB6688; font-weight: bold"&gt;}&lt;/span&gt;~rmWat.gro</p>
<p>&lt;span style="color: #008800; font-style: italic"&gt;# 获取脂质分子的原子数目, 输出其坐标&lt;/span&gt;
&lt;span style="color: #B8860B"&gt;Natm&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;$(&lt;/span&gt;awk &lt;span style="color: #BB4444"&gt;'&lt;/span&gt; BEGIN&lt;span style="color: #666666"&gt;{&lt;/span&gt;&lt;span style="color: #B8860B"&gt;Natm&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;0&lt;span style="color: #666666"&gt;}&lt;/span&gt;
        &lt;span style="color: #B8860B"&gt;$1&lt;/span&gt;!~/SOL/ &lt;span style="color: #666666"&gt;&amp;&amp;&lt;/span&gt; NF&gt;4 &lt;span style="color: #666666"&gt;{&lt;/span&gt; Natm++; print &gt;&lt;span style="color: #BB4444"&gt;"_Lip.gro"&lt;/span&gt;; next &lt;span style="color: #666666"&gt;}&lt;/span&gt;
        END &lt;span style="color: #666666"&gt;{&lt;/span&gt; print Natm&lt;span style="color: #666666"&gt;}&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;'&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$F&lt;/span&gt;ile&lt;span style="color: #AA22FF; font-weight: bold"&gt;)&lt;/span&gt;</p>
<p>&lt;span style="color: #008800; font-style: italic"&gt;# 获取删除水后的总原子数, 输出水的坐标&lt;/span&gt;
&lt;span style="color: #B8860B"&gt;Ntot&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;$(&lt;/span&gt;awk -v &lt;span style="color: #B8860B"&gt;Ntot&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;$Natm -v &lt;span style="color: #B8860B"&gt;Zmin&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;$Zmin -v &lt;span style="color: #B8860B"&gt;Zmax&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;$Zmax &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
           -v &lt;span style="color: #B8860B"&gt;Nsit&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;$Nsit -v &lt;span style="color: #B8860B"&gt;Ncol&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;$Ncol &lt;span style="color: #BB4444"&gt;'&lt;/span&gt;
        &lt;span style="color: #B8860B"&gt;$1&lt;/span&gt;~/SOL/ &lt;span style="color: #666666"&gt;{&lt;/span&gt;
            Atom&lt;span style="color: #666666"&gt;[&lt;/span&gt;1&lt;span style="color: #666666"&gt;]=&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$0&lt;/span&gt;
            &lt;span style="color: #B8860B"&gt;YesInc&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;0
            &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt;&lt;span style="color: #666666"&gt;(&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;$(&lt;/span&gt;NF-Ncol&lt;span style="color: #AA22FF; font-weight: bold"&gt;)&lt;/span&gt;&lt;Zmin &lt;span style="color: #666666"&gt;||&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;$(&lt;/span&gt;NF-Ncol&lt;span style="color: #AA22FF; font-weight: bold"&gt;)&lt;/span&gt;&gt;Zmax&lt;span style="color: #AA22FF; font-weight: bold"&gt;)&lt;/span&gt; &lt;span style="color: #B8860B"&gt;YesInc&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;1
            &lt;span style="color: #AA22FF; font-weight: bold"&gt;for&lt;/span&gt;&lt;span style="color: #666666"&gt;(&lt;/span&gt;&lt;span style="color: #B8860B"&gt;i&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;2; i&lt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;Nsit; i++&lt;span style="color: #666666"&gt;)&lt;/span&gt; &lt;span style="color: #666666"&gt;{&lt;/span&gt;
                getline; Atom&lt;span style="color: #666666"&gt;[&lt;/span&gt;i&lt;span style="color: #666666"&gt;]=&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$0&lt;/span&gt;
                &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt;&lt;span style="color: #666666"&gt;(&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;$(&lt;/span&gt;NF-Ncol&lt;span style="color: #AA22FF; font-weight: bold"&gt;)&lt;/span&gt;&lt;Zmin &lt;span style="color: #666666"&gt;||&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;$(&lt;/span&gt;NF-Ncol&lt;span style="color: #AA22FF; font-weight: bold"&gt;)&lt;/span&gt;&gt;Zmax&lt;span style="color: #666666"&gt;)&lt;/span&gt; &lt;span style="color: #B8860B"&gt;YesInc&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;1
            &lt;span style="color: #666666"&gt;}&lt;/span&gt;
            &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt;&lt;span style="color: #666666"&gt;(&lt;/span&gt;YesInc&lt;span style="color: #666666"&gt;)&lt;/span&gt; &lt;span style="color: #666666"&gt;{&lt;/span&gt;
                Ntot +&lt;span style="color: #666666"&gt;=&lt;/span&gt; Nsit
                &lt;span style="color: #AA22FF; font-weight: bold"&gt;for&lt;/span&gt;&lt;span style="color: #666666"&gt;(&lt;/span&gt;&lt;span style="color: #B8860B"&gt;i&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;1; i&lt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;Nsit; i++&lt;span style="color: #666666"&gt;)&lt;/span&gt; print Atom&lt;span style="color: #666666"&gt;[&lt;/span&gt;i&lt;span style="color: #666666"&gt;]&lt;/span&gt; &gt;&lt;span style="color: #BB4444"&gt;"_Wat.gro"&lt;/span&gt;
            &lt;span style="color: #666666"&gt;}&lt;/span&gt;
        &lt;span style="color: #666666"&gt;}&lt;/span&gt;
        END&lt;span style="color: #666666"&gt;{&lt;/span&gt;print Ntot&lt;span style="color: #666666"&gt;}&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;'&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$F&lt;/span&gt;ile&lt;span style="color: #666666"&gt;)&lt;/span&gt;</p>
<p>&lt;span style="color: #008800; font-style: italic"&gt;# 组合文件&lt;/span&gt;
head -n &lt;span style="color: #666666"&gt;1&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$F&lt;/span&gt;ile       &gt; &lt;span style="color: #B8860B"&gt;$F&lt;/span&gt;out
&lt;span style="color: #AA22FF"&gt;echo&lt;/span&gt; $Ntot            &gt;&gt;&lt;span style="color: #B8860B"&gt;$F&lt;/span&gt;out
cat _Lip.gro _Wat.gro &gt;&gt;&lt;span style="color: #B8860B"&gt;$F&lt;/span&gt;out
tail -n &lt;span style="color: #666666"&gt;1&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$F&lt;/span&gt;ile       &gt;&gt;&lt;span style="color: #B8860B"&gt;$F&lt;/span&gt;out</p>
<p>&lt;span style="color: #008800; font-style: italic"&gt;# 使用gmx工具重新设定分子, 原子编号&lt;/span&gt;
gmx editconf -f &lt;span style="color: #B8860B"&gt;$F&lt;/span&gt;out -o &lt;span style="color: #B8860B"&gt;$F&lt;/span&gt;out</p>
<p>&lt;span style="color: #008800; font-style: italic"&gt;# 删除临时文件&lt;/span&gt;
rm -rf _Lip.gro _Wat.gro</p>
<p>&lt;span style="color: #AA22FF"&gt;echo&lt;/span&gt; &lt;span style="color: #BB4444"&gt;'&lt;/span&gt;保留水分子数目: &lt;span style="color: #BB4444"&gt;'&lt;/span&gt; $&lt;span style="color: #666666"&gt;[(&lt;/span&gt;$Ntot-$Natm&lt;span style="color: #666666"&gt;)&lt;/span&gt;/$Nsit&lt;span style="color: #666666"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p>
<h3>tcl脚本</h3>
<p>此脚本在VMD中使用, 自动计算所需的z坐标极值.</p>
<p>&lt;table class="highlighttable"&gt;&lt;th colspan="2" style="text-align:left"&gt;rmwat.tcl&lt;/th&gt;&lt;tr&gt;&lt;td&gt;&lt;div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"&gt;&lt;pre style="line-height: 125%"&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%"&gt;&lt;span style="color: #008800; font-style: italic"&gt;#remove water molecular near lipids within refered distance&lt;/span&gt;
&lt;span style="color: #AA22FF; font-weight: bold"&gt;proc&lt;/span&gt; rmwat &lt;span style="color: #AA22FF; font-weight: bold"&gt;{&lt;/span&gt;&lt;span style="color: #B8860B"&gt;lipres&lt;/span&gt; dz&lt;span style="color: #AA22FF; font-weight: bold"&gt;}&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;{&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; lip &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #B8860B"&gt;atomselect&lt;/span&gt; top &lt;span style="color: #BB4444"&gt;"resname $lipres"&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; lipbox &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #B8860B"&gt;measure&lt;/span&gt; minmax &lt;span style="color: #B8860B"&gt;$lip&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; xmin &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$lipbox&lt;/span&gt; &lt;span style="color: #666666"&gt;0&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;]&lt;/span&gt; &lt;span style="color: #666666"&gt;0&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; xmax &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$lipbox&lt;/span&gt; &lt;span style="color: #666666"&gt;1&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;]&lt;/span&gt; &lt;span style="color: #666666"&gt;0&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; ymin &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$lipbox&lt;/span&gt; &lt;span style="color: #666666"&gt;0&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;]&lt;/span&gt; &lt;span style="color: #666666"&gt;1&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; ymax &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$lipbox&lt;/span&gt; &lt;span style="color: #666666"&gt;1&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;]&lt;/span&gt; &lt;span style="color: #666666"&gt;1&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; zmin &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$lipbox&lt;/span&gt; &lt;span style="color: #666666"&gt;0&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;]&lt;/span&gt; &lt;span style="color: #666666"&gt;2&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; zmax &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;lindex&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$lipbox&lt;/span&gt; &lt;span style="color: #666666"&gt;1&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;]&lt;/span&gt; &lt;span style="color: #666666"&gt;2&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; zmin &lt;span style="color: #AA22FF; font-weight: bold"&gt;[expr&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$zmin&lt;/span&gt;&lt;span style="color: #666666"&gt;+&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$dz&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; zmax &lt;span style="color: #AA22FF; font-weight: bold"&gt;[expr&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$zmax-$dz&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; selA &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #B8860B"&gt;atomselect&lt;/span&gt; top &lt;span style="color: #BB4444"&gt;"same residue as water and z&gt;$zmin and z&lt;$zmax"&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;]&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; selB &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #B8860B"&gt;atomselect&lt;/span&gt; top &lt;span style="color: #BB4444"&gt;"all not {same residue as water and z&gt;$zmin and z&lt;$zmax}"&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;]&lt;/span&gt;
    &lt;span style="color: #AA22FF"&gt;puts&lt;/span&gt; &lt;span style="color: #BB4444"&gt;"all not {same residue as water and z&gt;$zmin and z&lt;$zmax}"&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; rmwatlen &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;llength&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$selA&lt;/span&gt; &lt;span style="color: #B8860B"&gt;get&lt;/span&gt; resid&lt;span style="color: #AA22FF; font-weight: bold"&gt;]];&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; rmwatnum &lt;span style="color: #AA22FF; font-weight: bold"&gt;[expr&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$rmwatlen&lt;/span&gt;&lt;span style="color: #666666"&gt;/3&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;</p>
<pre><code>&lt;span style="color: #AA22FF"&gt;puts&lt;/span&gt; &lt;span style="color: #BB4444"&gt;&amp;quot;remove water atom is $rmwatlen, and molecular is $rmwatnum&amp;quot;&lt;/span&gt;
&lt;span style="color: #B8860B"&gt;$selB&lt;/span&gt; &lt;span style="color: #B8860B"&gt;writepdb&lt;/span&gt; rmWat.pdb

&lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; all &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #B8860B"&gt;atomselect&lt;/span&gt; top water&lt;span style="color: #AA22FF; font-weight: bold"&gt;]&lt;/span&gt;
&lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; allwat &lt;span style="color: #AA22FF; font-weight: bold"&gt;[expr&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;llength&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$all&lt;/span&gt; &lt;span style="color: #B8860B"&gt;get&lt;/span&gt; resid&lt;span style="color: #AA22FF; font-weight: bold"&gt;]]&lt;/span&gt;&lt;span style="color: #666666"&gt;/3&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;

&lt;span style="color: #AA22FF; font-weight: bold"&gt;set&lt;/span&gt; rmwatnum &lt;span style="color: #AA22FF; font-weight: bold"&gt;[expr&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$allwat-$rmwatnum&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;];&lt;/span&gt;
&lt;span style="color: #AA22FF"&gt;puts&lt;/span&gt; &lt;span style="color: #BB4444"&gt;&amp;quot;Original water molecules number is $allwat&amp;quot;&lt;/span&gt;
&lt;span style="color: #AA22FF"&gt;puts&lt;/span&gt; &lt;span style="color: #BB4444"&gt;&amp;quot;Water molecules left $rmwatnum&amp;quot;&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;;&lt;/span&gt;
</code></pre>
<p>&lt;span style="color: #AA22FF; font-weight: bold"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p>
<h3>增大水相z方向的尺寸(此shell脚本效率较低, 只有存档意义, 不建议使用)</h3>
<p>假定双层膜体系垂直于z轴延展, 其法向沿z轴, Chirs Neale提供了一个方法用以去除不需要的水分子. 具体操作如下(如果需要, 可以修改第41行使脚本适用于x/y/z方向延展的体系):</p>
<ol>
<li>对初始双层膜构型<code>initial.gro</code>运行<code>genbox</code>命令, 得到<code>solvated.gro</code>;</li>
<li><code>cp solvate.gro new_waters.gro</code>;</li>
<li>使用文本编辑器删除<code>new_waters.gro</code>中除第一步新添加的水之外的内容(若初始构型<code>initial.gro</code>中含有水分子, 这些水分子也要删去). 在vim中删除多行可以用指令<code>ndd</code>, <code>n</code>为行数;</li>
<li>修改脚本<code>keepbyz.sh</code>中的<code>upperz</code>和<code>lowerz</code>参数为需要的值, 并将<code>sol</code>参数改为溶剂分子的名称(<code>upperz</code>和<code>lowerz</code>分别为双层膜上下边界的z轴坐标, 注意脂质分子的头基周围需要保留一定数目的水分子, 所以请选择合适的值. <code>sol</code>对应溶剂分子的名称, 默认为<code>SOL</code>)</li>
<li>执行<code>chmod +x keepbyz.sh</code>确保脚本可执行, 然后运行<code>./keepbyz.sh new_waters.gro &gt; keep_these_waters.gro</code>;</li>
<li>运行<code>tail -1 initial.gro &gt; last_line.gro</code>获取盒子信息;</li>
<li><code>head -$(expr $(cat initial.gro | wc -l | awk '{print $1}') - 1 ) initial.gro &gt; not_last_line.gro</code>;</li>
<li><code>cat not_last_line.gro keep_these_waters.gro last_line.gro &gt; new_system.gro</code>; 手动修改<code>new_system.gro</code>中的原子数目, 使其与体系的总原子数目相等;</li>
<li><code>editconf -f new_system.gro -o new_system_sequential_numbers.gro</code>; (5.0以后版本中使用<code>gmx editconf</code>); 修改拓扑文件, 确保与gro中的分子数一致.</li>
</ol>
<p><code>keepbyz.sh</code>脚本内容如下:</p>
<p>&lt;table class="highlighttable"&gt;&lt;th colspan="2" style="text-align:left"&gt;keepbyz.sh&lt;/th&gt;&lt;tr&gt;&lt;td&gt;&lt;div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"&gt;&lt;pre style="line-height: 125%"&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%"&gt;&lt;span style="color: #008800; font-style: italic"&gt;#!/bin/bash&lt;/span&gt;
&lt;span style="color: #008800; font-style: italic"&gt;# give x.gro as first command line arguement&lt;/span&gt;
&lt;span style="color: #B8860B"&gt;upperz&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;6.417
&lt;span style="color: #B8860B"&gt;lowerz&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;0.820
&lt;span style="color: #B8860B"&gt;sol&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;SOL
&lt;span style="color: #B8860B"&gt;count&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;0
cat &lt;span style="color: #B8860B"&gt;$1&lt;/span&gt; | grep &lt;span style="color: #BB4444"&gt;"&lt;/span&gt;$&lt;span style="color: #BB4444"&gt;sol"&lt;/span&gt; | &lt;span style="color: #AA22FF; font-weight: bold"&gt;while&lt;/span&gt; &lt;span style="color: #AA22FF"&gt;read&lt;/span&gt; line; &lt;span style="color: #AA22FF; font-weight: bold"&gt;do&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;for&lt;/span&gt; first in $line; &lt;span style="color: #AA22FF; font-weight: bold"&gt;do&lt;/span&gt;
        &lt;span style="color: #AA22FF"&gt;break&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;done&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt; &lt;span style="color: #666666"&gt;[&lt;/span&gt; &lt;span style="color: #BB4444"&gt;"&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$c&lt;/span&gt;&lt;span style="color: #BB4444"&gt;ount"&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #666666"&gt;3&lt;/span&gt; &lt;span style="color: #666666"&gt;]&lt;/span&gt;; &lt;span style="color: #AA22FF; font-weight: bold"&gt;then&lt;/span&gt;
        &lt;span style="color: #B8860B"&gt;count&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;0
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;fi&lt;/span&gt;
    &lt;span style="color: #B8860B"&gt;count&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;$(&lt;/span&gt;expr &lt;span style="color: #B8860B"&gt;$c&lt;/span&gt;ount + 1&lt;span style="color: #AA22FF; font-weight: bold"&gt;)&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt; &lt;span style="color: #666666"&gt;[&lt;/span&gt; &lt;span style="color: #BB4444"&gt;"&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$c&lt;/span&gt;&lt;span style="color: #BB4444"&gt;ount"&lt;/span&gt; !&lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #666666"&gt;1&lt;/span&gt; &lt;span style="color: #666666"&gt;]&lt;/span&gt;; &lt;span style="color: #AA22FF; font-weight: bold"&gt;then&lt;/span&gt;
        &lt;span style="color: #AA22FF; font-weight: bold"&gt;continue&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;fi&lt;/span&gt;
    &lt;span style="color: #B8860B"&gt;l&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB6688; font-weight: bold"&gt;${#&lt;/span&gt;&lt;span style="color: #B8860B"&gt;line&lt;/span&gt;&lt;span style="color: #BB6688; font-weight: bold"&gt;}&lt;/span&gt;
    &lt;span style="color: #B8860B"&gt;m&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;$(&lt;/span&gt;expr $l - 24&lt;span style="color: #AA22FF; font-weight: bold"&gt;)&lt;/span&gt; &lt;span style="color: #008800; font-style: italic"&gt;# would use -48 if velocities are also in .gro and -24 otherwise. 如果gro文件中包含速度信息, 使用48&lt;/span&gt;
    &lt;span style="color: #B8860B"&gt;i&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;1
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;for&lt;/span&gt; word in &lt;span style="color: #BB6688; font-weight: bold"&gt;${&lt;/span&gt;&lt;span style="color: #B8860B"&gt;line&lt;/span&gt;:$&lt;span style="color: #B8860B"&gt;m&lt;/span&gt;&lt;span style="color: #BB6688; font-weight: bold"&gt;}&lt;/span&gt;; &lt;span style="color: #AA22FF; font-weight: bold"&gt;do&lt;/span&gt;
        &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt; &lt;span style="color: #666666"&gt;[&lt;/span&gt; &lt;span style="color: #BB4444"&gt;"&lt;/span&gt;$&lt;span style="color: #BB4444"&gt;i"&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #666666"&gt;1&lt;/span&gt; &lt;span style="color: #666666"&gt;]&lt;/span&gt;; &lt;span style="color: #AA22FF; font-weight: bold"&gt;then&lt;/span&gt;
            &lt;span style="color: #B8860B"&gt;popex&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;$word
        &lt;span style="color: #AA22FF; font-weight: bold"&gt;else&lt;/span&gt;
            &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt; &lt;span style="color: #666666"&gt;[&lt;/span&gt; &lt;span style="color: #BB4444"&gt;"&lt;/span&gt;$&lt;span style="color: #BB4444"&gt;i"&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #666666"&gt;2&lt;/span&gt; &lt;span style="color: #666666"&gt;]&lt;/span&gt;; &lt;span style="color: #AA22FF; font-weight: bold"&gt;then&lt;/span&gt;
                &lt;span style="color: #B8860B"&gt;popey&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;$word
            &lt;span style="color: #AA22FF; font-weight: bold"&gt;else&lt;/span&gt;
                &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt; &lt;span style="color: #666666"&gt;[&lt;/span&gt; &lt;span style="color: #BB4444"&gt;"&lt;/span&gt;$&lt;span style="color: #BB4444"&gt;i"&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #666666"&gt;3&lt;/span&gt; &lt;span style="color: #666666"&gt;]&lt;/span&gt;; &lt;span style="color: #AA22FF; font-weight: bold"&gt;then&lt;/span&gt;
                    &lt;span style="color: #B8860B"&gt;popez&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;$word
                    &lt;span style="color: #AA22FF"&gt;break&lt;/span&gt;
                &lt;span style="color: #AA22FF; font-weight: bold"&gt;fi&lt;/span&gt;
            &lt;span style="color: #AA22FF; font-weight: bold"&gt;fi&lt;/span&gt;
        &lt;span style="color: #AA22FF; font-weight: bold"&gt;fi&lt;/span&gt;
        &lt;span style="color: #B8860B"&gt;i&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;$(&lt;/span&gt;expr $i + 1&lt;span style="color: #AA22FF; font-weight: bold"&gt;)&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;done&lt;/span&gt;
    &lt;span style="color: #B8860B"&gt;nolx&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;`&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;echo&lt;/span&gt; &lt;span style="color: #BB4444"&gt;"&lt;/span&gt;$&lt;span style="color: #BB4444"&gt;popez &gt; &lt;/span&gt;$&lt;span style="color: #BB4444"&gt;upperz"&lt;/span&gt; | bc&lt;span style="color: #BB4444"&gt;`&lt;/span&gt;
    &lt;span style="color: #B8860B"&gt;nohx&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;`&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;echo&lt;/span&gt; &lt;span style="color: #BB4444"&gt;"&lt;/span&gt;$&lt;span style="color: #BB4444"&gt;popez &lt; &lt;/span&gt;$&lt;span style="color: #BB4444"&gt;lowerz"&lt;/span&gt; | bc&lt;span style="color: #BB4444"&gt;`&lt;/span&gt;
    &lt;span style="color: #B8860B"&gt;myno&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;$(&lt;/span&gt;expr $nolx + $nohx&lt;span style="color: #AA22FF; font-weight: bold"&gt;)&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt; &lt;span style="color: #666666"&gt;[&lt;/span&gt; &lt;span style="color: #BB4444"&gt;"&lt;/span&gt;$&lt;span style="color: #BB4444"&gt;myno"&lt;/span&gt; !&lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #666666"&gt;0&lt;/span&gt; &lt;span style="color: #666666"&gt;]&lt;/span&gt;; &lt;span style="color: #AA22FF; font-weight: bold"&gt;then&lt;/span&gt;
        &lt;span style="color: #B8860B"&gt;z&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB6688; font-weight: bold"&gt;${#&lt;/span&gt;&lt;span style="color: #B8860B"&gt;first&lt;/span&gt;&lt;span style="color: #BB6688; font-weight: bold"&gt;}&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt; &lt;span style="color: #666666"&gt;[&lt;/span&gt; &lt;span style="color: #BB4444"&gt;"&lt;/span&gt;$&lt;span style="color: #BB4444"&gt;z"&lt;/span&gt; !&lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #666666"&gt;8&lt;/span&gt; &lt;span style="color: #666666"&gt;]&lt;/span&gt;; &lt;span style="color: #AA22FF; font-weight: bold"&gt;then&lt;/span&gt;
        &lt;span style="color: #B8860B"&gt;sfirst&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;"[[:space:]]&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$f&lt;/span&gt;&lt;span style="color: #BB4444"&gt;irst"&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;else&lt;/span&gt;
        &lt;span style="color: #B8860B"&gt;sfirst&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$f&lt;/span&gt;irst
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;fi&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;`&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;echo&lt;/span&gt; grep $sfirst &lt;span style="color: #B8860B"&gt;$1&lt;/span&gt;&lt;span style="color: #BB4444"&gt;`&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;fi&lt;/span&gt;
&lt;span style="color: #AA22FF; font-weight: bold"&gt;done&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
脚本中默认使用3位点的水分子模型, 若使用TIP4P水模型, 则应将</p>
<pre><code>if [ "$count" = 3 ]; then
    count=0
fi
</code></pre>
<p>修改为:</p>
<pre><code>if [ "$count" = 4 ]; then
    count=0
fi
</code></pre>
<p>同理, 使用TIP5P水模型时应修改为5.</p>
<p>为提高效率, 该脚本的作者还提供了一个同样功能的C程序. 所用水模型的位点数通过命令行参数指定, 但你仍然需要修改接近底部的源代码, 指定自己的选择标准, 并使用<code>-24</code>或<code>-48</code>来指定你的gro文件是否包含速度.</p>
<p>&lt;table class="highlighttable"&gt;&lt;th colspan="2" style="text-align:left"&gt;keepbyz.c&lt;/th&gt;&lt;tr&gt;&lt;td&gt;&lt;div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"&gt;&lt;pre style="line-height: 125%"&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%"&gt;&lt;span style="color: #008800"&gt;#include&lt;/span&gt; &lt;span style="color: #008800; font-style: italic"&gt;&lt;stdio.h&gt;&lt;/span&gt;&lt;span style="color: #008800"&gt;&lt;/span&gt;
&lt;span style="color: #008800"&gt;#include&lt;/span&gt; &lt;span style="color: #008800; font-style: italic"&gt;&lt;stdlib.h&gt;&lt;/span&gt;&lt;span style="color: #008800"&gt;&lt;/span&gt;
&lt;span style="color: #008800"&gt;#include&lt;/span&gt; &lt;span style="color: #008800; font-style: italic"&gt;"string.h"&lt;/span&gt;&lt;span style="color: #008800"&gt;&lt;/span&gt;</p>
<p>&lt;span style="color: #008800"&gt;#define LINE_SIZE 1000&lt;/span&gt;</p>
<p>&lt;span style="color: #00BB00; font-weight: bold"&gt;void&lt;/span&gt; &lt;span style="color: #00A000"&gt;showUsage&lt;/span&gt;(&lt;span style="color: #AA22FF; font-weight: bold"&gt;const&lt;/span&gt; &lt;span style="color: #00BB00; font-weight: bold"&gt;char&lt;/span&gt; &lt;span style="color: #666666"&gt;*&lt;/span&gt;c){
    printf(&lt;span style="color: #BB4444"&gt;"Usage: %s &lt;solvent.gro&gt; &lt;numAtomsInWaterMolecule&gt;&lt;/span&gt;&lt;span style="color: #BB6622; font-weight: bold"&gt;\n&lt;/span&gt;&lt;span style="color: #BB4444"&gt;"&lt;/span&gt;,c);
    printf(&lt;span style="color: #BB4444"&gt;"                                (e.g. 3 for TIP3P, 4 for TIP4P)&lt;/span&gt;&lt;span style="color: #BB6622; font-weight: bold"&gt;\n&lt;/span&gt;&lt;span style="color: #BB4444"&gt;"&lt;/span&gt;);
}</p>
<p>&lt;span style="color: #00BB00; font-weight: bold"&gt;int&lt;/span&gt; &lt;span style="color: #00A000"&gt;main&lt;/span&gt;(&lt;span style="color: #00BB00; font-weight: bold"&gt;int&lt;/span&gt; argn, &lt;span style="color: #00BB00; font-weight: bold"&gt;char&lt;/span&gt; &lt;span style="color: #666666"&gt;*&lt;/span&gt;args[]){
    &lt;span style="color: #00BB00; font-weight: bold"&gt;FILE&lt;/span&gt; &lt;span style="color: #666666"&gt;*&lt;/span&gt;mf;
    &lt;span style="color: #00BB00; font-weight: bold"&gt;char&lt;/span&gt; &lt;span style="color: #666666"&gt;*&lt;/span&gt;c;
    &lt;span style="color: #00BB00; font-weight: bold"&gt;char&lt;/span&gt; linein[LINE_SIZE];
    &lt;span style="color: #00BB00; font-weight: bold"&gt;float&lt;/span&gt; mx,my,mz;
    &lt;span style="color: #00BB00; font-weight: bold"&gt;int&lt;/span&gt; count,keep;
    &lt;span style="color: #00BB00; font-weight: bold"&gt;int&lt;/span&gt; atomInWater;</p>
<pre><code>&lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt;(argn&lt;span style="color: #666666"&gt;!=3&lt;/span&gt;){
    showUsage(args[&lt;span style="color: #666666"&gt;0&lt;/span&gt;]);
    exit(&lt;span style="color: #666666"&gt;1&lt;/span&gt;);
}
&lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt;(sscanf(args[&lt;span style="color: #666666"&gt;2&lt;/span&gt;],&lt;span style="color: #BB4444"&gt;&amp;quot;%d&amp;quot;&lt;/span&gt;,&lt;span style="color: #666666"&gt;&amp;amp;&lt;/span&gt;atomInWater)&lt;span style="color: #666666"&gt;!=1&lt;/span&gt;){
    printf(&lt;span style="color: #BB4444"&gt;&amp;quot;error: unable to determine number of atoms in the water model&lt;/span&gt;&lt;span style="color: #BB6622; font-weight: bold"&gt;\n&lt;/span&gt;&lt;span style="color: #BB4444"&gt;&amp;quot;&lt;/span&gt;);
    showUsage(args[&lt;span style="color: #666666"&gt;0&lt;/span&gt;]);
    exit(&lt;span style="color: #666666"&gt;1&lt;/span&gt;);
}

mf&lt;span style="color: #666666"&gt;=&lt;/span&gt;fopen(args[&lt;span style="color: #666666"&gt;1&lt;/span&gt;],&lt;span style="color: #BB4444"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;);
&lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt;(mf&lt;span style="color: #666666"&gt;==&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;NULL&lt;/span&gt;){
    printf(&lt;span style="color: #BB4444"&gt;&amp;quot;error: unable to open the membrane file %s&lt;/span&gt;&lt;span style="color: #BB6622; font-weight: bold"&gt;\n&lt;/span&gt;&lt;span style="color: #BB4444"&gt;&amp;quot;&lt;/span&gt;,args[&lt;span style="color: #666666"&gt;1&lt;/span&gt;]);
    exit(&lt;span style="color: #666666"&gt;1&lt;/span&gt;);
}

count&lt;span style="color: #666666"&gt;=0&lt;/span&gt;;
keep&lt;span style="color: #666666"&gt;=0&lt;/span&gt;;
&lt;span style="color: #AA22FF; font-weight: bold"&gt;while&lt;/span&gt;(fgets(linein,LINE_SIZE,mf)&lt;span style="color: #666666"&gt;!=&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;NULL&lt;/span&gt;){
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt;(count&lt;span style="color: #666666"&gt;==&lt;/span&gt;atomInWater){
        count&lt;span style="color: #666666"&gt;=0&lt;/span&gt;;
        keep&lt;span style="color: #666666"&gt;=0&lt;/span&gt;;
    }
    count&lt;span style="color: #666666"&gt;++&lt;/span&gt;;
    c&lt;span style="color: #666666"&gt;=&amp;amp;&lt;/span&gt;linein[strlen(linein)&lt;span style="color: #666666"&gt;-24&lt;/span&gt;];           &lt;span style="color: #008800; font-style: italic"&gt;// would use -48 if velocities are also in .gro and -24 otherwise&lt;/span&gt;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt;(sscanf(c,&lt;span style="color: #BB4444"&gt;&amp;quot;%f %f %f&amp;quot;&lt;/span&gt;,&lt;span style="color: #666666"&gt;&amp;amp;&lt;/span&gt;mx,&lt;span style="color: #666666"&gt;&amp;amp;&lt;/span&gt;my,&lt;span style="color: #666666"&gt;&amp;amp;&lt;/span&gt;mz)&lt;span style="color: #666666"&gt;!=3&lt;/span&gt;) &lt;span style="color: #AA22FF; font-weight: bold"&gt;continue&lt;/span&gt;;
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt;(count&lt;span style="color: #666666"&gt;==1&lt;/span&gt;){
        &lt;span style="color: #008800; font-style: italic"&gt;//Add your selection terms here to set keep=1 when you want to keep that particular solvent&lt;/span&gt;
        &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt;(mz&lt;span style="color: #666666"&gt;&amp;lt;7.0&lt;/span&gt;){
            keep&lt;span style="color: #666666"&gt;=1&lt;/span&gt;;
        }
    }
    &lt;span style="color: #AA22FF; font-weight: bold"&gt;if&lt;/span&gt;(keep)printf(&lt;span style="color: #BB4444"&gt;&amp;quot;%s&amp;quot;&lt;/span&gt;,linein);
}
fclose(mf);
</code></pre>
<p>}
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p>
<h2>外部链接</h2>
<ul>
<li>膜模拟(Erik Lindahl) <a href="https://extras.csc.fi/chem/courses/gmx2007/Erik_Talks/membrane_simulations.pdf">幻灯片</a>, <a href="http://tv.funet.fi/medar/showRecordingInfo.do?id=/metadata/fi/csc/courses/gromacs_workshop_2007/SpeedingupSimulationsAlgorithmsApplications.xml">视频</a></li>
<li>膜蛋白模拟(Phil Biggin, Bert de Groot) <a href="http://www.dddc.ac.cn/embo04/lectures/Biggin/membprot.ppt">幻灯片</a>, <a href="http://www.dddc.ac.cn/embo04/dv.php?dv_name=embo-2004-09-16-Biggin.wmv">Biggin的视频</a> <a href="http://www.dddc.ac.cn/embo04/dv.php?dv_name=embo-2004-09-16-groot.WMV">de Groot的视频</a></li>
<li>蛋白膜相关. 理论模型, Lekner加和(André Juffer) <a href="http://www.csc.fi/english/research/sciences/chemistry/courses/gmx2004/protein-membrane.ppt">幻灯片</a>, <a href="http://rm.tv.funet.fi:8080/ramgen/fi/csc/kurssit/2004/gromacs/gromacs07.rm">视频</a></li>
<li><a href="http://www.dddc.ac.cn/embo04/practicals/9_16.htm">GROMACS膜蛋白模拟教程</a>, 用于演示当模拟嵌入脂质双层中的蛋白质时会遇到那些问题.</li>
<li><a href="http://www.pomeslab.com/files/lipidCombinationRules.pdf">组合OPLS-AA力场和Berger脂质</a>, 目的, 方法和测试的详细说明.</li>
<li><a href="http://www.bioinf.uni-sb.de/RB/">膜蛋白与不同力场GAFF, CHARMM BERGER的一些拓扑</a> Shirley W. I. Siu, Robert Vacha, Pavel Jungwirth, Rainer A. Böckmann: Biomolecular simulations of membranes: Physical properties from different force fields.</li>
<li><a href="http://lipidbook.bioch.ox.ac.uk/">Lipidbook</a>提供了膜以及膜蛋白模拟中用到的脂质, 活性剂以及其他分子的力场参数. 相关论文: J. Domański, P. Stansfeld, M.S.P. Sansom, and O. Beckstein. J. Membrane Biol. 236 (2010), 255-258. <a href="http://dx.doi.org/10.1007/s00232-010-9296-8">doi:10.1007/s00232-010-9296-8</a>.</li>
</ul>
<h2>评论</h2>
<ul>
<li>2017-04-21 20:34:19 <code>luyisi</code> 李老师，第一个脚本18行少了个分号呢。(笑)</li>
<li>2017-04-22 12:20:30 <code>Jerkwin</code> 谢谢指出错误. 已经修正.</li>
</ul>
