<h2><a href="https://github.com/jerkwin/jerkwin.github.io//blob/master/_posts/2025-04-07-借助HTML文件整理Word文档.md">仓库源文</a>，<a href="https://jerkwin.github.io/2025/04/07/借助HTML文件整理Word文档">站点原文</a></h2>
<ul>
<li>2025-04-07 19:06:48</li>
</ul>
<p>近日遇到一个需求, 要将一些图片按一定要求放到Word文档中. 这些图片格式不统一, 有pdf, 有png, 有jpg. 宽高也各不同, 但要求图片横向放置, 每页一张. 当然, 如果手动操作, 就没有必要记录作法了.</p>
<p>将问题分解一下, 有下列步骤:</p>
<ol>
<li>将pdf转换为图片: 可以借助<code>xpdf-tools</code>中的<code>pdftopng</code></li>
<li>如果图片高&gt;宽, 旋转图片: 可以借助<code>ImageMagick</code></li>
<li>将图片写到html文件中: 使用Word支持的格式</li>
<li>使用Word打开html文件, 断开链接, 嵌入图片.另存为Word格式</li>
</ol>
<p>前两步没有什么要说的.</p>
<p>Word支持的html文件与常规的有所不同, 具体哪些地方不同, 也没有必要仔细研究, 直接将一份简单的Word文件另存为html格式看看就可以知晓了. 我们的需求比较简单, 所以只需要保留其中重要的相关设置, 所得模板如下</p>
&lt;table class="highlighttable"&gt;&lt;th colspan="2" style="text-align:left"&gt;html&lt;/th&gt;&lt;tr&gt;&lt;td&gt;&lt;div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"&gt;&lt;pre style="line-height:125%"&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre style="line-height:125%"&gt;&lt;span&gt;&lt;/span&gt;&lt;&lt;span style="color: #008000; font-weight: bold"&gt;style&lt;/span&gt;&gt;
&lt;span style="color: #AA22FF; font-weight: bold"&gt;@page&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;WordSection1&lt;/span&gt; {
    &lt;span style="color: #008000; font-weight: bold"&gt;size&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;:297mm&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;210mm&lt;/span&gt;&lt;span style="color: #666666"&gt;;&lt;/span&gt;
    &lt;span style="color: #008000; font-weight: bold"&gt;margin&lt;/span&gt;&lt;span style="color: #666666"&gt;:&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;12&lt;/span&gt;&lt;span style="color: #0000FF"&gt;.7mm&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;12&lt;/span&gt;&lt;span style="color: #0000FF"&gt;.7mm&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;12&lt;/span&gt;&lt;span style="color: #0000FF"&gt;.7mm&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;12&lt;/span&gt;&lt;span style="color: #0000FF"&gt;.7mm&lt;/span&gt;&lt;span style="color: #666666"&gt;;&lt;/span&gt;
    &lt;span style="color: #008000; font-weight: bold"&gt;mso-page-orientation&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;:landscape&lt;/span&gt;&lt;span style="color: #666666"&gt;;&lt;/span&gt;
    &lt;span style="color: #008000; font-weight: bold"&gt;mso-header-margin&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;:42&lt;/span&gt;&lt;span style="color: #0000FF"&gt;.55pt&lt;/span&gt;&lt;span style="color: #666666"&gt;;&lt;/span&gt;
    &lt;span style="color: #008000; font-weight: bold"&gt;mso-footer-margin&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;:49&lt;/span&gt;&lt;span style="color: #0000FF"&gt;.6pt&lt;/span&gt;&lt;span style="color: #666666"&gt;;&lt;/span&gt;
    &lt;span style="color: #008000; font-weight: bold"&gt;mso-paper-source&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;:0&lt;/span&gt;&lt;span style="color: #666666"&gt;;&lt;/span&gt;
}
&lt;span style="color: #008000; font-weight: bold"&gt;div&lt;/span&gt;&lt;span style="color: #0000FF"&gt;.WordSection1&lt;/span&gt; {&lt;span style="color: #AA22FF"&gt;page&lt;/span&gt;&lt;span style="color: #666666"&gt;:&lt;/span&gt;WordSection1;}
&lt;/&lt;span style="color: #008000; font-weight: bold"&gt;style&lt;/span&gt;&gt;

&lt;&lt;span style="color: #008000; font-weight: bold"&gt;body&lt;/span&gt;&gt;
&lt;&lt;span style="color: #008000; font-weight: bold"&gt;div&lt;/span&gt; &lt;span style="color: #BB4444"&gt;class&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;WordSection1&lt;/span&gt; &lt;span style="color: #BB4444"&gt;align&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;center&lt;/span&gt; &lt;span style="color: #BB4444"&gt;style&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;'text-align:center&lt;/span&gt;&lt;span style="#FF0000"&gt;'&lt;/span&gt;&gt;

&lt;&lt;span style="color: #008000; font-weight: bold"&gt;img&lt;/span&gt; &lt;span style="color: #BB4444"&gt;width&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;996&lt;/span&gt; &lt;span style="color: #BB4444"&gt;height&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;702&lt;/span&gt; &lt;span style="color: #BB4444"&gt;src&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;"1.png"&lt;/span&gt;&gt;
&lt;&lt;span style="color: #008000; font-weight: bold"&gt;img&lt;/span&gt; &lt;span style="color: #BB4444"&gt;width&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;996&lt;/span&gt; &lt;span style="color: #BB4444"&gt;height&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;702&lt;/span&gt; &lt;span style="color: #BB4444"&gt;src&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB4444"&gt;"2.jpg"&lt;/span&gt;&gt;

&lt;/&lt;span style="color: #008000; font-weight: bold"&gt;div&lt;/span&gt;&gt;
&lt;/&lt;span style="color: #008000; font-weight: bold"&gt;body&lt;/span&gt;&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;<p>可以看到, Word可以识别html文件中自定义的页面设置, 其中可以设置页面大小, 页边距, 页面方向等. 这些设置浏览器未必支持. 需要注意的是, 其中的图片大小, 只能以像素为单位, 且默认根据96dpi计算.</p>
<p>使用Word打开这样的html文件, 可以看到图片, 但只是链接. 如果将Word文件转移到其他位置, 图片就无法显示了. 因此, 我们还需要将图片嵌入Word文件中. 对于Word2016, 依次</p>
<p><code>文件 | 信息 | 相关文档 | 编辑指向文件的链接</code></p>
<p>然后</p>
<p><code>全选 | 断开链接 | 将图片保存在文档中 | 确定</code>.</p>
<p><img alt="" src="https://jerkwin.github.io/pic/html2word.png"/></p>
<h2>脚本</h2>
<p>将上面的步骤总结为下面的脚本, 处理起大量的文件来就更容易了.</p>
&lt;table class="highlighttable"&gt;&lt;th colspan="2" style="text-align:left"&gt;img2doc.bsh&lt;/th&gt;&lt;tr&gt;&lt;td&gt;&lt;div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"&gt;&lt;pre style="line-height:125%"&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre style="line-height:125%"&gt;&lt;span&gt;&lt;/span&gt;&lt;span style="color: #008800; font-style: italic"&gt;# 定义程序路径&lt;/span&gt;
&lt;span style="color: #B8860B"&gt;im&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;/D/ImageMagick-7.1.1-19-Q16-HDRI
&lt;span style="color: #B8860B"&gt;xpdf&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;/D/PDFtools/xpdf-tools-4.05/bin

&lt;span style="color: #008800; font-style: italic"&gt;# 先将pdf转换为相应的png文件&lt;/span&gt;
&lt;span style="color: #AA22FF; font-weight: bold"&gt;for&lt;/span&gt; pdf in *.pdf; &lt;span style="color: #AA22FF; font-weight: bold"&gt;do&lt;/span&gt;
    &lt;span style="color: #B8860B"&gt;name&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB6688; font-weight: bold"&gt;${&lt;/span&gt;&lt;span style="color: #B8860B"&gt;pdf&lt;/span&gt;%.pdf&lt;span style="color: #BB6688; font-weight: bold"&gt;}&lt;/span&gt;
    &lt;span style="color: #B8860B"&gt;$xpdf&lt;/span&gt;/pdftopng.exe &lt;span style="color: #B8860B"&gt;$pdf&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$name&lt;/span&gt;
    mv &lt;span style="color: #B8860B"&gt;$name&lt;/span&gt;-000001.png &lt;span style="color: #B8860B"&gt;$name&lt;/span&gt;.png
&lt;span style="color: #AA22FF; font-weight: bold"&gt;done&lt;/span&gt;

&lt;span style="color: #008800; font-style: italic"&gt;# 根据宽高旋转图片&lt;/span&gt;
mkdir -p backup
&lt;span style="color: #AA22FF; font-weight: bold"&gt;for&lt;/span&gt; img in *.jpg *.png; &lt;span style="color: #AA22FF; font-weight: bold"&gt;do&lt;/span&gt;
    &lt;span style="color: #AA22FF"&gt;eval&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;$(&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$im&lt;/span&gt;/identify.exe -ping -format &lt;span style="color: #BB4444"&gt;'&lt;/span&gt;&lt;span style="color: #B8860B"&gt;w&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;%w; &lt;span style="color: #B8860B"&gt;h&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;%h;&lt;span style="color: #BB4444"&gt;'&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$img&lt;/span&gt;&lt;span style="color: #AA22FF; font-weight: bold"&gt;)&lt;/span&gt; &lt;span style="color: #008800; font-style: italic"&gt;# 获取宽高&lt;/span&gt;
    &lt;span style="color: #666666"&gt;[[&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$h&lt;/span&gt; &gt; &lt;span style="color: #B8860B"&gt;$w&lt;/span&gt; &lt;span style="color: #666666"&gt;]]&lt;/span&gt; &lt;span style="color: #666666"&gt;&amp;&amp;&lt;/span&gt; &lt;span style="color: #666666"&gt;{&lt;/span&gt;
        cp &lt;span style="color: #B8860B"&gt;$img&lt;/span&gt; ./backup/&lt;span style="color: #B8860B"&gt;$img&lt;/span&gt;
        &lt;span style="color: #B8860B"&gt;$im&lt;/span&gt;/convert.exe -rotate -90  ./backup/&lt;span style="color: #B8860B"&gt;$img&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$img&lt;/span&gt;
    &lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;span style="color: #AA22FF; font-weight: bold"&gt;done&lt;/span&gt;

&lt;span style="color: #008800; font-style: italic"&gt;# 输出图片及其编号&lt;/span&gt;
rm -f _img
&lt;span style="color: #AA22FF; font-weight: bold"&gt;for&lt;/span&gt; img in *.jpg *.png; &lt;span style="color: #AA22FF; font-weight: bold"&gt;do&lt;/span&gt;
    &lt;span style="color: #B8860B"&gt;idx&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB6688; font-weight: bold"&gt;${&lt;/span&gt;&lt;span style="color: #B8860B"&gt;img&lt;/span&gt;##*_&lt;span style="color: #BB6688; font-weight: bold"&gt;}&lt;/span&gt;; &lt;span style="color: #B8860B"&gt;idx&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BB6688; font-weight: bold"&gt;${&lt;/span&gt;&lt;span style="color: #B8860B"&gt;idx&lt;/span&gt;%.*&lt;span style="color: #BB6688; font-weight: bold"&gt;}&lt;/span&gt;
    &lt;span style="color: #AA22FF"&gt;echo&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$idx&lt;/span&gt; &lt;span style="color: #B8860B"&gt;$img&lt;/span&gt; &gt;&gt;_img
&lt;span style="color: #AA22FF; font-weight: bold"&gt;done&lt;/span&gt;

&lt;span style="color: #008800; font-style: italic"&gt;# 排序图片并输出到html文件&lt;/span&gt;
sort -n _img | awk &lt;span style="color: #BB4444"&gt;'&lt;/span&gt;
BEGIN &lt;span style="color: #666666"&gt;{&lt;/span&gt; print &lt;span style="color: #BB4444"&gt;"&lt;style&gt;"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n@page WordSection1 {"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n   size:297mm 210mm;"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n   margin: 12.7mm 12.7mm 12.7mm 12.7mm;"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n   mso-page-orientation:landscape;"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n   mso-header-margin:42.55pt;"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n   mso-footer-margin:49.6pt;"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n   mso-paper-source:0;}"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\ndiv.WordSection1 {page:WordSection1;}"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n&lt;/style&gt;"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n&lt;body&gt;"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n&lt;div class=WordSection1 align=center style=\"text-align:center\"&gt;"&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
    &lt;span style="color: #BB4444"&gt;"\n"&lt;/span&gt;
&lt;span style="color: #666666"&gt;}&lt;/span&gt;

&lt;span style="color: #666666"&gt;{&lt;/span&gt; print &lt;span style="color: #BB4444"&gt;"&lt;img width=996 height=702 src=\""&lt;/span&gt;&lt;span style="color: #B8860B"&gt;$2&lt;/span&gt;&lt;span style="color: #BB4444"&gt;"\"&gt;"&lt;/span&gt; &lt;span style="color: #666666"&gt;}&lt;/span&gt;

END &lt;span style="color: #666666"&gt;{&lt;/span&gt;print &lt;span style="color: #BB4444"&gt;"&lt;/div&gt;&lt;/body&gt;"&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;span style="color: #BB4444"&gt;'&lt;/span&gt; &gt;_.html&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;