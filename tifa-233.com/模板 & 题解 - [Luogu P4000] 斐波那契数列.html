<p>版权声明： 本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！</p>
<h2><a href="https://github.com/Tiphereth-A/Tiphereth-A.github.io/blob/master/source/_posts/luogu-p4000.md">仓库源文</a>，<a href="https://tifa-233.com/archives/luogu-p4000">站点原文</a></h2>
<hr/>
<p>title: "模板 &amp; 题解 - [Luogu P4000] 斐波那契数列"
categories:</p>
<ul>
<li>算法竞赛</li>
<li>模板
tags:</li>
<li>算法竞赛</li>
<li>题解</li>
<li>洛谷</li>
<li>模板</li>
<li>数学</li>
<li>数论</li>
<li>Fibonacci数列</li>
<li>Lucas数列</li>
<li>Fibonacci数列循环节</li>
<li>二次剩余</li>
<li>最大公约数</li>
<li>最小公倍数</li>
<li>高精度</li>
<li>矩阵快速幂
date: 2021-12-22 20:54:01</li>
</ul>
<hr/>
<p><a href="https://www.luogu.com.cn/problem/P4000">题目链接</a></p>
&lt;!-- more --&gt;

<h2>原始题面</h2>
<h3>题目描述</h3>
<p>大家都知道, 斐波那契数列是满足如下性质的一个数列:</p>
<ul>
<li>$f_1 = 1$</li>
<li>$f_2 = 1$</li>
<li>$f<em>n = f</em>{n-1} + f_{n-2}$ ($n \geq 2$ 且 $n$ 为整数)
请你求出 $f_n \mod p$ 的值</li>
</ul>
<h3>输入格式</h3>
<ul>
<li>第 1 行: 一个整数 $n$</li>
<li>第 2 行: 一个整数 $p$</li>
</ul>
<h3>输出格式</h3>
<ul>
<li>第 1 行: $f_n \mod p$ 的值</li>
</ul>
<h3>输入输出样例</h3>
<h4>输入 #1</h4>
<pre><code class="lang-input1">5
1000000007
</code></pre>
<h4>输出 #1</h4>
<pre><code class="lang-output1">5
</code></pre>
<h4>输入 #2</h4>
<pre><code class="lang-input2">10
1000000007
</code></pre>
<h4>输出 #2</h4>
<pre><code class="lang-output2">55
</code></pre>
<h3>说明/提示</h3>
<p>对于 $100\%$ 的数据, $n \leq 10^{30000000}, p&lt;2^{31}$</p>
<h2>解题思路</h2>
<p>科技题</p>
<p>先摆个论文: <a href="https://gradprogram.math.arizona.edu/~ura-reports/071/Campbell.Charles/Final.pdf">The Period of the Fibonacci Sequence Modulo j</a></p>
<p>这篇论文给出了找 Fibonacci 数列和 Lucas 数列循环节的方法 (实际上所有二阶递推数列都可以这样做)</p>
<p>简单来说就是这样:</p>
<ul>
<li><p>考虑 $p$ 的唯一分解</p>
<p>$$
p=\prod_{i=1}^{\omega(p)}p_i^{\alpha_i}
$$</p>
<p>令 $l(p)$ 为 $F_n$ 模 $p$ 的循环节, 则</p>
<p>$$
l(p)=\operatorname{lcm}{l(p_1^{\alpha_1}),l(p_2^{\alpha<em>2}),...,l(p</em>{\omega(p)}^{\alpha_{\omega(p)}})}
$$</p>
</li>
<li><p>对素数 $p$, 有如下定理:</p>
<ul>
<li>$$
l(p^n)\mid l(p)p^{n-1}
$$</li>
<li>若 $\left(\frac{5}{p}\right)=1$, 即 $p\equiv\pm 1\pmod{5}$, 则
$$
l(p)\mid p-1
$$</li>
<li>若 $\left(\frac{5}{p}\right)=-1$, 即 $p\equiv\pm 2\pmod{5}$, 则
$$
l(p)\mid 2(p+1)
$$</li>
</ul>
</li>
</ul>
<blockquote><p>代码里还有一些别的科技, 推荐看一看</p>
</blockquote>
<h2>复杂度</h2>
<p>$O(\max{\lg n,\sqrt p})$</p>
<h2>代码参考</h2>
&lt;details open&gt;
&lt;summary&gt;&lt;font color='orange'&gt;Show code&lt;/font&gt;&lt;/summary&gt;

{% icodeweb cpa_cpp title:Luogu_P4000 Luogu/P4000/0.cpp %}

&lt;/details&gt;