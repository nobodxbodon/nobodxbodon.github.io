<p>版权声明： 本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！</p>
<h2><a href="https://github.com/Tiphereth-A/Tiphereth-A.github.io/blob/master/source/_posts/luogu-p5177.md">仓库源文</a>，<a href="https://tifa-233.com/archives/luogu-p5177">站点原文</a></h2>
<p>强烈谴责这种起无意义标题的做法</p>
<p><a href="https://www.luogu.com.cn/problem/P5177">题目链接</a></p>
&lt;!-- more --&gt;

<h2>原始题面</h2>
<h3>题目描述</h3>
<p>求 $\sum<em>{i=1}^n \sum</em>{j=1}^n i \ xor \ j \in [\min(i,j),\max(i,j)]$</p>
<p>由于答案可能过大, 输出答案对 $10^9+7$ 取模的值</p>
<h3>输入输出格式</h3>
<h4>输入格式</h4>
<p>第一行, 一个整数 $T$, 为数据组数. 下面 $T$ 行, 每行一个整数 $n$</p>
<h4>输出格式</h4>
<p>对于每行数据, 输出答案</p>
<h3>输入输出样例</h3>
<h4>输入样例 #1</h4>
<pre><code class="lang-input1">3
10
100
1000
</code></pre>
<h4>输出样例 #1</h4>
<pre><code class="lang-output1">20
2634
325502
</code></pre>
<h3>说明</h3>
<p>第一组样例解释: 符合题意的 $(i,j)$ 有 $20$ 对</p>
<pre><code class="lang-plaintext">i=1 j=3 i^j=2
i=1 j=5 i^j=4
i=1 j=7 i^j=6
i=1 j=9 i^j=8
i=2 j=6 i^j=4
i=2 j=7 i^j=5
i=2 j=10 i^j=8
i=3 j=1 i^j=2
i=3 j=6 i^j=5
i=3 j=7 i^j=4
i=3 j=10 i^j=9
i=5 j=1 i^j=4
i=6 j=2 i^j=4
i=6 j=3 i^j=5
i=7 j=1 i^j=6
i=7 j=2 i^j=5
i=7 j=3 i^j=4
i=9 j=1 i^j=8
i=10 j=2 i^j=8
i=10 j=3 i^j=9
</code></pre>
<p>对于 27%的数据, $T\le 5, n \le 1000$</p>
<p>对于 54%的数据, $T\le 20, n \le 5 \times 10^5$</p>
<p>对于 90%的数据, $T\le 10^5, n \le 10^{18}$</p>
<p>最后一个点, $T=3\times 10^6 \ ,\ n\le 10^{18}$</p>
<h2>解题思路</h2>
<p>首先规范一些记号, 题目要求的是</p>
<p>$$
\sum<em>{i=1}^n\sum</em>{j=1}^n[\min{i,j}\leqslant (i\oplus j)\leqslant \max{i,j}]
$$</p>
<p>显然, 上式等价于</p>
<p>$$
2\sum<em>{i=1}^n\sum</em>{j=1}^{i-1}[j\leqslant (i\oplus j)\leqslant i]
$$</p>
<p>固定 $i$, 则 $j$ 能产生贡献当且仅当 $j$ 二进制最高位为 $i$ 二进制次高位</p>
<h2>代码参考</h2>
<p>{% icodeweb cpa_cpp title:Luogu_P5177 Luogu/P5177/0.cpp %}</p>
