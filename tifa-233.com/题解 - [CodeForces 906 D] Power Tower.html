<p>版权声明： 本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！</p>
<h2><a href="https://github.com/Tiphereth-A/Tiphereth-A.github.io/blob/master/source/_posts/cf906d.md">仓库源文</a>，<a href="https://tifa-233.com/archives/cf906d">站点原文</a></h2>
<p><a href="https://codeforces.com/problemset/problem/906/D">题目链接</a></p>
&lt;!-- more --&gt;

<h2>原始题面</h2>
<p>time limit per test: 4.5 seconds<br/>
memory limit per test: 256 megabytes<br/>
input: standard input<br/>
output: standard output</p>
<h3>Description</h3>
<p>Priests of the Quetzalcoatl cult want to build a tower to represent a power of their god. Tower is usually made of power-charged rocks. It is built with the help of rare magic by levitating the current top of tower and adding rocks at its bottom. If top, which is built from $k-1$ rocks, possesses power $p$ and we want to add the rock charged with power $w_k$ then value of power of a new tower will be ${w_k}^p$</p>
<p>Rocks are added from the last to the first. That is for sequence $w_1, ..., w_m$ value of power will be</p>
<p>$$
w_1^{w_2^{\cdot^{\cdot^{\cdot^{w_m}}}}}
$$</p>
<p>After tower is built, its power may be extremely large. But still priests want to get some information about it, namely they want to know a number called cumulative power which is the true value of power taken modulo $m$. Priests have $n$ rocks numbered from $1$ to $n$. They ask you to calculate which value of cumulative power will the tower possess if they will build it from rocks numbered $l, l + 1, ..., r$</p>
<h3>Input</h3>
<p>First line of input contains two integers $n$ ($1 ≤ n ≤ 10^5$) and $m$ ($1 ≤ m ≤ 10^9$)</p>
<p>Second line of input contains $n$ integers $w_k$ ($1 ≤ w_k ≤ 10^9$) which is the power of rocks that priests have</p>
<p>Third line of input contains single integer $q$ ($1 ≤ q ≤ 10^5$) which is amount of queries from priests to you</p>
<p>kth of next $q$ lines contains two integers $l_k$ and $r_k$ ($1 ≤ l_k ≤ r_k ≤ n$)</p>
<h3>Output</h3>
<p>Output $q$ integers. k-th of them must be the amount of cumulative power the tower will have if is built from rocks $l<em>k, l</em>{k + 1}, ..., r_k$</p>
<h3>Example</h3>
<h4>Input</h4>
<pre><code class="lang-input1">6 1000000000
1 2 2 3 3 3
8
1 1
1 6
2 2
2 3
2 4
4 4
4 5
4 6
</code></pre>
<h4>Output</h4>
<pre><code class="lang-output1">1
1
2
4
256
3
27
597484987
</code></pre>
<h3>Note</h3>
<p>$3^{27} = 7625597484987$</p>
<h2>题意简述</h2>
<p>给出 $n,m,w_1,w_2,\dots,w_n$, 有 $q$ 组询问, 每次给出 $l,r$, 问</p>
<p>$$
w<em>l^{w</em>{l+1}^{\cdot^{\cdot^{\cdot^{w_r}}}}}\bmod m
$$</p>
<h2>解题思路</h2>
<p>由扩展 Euler 定理</p>
<p>$$
a^b\equiv\begin{cases}
  a^{b\bmod\varphi(m)+\varphi(m)},&amp;(a,m)&gt;1,b&gt;\varphi(m)\
  a^{b\bmod\varphi(m)},&amp;\texttt{otherwise}\
\end{cases}\pmod m
$$</p>
<p>递归求解即可</p>
<h2>复杂度</h2>
<p>$$
\Theta\left(\log m+\sum_{i=1}^q\min{r_i-l_i+1,\log m}\right)\implies O(q\log m)
$$</p>
<h2>代码参考</h2>
&lt;details open&gt;
&lt;summary&gt;&lt;font color='orange'&gt;Show code&lt;/font&gt;&lt;/summary&gt;

{% icodeweb cpa_cpp title:CodeForces_906D CodeForces/906D/0.cpp %}

&lt;/details&gt;