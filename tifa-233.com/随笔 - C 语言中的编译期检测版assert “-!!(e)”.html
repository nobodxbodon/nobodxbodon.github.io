<p>版权声明： 本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！</p>
<h2><a href="https://github.com/Tiphereth-A/Tiphereth-A.github.io/blob/master/source/_posts/draft-004.md">仓库源文</a>，<a href="https://tifa-233.com/archives/draft-004">站点原文</a></h2>
<hr/>
<p>title: 随笔 - C 语言中的编译期检测版assert "-!!(e)"
categories:</p>
<ul>
<li>随笔</li>
<li>C
tags:</li>
<li>C</li>
<li>随笔
date: 2020-07-26 18:19:46</li>
</ul>
<hr/>
<p>在 <a href="https://stackoverflow.com/questions/9229601/what-is-in-c-code">https://stackoverflow.com/questions/9229601/what-is-in-c-code</a> 看到个有趣的东西</p>
&lt;!-- more --&gt;

<p>众所周知, <code>assert()</code> 会在程序运行到相关代码时检验返回值的值, 如果为<code>0</code>则终止程序运行并输出指定错误信息</p>
<p>实际上, 我们可以通过如下手段实现在编译期进行检验</p>
<p>{% icodeweb blog lang:c draft-004/_static_assert.c %}</p>
<p>我们把它拆开来看</p>
<ul>
<li><code>!!(exp)</code>: 如果<code>exp == 0</code>, 则该部分为<code>0</code>, 否则为<code>1</code></li>
<li><code>-!!(exp)</code>: 取反, 如果<code>exp == 0</code>, 则该部分为<code>0</code>, 否则为<code>-1</code></li>
<li><code>int: -!!(exp);</code>: 如果<code>exp == 0</code>, 则该部分为<code>int: 0;</code>, 否则为<code>int: -1;</code></li>
</ul>
<p>到这里就已经很清楚了, 占<code>-1</code>个位的变量自然是无法声明的, 而占<code>0</code>个位的变量可以声明, 且不会对程序造成任何影响</p>
<blockquote><p>如果看不懂可以自行搜索位域(bitfield)</p>
</blockquote>
