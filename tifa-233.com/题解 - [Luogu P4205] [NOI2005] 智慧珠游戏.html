<p>版权声明： 本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！</p>
<h2><a href="https://github.com/Tiphereth-A/Tiphereth-A.github.io/blob/master/source/_posts/luogu-p4205.md">仓库源文</a>，<a href="https://tifa-233.com/archives/luogu-p4205">站点原文</a></h2>
<hr/>
<p>title: "题解 - [Luogu P4205] [NOI2005] 智慧珠游戏"
categories:</p>
<ul>
<li>算法竞赛</li>
<li>题解
tags:</li>
<li>算法竞赛</li>
<li>题解</li>
<li>NOI</li>
<li>洛谷</li>
<li>DLX
date: 2020-10-25 17:01:58</li>
</ul>
<hr/>
<p><a href="https://www.luogu.com.cn/problem/P4205">题目链接</a></p>
<p>&lt;!-- more --&gt;</p>
<h2>原始题面</h2>
<p>1000 ms / 125.00 MB</p>
<h3>题目描述</h3>
<p>智慧珠游戏拼盘由一个三角形盘件和 12 个形态各异的零件组成. 拼盘的盘件如图 1 所示:</p>
<p><img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/1.png"/></p>
<p>12 个零件按珠子数分 3 大类:</p>
<ul>
<li>第 1 大类, 有三个珠子, 只有一种形状<ul>
<li>符号为 A, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/A.png"/></li>
</ul>
</li>
<li>第 2 大类, 有 4 个珠子, 有 3 种形状<ul>
<li>符号为 B, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/B.png"/></li>
<li>符号为 C, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/C.png"/></li>
<li>符号为 D, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/D.png"/></li>
</ul>
</li>
<li>第 3 大类, 有 5 个珠子, 有 8 种形状<ul>
<li>符号为 E, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/E.png"/></li>
<li>符号为 F, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/F.png"/></li>
<li>符号为 G, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/G.png"/></li>
<li>符号为 H, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/H.png"/></li>
<li>符号为 I, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/I.png"/></li>
<li>符号为 J, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/J.png"/></li>
<li>符号为 K, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/K.png"/></li>
<li>符号为 L, 形状为 <img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/L.png"/></li>
</ul>
</li>
</ul>
<p><img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/2.png"/></p>
<p>图 2 示出了一种拼盘方案. 为便于描述可将图 2 抽象为图 3, 就可以用一个数据为字符的二维数组来表示了</p>
<p><img alt="" src="/media/wwww/share/study/聚聚/源数据/博客聚合/tifa-233.com/source/_posts/3.png"/></p>
<p>对于由珠子构成的零件, 可以放到盘件的任一位置, 条件是能有地方放, 且尺寸合适, 所有的零件都允许旋转(0º、90º、180º、270º)和翻转(水平、竖直)</p>
<p>现给出一个盘件的初始布局, 求一种可行的智慧珠摆放方案, 使所有的零件都能放进盘件中</p>
<h3>输入输出格式</h3>
<h4>输入格式</h4>
<p>文件中包含初始的盘件描述, 一共有 10 行, 第 i 行有 i 个字符. 如果第 i 行 的第 j 个字符是字母"A"至"L"中的一个, 则表示第 i 行第 j 列的格子上已经放了 零件, 零件的编号为对应的字母. 如果第 i 行的第 j 个字符是".", 则表示第 i 行 第 j 列的格子上没有放零件. 输入保证预放的零件已摆放在盘件中</p>
<h4>输出格式</h4>
<p>如果能找到解, 向输出文件打印 10 行, 为放完全部 12 个零件后的布局. 其 中, 第 i 行应包含 i 个字符, 第 i 行的第 j 个字符表示第 i 行第 j 列的格子上放的 是哪个零件</p>
<p>如果无解, 输出单独的一个字符串'No solution'(不要引号, 请注意大小写)</p>
<p>所有的数据保证最多只有一组解</p>
<h3>输入输出样例</h3>
<h4>输入样例 #1</h4>
<pre><code class="language-input1">.
..
...
....
.....
.....C
...CCC.
EEEHH...
E.HHH....
E.........
</code></pre>
<h4>输出样例 #1</h4>
<pre><code class="language-output1">B
BK
BKK
BJKK
JJJDD
GJGDDC
GGGCCCI
EEEHHIIA
ELHHHIAAF
ELLLLIFFFF
</code></pre>
<h2>解题思路</h2>
<p>把所有零件视作 4x4 且最上端无空行, 最左端无空列的图形, 之后把所有可能的图形预处理出来, 一共 60 种, 对这 60 种图形均尝试能否放入拼盘</p>
<p>状态这样选取:</p>
<ul>
<li>单次操作为在某位置放某图形, 所以总的操作一共 $55\times 60=3300$ 种, 这其中有许多非法操作, 记得删掉</li>
<li>用 $55+12=67$ 维向量表示单次操作后的影响, 其中<ul>
<li>$1\sim 12$ 维表示放了某种零件</li>
<li>$13\sim 67$ 维表示零件占据了哪些位置</li>
</ul>
</li>
</ul>
<p>参考代码里对拼盘和零件的编码方式如下:</p>
<ul>
<li><p><code>Board::data[]</code> 存储拼盘状态, 每 4 位表示一个格子, 第 <code>r</code> 行第 <code>c</code> 列 (从 0 开始) 格子的状态为 <code>(Board::data[r] &gt;&gt; (4 * (9 - c))) &amp; 15</code>, <code>0</code> 表示无珠子, <code>f</code> 表示不可放置</p>
<p>如第 4 行状态为 <code>I.ADA</code> 时, <code>Board::data[4]</code> 为 <code>0x90141fffff</code></p>
</li>
<li><p><code>pieces[]</code> 为所有零件对应的图形 (包含旋转和对称), 由 20 位构成, 其中高 4 位表示零件种类, 低 16 位为一个 4x4 图形</p>
<p>如 <code>0x14c00</code> 表示第 A 类零件, 用 <code>x</code> 表示有珠子, <code>.</code> 表示无珠子, 则图形为</p>
<pre><code class="language-plaintext">.x..
xx..
....
....
</code></pre>
</li>
<li><p>零件对应图形的预处理代码参见命名空间 <code>PieceOperation</code>, 调用 <code>PieceOperation::getall()</code> 即可得到 <code>pieces[]</code></p>
</li>
</ul>
<h2>代码参考</h2>
<p>&lt;details open&gt;
&lt;summary&gt;&lt;font color='orange'&gt;Show code&lt;/font&gt;&lt;/summary&gt;</p>
<p>{% icodeweb cpa_cpp title:Luogu_P4205 Luogu/P4205/0.cpp %}</p>
<p>&lt;/details&gt;</p>
