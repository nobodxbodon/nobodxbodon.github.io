<h2><a href="https://github.com/Tiphereth-A/Tiphereth-A.github.io/blob/master/source/_posts/nt-1.md">仓库源文</a>，<a href="https://tifa-233.com/nt-1">站点原文</a></h2>
<hr/>
<p>title: "笔记 - 整除, 素数, gcd &amp; lcm, 同余, 逆元, CRT, exCRT"
categories:</p>
<ul>
<li>笔记</li>
<li>算法竞赛</li>
<li>数学
tags:</li>
<li>数学</li>
<li>算法竞赛</li>
<li>笔记</li>
<li>模板</li>
<li>数论</li>
<li>整除</li>
<li>素数/质数</li>
<li>筛法</li>
<li>Eratosthenes筛</li>
<li>Euler筛</li>
<li>最大公约数</li>
<li>最小公倍数</li>
<li>辗转相除法</li>
<li>Bézout定理</li>
<li>同余</li>
<li>exgcd</li>
<li>Wilson定理</li>
<li>Fermat小定理</li>
<li>Euler定理</li>
<li>逆元</li>
<li>中国剩余定理(CRT)</li>
<li>扩展中国剩余定理(exCRT)</li>
<li>构造
date: 2020-10-04 01:14:43</li>
</ul>
<hr/>
<p>整除, 素数, 最大公约数 &amp; 最小公倍数, 同余, 逆元, 中国剩余定理</p>
<p>&lt;!-- more --&gt;</p>
<h2>整除</h2>
<p>对于整数 $a,b$, 若 $\exists k~s.t.~a=kb$, 则称 $b$ 整除 $a$, 记作 $b\mid a$, 否则称 $b$ 不整除 $a$, 记作 $b\nmid a$</p>
<h3>性质</h3>
<ol>
<li>$a\mid b,b\mid c\implies a\mid c$</li>
<li>$a\mid b,b\mid a\implies a=\pm b$</li>
<li>$a\mid b,a\mid c\implies\forall x,y\in\mathbb{Z},~a\mid bx+cy$</li>
</ol>
<h3>带余除法</h3>
<h4>&lt;a href="#end-t-1.1" id="t-1.1"&gt;定理 - 1.1&lt;/a&gt; (带余除法)</h4>
<p>设 $a,b\in\mathbb{Z}$, 且 $b\geqslant1$, 则存在唯一的整数 $q,r$ 使得</p>
<p>$$
a=qb+r,r\in[0,b)\cap\mathbb{N}
$$</p>
<h5>&lt;a href="#t-1.1" id="p-t-1.1"&gt;证明&lt;/a&gt;</h5>
<p>首先, 取 $q=\lfloor\frac{a}{b}\rfloor$, $r=a-qb$, 容易验证此时的 $q,r$ 满足条件</p>
<p>下证唯一性, 假设又有一组整数 $q',r'$ 使得 $a=q'b-r',~r'\in[0,b)\cap\mathbb{N}$, 则</p>
<p>$$
0=a-a=(q-q')b+(r-r')
$$</p>
<p>因此 $b\mid r-r'$</p>
<p>而 $|r-r'|\in[0,b)\cap\mathbb{N}$, 故只能有 $r-r'=0$, 即 $r=r'$</p>
<p>此时 $a-qb=a-q'b$, 有 $q=q'$</p>
<p>&lt;a href="#p-t-1.1" id="end-t-1.1"&gt;$\Box$&lt;/a&gt;</p>
<p>接下来我们给出一个整数集的重要性质</p>
<h4>&lt;a href="#end-t-1.2" id="t-1.2"&gt;定理 - 1.2&lt;/a&gt;</h4>
<p>设 $S$ 为非空整数集, 若 $S$ 关于整数的加减法封闭, 即</p>
<ul>
<li>若 $a,b\in S$, 则 $a\pm b\in S$</li>
</ul>
<p>则存在唯一自然数 $d$ 使得 $S=d\mathbb{Z}:={da|a\in\mathbb{Z}}$</p>
<blockquote>
<p>条件中隐含了一点:</p>
<ul>
<li>若 $a\in S$, 则 $\forall c\in\mathbb{Z},~ac\in S$</li>
</ul>
</blockquote>
<p>一般的, 若 $S$ 为主理想环, 则 $\exists_1 d\in\mathbb{Z}~s.t.~S=\lang d\rang$</p>
<h5>&lt;a href="#t-1.2" id="p-t-1.2"&gt;证明&lt;/a&gt;</h5>
<p>若 $S={0}$, 则只能取 $d=0$</p>
<p>设 $0\ne a\in S$, 则 $0=a-a\in S,-a=(-1)\times a\in S$, 故此时 $S$ 中必有正整数</p>
<p>由良序公理可知 $S$ 中的所有正整数中必有最小值, 令 $d$ 为 $S$ 中的最小正整数, 下证 $S=d\mathbb{Z}$</p>
<p>首先易得 $d\mathbb{Z}\subseteq S$</p>
<p>之后我们在 $S$ 中任取整数 $a$ 做带余除法</p>
<p>$$
a=qd+r,~q\in\mathbb{Z},r\in[0,d)\cap\mathbb{N}
$$</p>
<p>可知 $r=a-qd\in S$, 而 $d$ 为 $S$ 中的最小正整数, 故必有 $r=0$</p>
<p>这表明 $a=qd\in d\mathbb{Z}$, 因此 $S\subseteq d\mathbb{Z}$</p>
<p>最后, 注意到 $d$ 为 $S$ 中的最小正整数, 则满足 $S=d\mathbb{Z}$ 的 $d$ 一定是唯一的</p>
<p>&lt;a href="#p-t-1.2" id="end-t-1.2"&gt;$\Box$&lt;/a&gt;</p>
<h3>例题</h3>
<ul>
<li>设 $n$ 是大于 1 的整数, 证明: $\displaystyle\sum_{i=1}^n\frac{1}{i}$ 不是整数</li>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P2651">P2651 添加括号 III</a></li>
</ul>
<h2>素数/质数</h2>
<p>即只能被 1 和其自身整除且大于 1 的数</p>
<p>不满足上述条件, 但大于 1 的数称为合数</p>
<p>1 既不是素数也不是合数</p>
<h3>&lt;a href="#end-t-2.1" id="t-2.1"&gt;定理 - 2.1&lt;/a&gt;</h3>
<p>素数有无限多个</p>
<h4>&lt;a href="#t-2.1" id="p-t-2.1"&gt;证明&lt;/a&gt; (Euclid)</h4>
<p>假设素数只有有限个, 记作 $a_1,a_2,\dots,a_n$</p>
<p>考虑 $N=\prod_{i=1}^np_i+1$, 显然 $N&gt;2$</p>
<p>由于 $N\ne p_i,i=1,2,...,n$, 故必有 $N$ 必有素因子 $p$</p>
<p>但 $p_i\nmid N,i=1,2,...,n$, 故 $p$ 是 $p_1,p_2,\dots,p_n$ 以外的素数, 这与假设矛盾</p>
<p>&lt;a href="#p-t-2.1" id="end-t-2.1"&gt;$\Box$&lt;/a&gt;</p>
<h3>唯一分解定理</h3>
<h4>&lt;a href="#end-t-2.2" id="t-2.2"&gt;定理 - 2.2&lt;/a&gt;</h4>
<p>所有大于 1 的整数均可分解为有限个素数的乘积, 若不计各素数出现的顺序, 则这种分解唯一</p>
<p>证明略</p>
<p>&lt;a href="#t-2.2" id="end-t-2.2"&gt;$\Box$&lt;/a&gt;</p>
<h3>素数分布</h3>
<p>如果令 $\pi(n)$ 表示 $[1,n]$ 中的素数个数, 则我们有</p>
<p>$$
\pi(n)\sim\frac{n}{\ln n}~(n\to\infty)
$$</p>
<p>或者写成</p>
<p>$$
\lim_{n\to\infty}{\pi(n)\over\frac{n}{\ln n}}=1
$$</p>
<p>证明略</p>
<h3>素数判定</h3>
<p>这里给出一个简单的做法</p>
<p>首先, 我们不难证明: 若 $n$ 是合数, 则其必有一个因子 $d\in(1,\sqrt n]\cap\mathbb{N}$</p>
<p>所以对于要判定的整数<code>n</code>, 我们只需在<code>2..sqrt(n)</code>中枚举整数<code>i</code>验证即可</p>
<p>&lt;details open&gt;
&lt;summary&gt;&lt;font color='orange'&gt;Show code&lt;/font&gt;&lt;/summary&gt;</p>
<p>{% include_code lang:cpp nt-1/is_prime.cpp %}</p>
<p>&lt;/details&gt;</p>
<p>时间复杂度: $O(\sqrt n)$</p>
<p>有没有更好的方法呢?</p>
<p>我们有时间复杂度为 $O(k\log^3n)$ 的 Miller-Rabin 算法进行素性检验[^1], 其中 $k$ 为用于检验的数的个数[^2]</p>
<p>因其原理涉及到后面要讲的概念, 故此处略去相关讲解</p>
<blockquote>
<p>Miller-Rabin 算法和用于质因数分解的 Pollard-Rho 算法的模板 -&gt; {% post_link p-test-mrpr %}</p>
</blockquote>
<p>[^1]: 可以用 FFT 优化到 $O(k\log^2 n\log\log n\log\log\log n)$ , 参见 <a href="https://en.wikipedia.org/wiki/Miller%E2%80%93Rabin_primality_test#Complexity">此处</a>
[^2]: 若广义 Riemann 猜想(GRH)得到证实, 则可将检验的数换为 $2..2\lfloor\log^2 n\rfloor$ 从而使复杂度变为 $O(\log^5n)$, 参见 <a href="https://www.ams.org/mcom/1990-55-191/S0025-5718-1990-1023756-8/S0025-5718-1990-1023756-8.pdf">此处</a></p>
<h3>素数筛法</h3>
<p>如何求出 $[1,n]$ 中的所有素数?</p>
<p>最朴素的做法就是对 <code>1..n</code> 中的每个数分别应用上述素数判定法, 时间复杂度: $O(n\sqrt n)$</p>
<p>接下来我们介绍两种更加高效的算法: Eratosthenes 筛法 和 Euler 筛法</p>
<h4>Eratosthenes 筛法</h4>
<p>又称埃氏筛</p>
<p>我们注意到这样的事实: 合数 $x$ 的倍数也是合数</p>
<p>所以我们可以这样操作:</p>
<ul>
<li><code>2..n</code>从小到大枚举, 如果当前枚举的数没被标记为合数, 我们就认为这个数是素数<ul>
<li>如果这个数是素数, 我们将其倍数标记为合数</li>
</ul>
</li>
</ul>
<p>&lt;details open&gt;
&lt;summary&gt;&lt;font color='orange'&gt;Show code&lt;/font&gt;&lt;/summary&gt;</p>
<p>{% include_code lang:cpp nt-1/Eratosthenes_sieve.cpp %}</p>
<p>&lt;/details&gt;</p>
<h5>时间复杂度</h5>
<p>易知</p>
<p>$$
T(n)=\sum_{p\in{prime}\cap[2,n]}\left\lfloor\frac{n}{i}\right\rfloor
$$</p>
<p>而</p>
<p>$$
\begin{aligned}
O(T(n))&amp;=O\left(\sum_{p\in{prime}\cap[2,n]}\left\lfloor\frac{n}{i}\right\rfloor\right)\
&amp;=O\left(n\sum_{p\in{prime}\cap[2,n]}\left\lfloor\frac{1}{p}\right\rfloor\right)\
&amp;=O(n\log\log n)
\end{aligned}
$$</p>
<p>故时间复杂度为 $O(n\log\log n)$</p>
<h4>Euler 筛法</h4>
<p>我们发现在 Eratosthenes 筛法中, 有些数会被多次标记为合数, 我们能不能做到只标记一次呢?</p>
<p>当然可以!</p>
<p>&lt;details open&gt;
&lt;summary&gt;&lt;font color='orange'&gt;Show code&lt;/font&gt;&lt;/summary&gt;</p>
<p>{% include_code lang:cpp nt-1/Euler_sieve.cpp %}</p>
<p>&lt;/details&gt;</p>
<h5>时间复杂度</h5>
<p>因为每个数只被标记一次, 所以时间复杂度显然为 $O(n)$</p>
<h3>例题</h3>
<ul>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P3383">P3383 【模板】线性筛素数</a></li>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P2926">P2926 [USACO08DEC]Patting Heads S</a></li>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P1835">P1835 素数密度</a></li>
</ul>
<h2>最大公约数 &amp; 最小公倍数</h2>
<p>对于两个<strong>不全为零</strong>的<strong>整数</strong>$a,b$</p>
<p>最大公约数即为 $a,b$ 中最大的正公因数, 记作 $(a,b)$, 或者 $\gcd(a,b)$</p>
<p>最小公倍数即为 $a,b$ 中最小的正公倍数, 记作 $[a,b]$, 或者 $\operatorname{lcm}(a,b)$</p>
<p>写成式子就是</p>
<p>$$
(a,b):=\max{d\in\mathbb{N}^*|d\mid a,d\mid b}
$$</p>
<p>$$
[a,b]:=\min{d\in\mathbb{N}^*|a\mid d,b\mid d}
$$</p>
<p>这一组概念自然可以推广到多个整数之间</p>
<p>$$
(a_1,a_2,\dots,a_n):=\max{d\in\mathbb{N}^*|d\mid a_i,~i=1,2,...,n}
$$</p>
<p>$$
[a_1,a_2,\dots,a_n]:=\min{d\in\mathbb{N}^*|a_i\mid d,~i=1,2,...,n}
$$</p>
<h3>性质</h3>
<ol>
<li>$<a href="a,b">a,b</a>=|ab|$</li>
</ol>
<h4>最大公约数</h4>
<ol>
<li>$(a,b)=(b,a)=(|a|,b)=(|a|,|b|)$</li>
<li>当 $a\ne 0$ 时, $(a,a)=|a|$</li>
<li>若 $a_1\ne 0$, 则 $(a_1,a_2,\dots,a_n)=((a_{1},a_{2}),a_{3},...,a_{n})$</li>
<li>$\forall l\in\mathbb{Z},~(a,b)=(a,b+la)$</li>
<li>$\forall m\in\mathbb{N}^*,~m(a_1,a_2,\dots,a_n)=(ma_1,ma_2,\dots,ma_n)$</li>
<li>若 $(a_1,a_2,\dots,a_n)=d$, 则 $(\frac{a_1}{d},\frac{a_2}{d},...,\frac{a_n}{d})=1$</li>
<li>对于整数 $m$, 若 $(a_i,m)=1,~i=1,2,...,n$, 则 $(\prod_{i=1}^na_i,m)=1$</li>
<li>设 $a_1,a_2,\dots,a_n$ 是不全为零的整数, $(a_1,a_2,\dots,a_n)=d$, 则
$$
\left{\sum_{i=1}^na_ix_i\bigg|x_i\in\mathbb{Z},i=1,2,...,n\right}=d\mathbb{Z}
$$</li>
<li>设 $c\in\mathbb{Z}/{0},a,b\in\mathbb{Z}$, 若 $c\mid ab,(c,b)=1$, 则 $c\mid a$<ul>
<li>特别地, 若 $p$ 为素数, $p\mid ab$, 则 $p\mid a$ 或 $p\mid b$</li>
</ul>
</li>
</ol>
<p>下面对性质 8 给出证明</p>
<h5>&lt;a href="#end-t-3.1" id="t-3.1"&gt;定理 - 3.1&lt;/a&gt;(性质 8, Bézout 定理)</h5>
<p>设 $a_1,a_2,\dots,a_n$ 是不全为零的整数, $(a_1,a_2,\dots,a_n)=d$, 则</p>
<p>$$
S:=\left{\sum_{i=1}^na_ix_i\bigg|x_i\in\mathbb{Z},i=1,2,...,n\right}=d\mathbb{Z}
$$</p>
<h6>&lt;a href="#t-3.1" id="p-t-3.1"&gt;证明&lt;/a&gt;</h6>
<p>由 &lt;a href="#t-1.2"&gt;定理 - 1.2&lt;/a&gt; 可知, 存在正整数 $a$ 使得 $S=a\mathbb{Z}$, 接下来只需证 $a=d$</p>
<p>一方面, $d$ 是 $S$ 中所有数的因子, 而 $a\in S$, 故 $d\mid a$</p>
<p>另一方面, 注意到 $a_1,a_2,\dots,a_n\in S$, 故 $a$ 是 $a_1,a_2,\dots,a_n$ 的公因子, 即有</p>
<p>$$
a\mid(a_1,a_2,\dots,a_n)=d
$$</p>
<p>因此 $a=d$</p>
<p>&lt;a href="#p-t-3.1" id="end-t-3.1"&gt;$\Box$&lt;/a&gt;</p>
<h4>最小公倍数</h4>
<ol>
<li>$[a_1,a_2,\dots,a_n]=[[a_1,a_2],a_3,...,a_n]$</li>
<li>$\forall m\in\mathbb{N}^*,~[ma_1,ma_2,\dots,ma_n]=m[a_1,a_2,\dots,a_n]$</li>
<li>若 $a_1,a_2,\dots,a_n$ 两两互素, 则 $[a_1,a_2,\dots,a_n]=|\prod_{i=1}^na_i|$</li>
</ol>
<h3>求法</h3>
<p>求最小公倍数只需求出最大公约数即可</p>
<p>而由于 $\forall l\in\mathbb{Z},~(a,b)=(a,b+la)$, 我们可推出:</p>
<ul>
<li>若 $b\ne 0$, 则 $(a,b)=(b,a\bmod b)$</li>
</ul>
<p>之后我们便可递归下去, 当 $b=0$ 时, 答案即为 $a$</p>
<p>这就是<strong>辗转相除法</strong></p>
<p>&lt;details open&gt;
&lt;summary&gt;&lt;font color='orange'&gt;Show code&lt;/font&gt;&lt;/summary&gt;</p>
<p>{% include_code lang:cpp nt-1/gcd.cpp %}</p>
<p>&lt;/details&gt;</p>
<h4>时间复杂度</h4>
<p>我们知道, $b\to a \bmod b$ 这个过程中, $b$ 的值大致可认为是减半, 所以时间复杂度为 $O(\log n)$</p>
<p>最坏情况即为对两相邻的 Fibonacci 数求最大公约数</p>
<blockquote>
<p>Fibonacci 数的定义如下:</p>
<p>$$
F_i:=\begin{cases}
0,&amp;i=0\
1,&amp;i=1\
F_{i-1}+F_{i-2},&amp;i&gt;1
\end{cases}
$$</p>
<p>容易求得</p>
<p>$$
F_n=\frac{\phi^n-(1-\phi)^n}{\sqrt 5},~\phi={1+\sqrt{5}\over2}
$$</p>
</blockquote>
<p>计算 $(F_{n+1},F_{n})$ 需要 $n$ 次迭代, 此时的时间复杂度也为 $O(\log n)$</p>
<blockquote>
<p>实际上求 gcd 是有 $O(1)$ 算法的, 此次略去</p>
</blockquote>
<h3>扩展 Euclid (exgcd)</h3>
<p>用于对给定的 $a,b,c$, 寻找 $ax+by=c$ 的一组可行解</p>
<p>首先, 由 &lt;a href="#t-3.1"&gt;Bézout 定理&lt;/a&gt;, 若 $(a,b)\nmid c$, 则该方程无解</p>
<p>接下来, 令 $d=\frac{c}{(a,b)}$, 则求出 $ax+by=(a,b)$ 的一组解 $x=x',y=y'$ 后, 容易得知 $x=dx',y=dy'$ 即为 $ax+by=c$ 的一组解</p>
<p>另外, 若 $ax+by=c$ 有一组解 $x=x',y=y'$, 则</p>
<p>$$
\begin{cases}
x=x'-bt\
y=y'+at
\end{cases}(t\in\mathbb{Z})
$$</p>
<p>也为该方程的解, 所以方程 $ax+by=c$ 若有解, 则必有无数组解</p>
<p>经过如下分析, 我们发现: 求出方程 $ax+by=(a,b)$ 的一组解是关键, 下面给出求法</p>
<h4>求法</h4>
<p>考虑这两个式子</p>
<p>$$
\begin{aligned}
ax+by&amp;=(a,b)\
bx'+(a\bmod b)y'&amp;=(b,a\bmod b)=(a,b)
\end{aligned}
$$</p>
<p>注意到</p>
<p>$$
a\bmod b=a-\left\lfloor\frac{a}{b}\right\rfloor b
$$</p>
<p>故</p>
<p>$$
ax+by=bx'+(a-\left\lfloor\frac{a}{b}\right\rfloor b)y'
$$</p>
<p>可知</p>
<p>$$
\begin{cases}
x=y'\
y=x'-\left\lfloor\frac{a}{b}\right\rfloor y'
\end{cases}
$$</p>
<p>接下来不断向下迭代即可, 直到 $b=0$, 此时显然有 $x=1,y=0$</p>
<p>&lt;details open&gt;
&lt;summary&gt;&lt;font color='orange'&gt;Show code&lt;/font&gt;&lt;/summary&gt;</p>
<p>{% include_code lang:cpp nt-1/exgcd.cpp %}</p>
<p>&lt;/details&gt;</p>
<p>时间复杂度仍为 $O(\log n)$</p>
<h3>例题</h3>
<ul>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P1072">P1072 Hankson 的趣味题</a></li>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P2158">P2158 [SDOI2008]仪仗队</a></li>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P4549">P4549 【模板】裴蜀定理</a></li>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P5656">P5656 【模板】二元一次不定方程(exgcd)</a></li>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P3951">P3951 小凯的疑惑 / [蓝桥杯 2013 省]买不到的数目</a> -&gt; {% post_link luogu-p3951 题解 %}</li>
</ul>
<h2>同余</h2>
<p>若 $t\mid a-b$, 则称 $a$ 与 $b$ 模 $t$ 同余, 记作 $a\equiv b\pmod t$</p>
<p>若 $t\nmid a-b$, 则称 $a$ 与 $b$ 模 $t$ 不同余, 记作 $a{\equiv}\llap{/,} b\pmod t$</p>
<p>我们称 $\mathbb{Z}_m:={\overline{0},\overline{1},...,\overline{m-1}}$ 为模 $m$ 剩余类</p>
<p>显然, 同余关系是一种等价关系, 剩余类即为其截面</p>
<h3>性质</h3>
<p>设 $a,b,c,d\in\mathbb{Z}$, $m\in\mathbb{N}^*$, $p$ 为素数</p>
<ol>
<li>$a\equiv a\pmod m$</li>
<li>$a\equiv b\pmod m\implies b\equiv a\pmod m$</li>
<li>$a\equiv b\pmod m,b\equiv c\pmod m\implies a\equiv c\pmod m$</li>
<li>$a\equiv b\pmod m,c\equiv d\pmod m\implies a\pm c\equiv b\pm d\pmod m,ac\equiv bd\pmod m$</li>
<li>$ac\equiv bc\pmod m\implies a\equiv b\pmod{~\frac{m}{(c,m)}}$, 特别地, 若 $(c,m)=1$, 则 $a\equiv b\pmod{m}$</li>
<li>$a\equiv b\pmod m\implies\forall d\mid m,a\equiv b\pmod d$</li>
<li>$a\equiv b\pmod m\iff ad\equiv bd\pmod{md}$</li>
<li>$a\equiv b\pmod{m_i},i=1,2,...,n\implies a\equiv b\pmod{[m_1,m_2,\dots,m_n]}$</li>
<li>令 $f(x)=\sum_{i=0}^na_ix^i,~a_1\in\mathbb{Z},i=0,1,...,n$, 则若 $a\equiv b\pmod m$, 则 $f(a)\equiv f(b)\pmod m$</li>
</ol>
<p>另外在这里列出三条重要定理</p>
<ol>
<li><p><strong>Wilson 定理</strong>:</p>
<p>$$
(p-1)!\equiv-1\pmod p
$$</p>
</li>
<li><p><strong>Fermat 小定理</strong>: 若 $(a,p)=1$, 则</p>
<p>$$
a^{p-1}\equiv1\pmod p
$$</p>
</li>
<li><p><strong>Euler 定理</strong>: 若 $(a,m)=1$, 则</p>
<p>$$
a^{\varphi(m)}\equiv1\pmod m
$$</p>
<p>其中 $\varphi(n)$ 为 Euler 函数, 指的是 $[1,n]$ 中所有与 $n$ 互素的数的个数</p>
<blockquote>
<p>这里简单写写 Euler 函数的性质</p>
<ul>
<li><p>若 $p$ 为素数, $a$ 为自然数, 则 $\varphi(p^a)=p^a-p^{a-1}$</p>
<p>特别地, $\varphi(p)=p-1$</p>
</li>
<li><p>若 $(m,n)=1$, 则 $\varphi(mn)=\varphi(m)\varphi(n)$</p>
</li>
</ul>
</blockquote>
<p>不难发现: Euler 定理 即为 Fermat 定理 的推广</p>
<blockquote>
<p>Wilson 定理, Fermat 小定理, Euler 定理 和后面要讲的 中国剩余定理 合称初等数论四大定理</p>
</blockquote>
</li>
</ol>
<p>接下来给出性质 4 和 5 的证明</p>
<h4>&lt;a href="#end-t-4.1" id="t-4.1"&gt;定理 - 4.1&lt;/a&gt; (性质 4)</h4>
<p>$a\equiv b\pmod m,c\equiv d\pmod m\implies a\pm c\equiv b\pm d\pmod m,ac\equiv bd\pmod m$</p>
<h5>&lt;a href="#t-4.1" id="p-t-4.1"&gt;证明&lt;/a&gt;</h5>
<p>由 $a\equiv b\pmod m,c\equiv d\pmod m$ 可得 $m\mid a-b$ 及 $m\mid c-d$</p>
<p>于是</p>
<p>$$
\begin{cases}
m\mid (a-b)\pm(c-d)=(a\pm c)-(b\pm d)\
m\mid (a-b)c+(c-d)b=ac-bd
\end{cases}
$$</p>
<p>因此</p>
<p>$$
\begin{cases}
a\pm c\equiv b\pm d\pmod m\
ac\equiv bd\pmod m
\end{cases}
$$</p>
<p>&lt;a href="#p-t-4.1" id="end-t-4.1"&gt;$\Box$&lt;/a&gt;</p>
<h4>&lt;a href="#end-t-4.2" id="t-4.2"&gt;定理 - 4.2&lt;/a&gt; (性质 5)</h4>
<p>$ac\equiv bc\pmod m\implies a\equiv b\pmod{~\frac{m}{(c,m)}}$, 特别地, 若 $(c,m)=1$, 则 $a\equiv b\pmod{m}$</p>
<h5>&lt;a href="#t-4.2" id="p-t-4.2"&gt;证明&lt;/a&gt;</h5>
<p>由 $ac\equiv bc\pmod m$ 可得 $m\mid(a-b)c$, 故有</p>
<p>$$
\frac{m}{(c,m)}\bigg|(a-b)\frac{c}{(c,m)}
$$</p>
<p>而 $(\frac{m}{(c,m)},\frac{c}{(c,m)})=1$, 故 $\frac{m}{(c,m)}\mid a-b$, 即</p>
<p>$$
a\equiv b\pmod{~\frac{m}{(c,m)}}
$$</p>
<p>&lt;a href="#p-t-4.2" id="end-t-4.2"&gt;$\Box$&lt;/a&gt;</p>
<p>性质 4 说明我们在同余意义下加法, 减法和乘法可以照常运算, 但是由于性质 5, 除法并不能随意去运算, 在逆元章节中我们将进行进一步讨论</p>
<hr/>
<p>这里附上 Wilson 定理和 Euler 定理的证明</p>
<h4>&lt;a href="#end-t-4.3" id="t-4.3"&gt;定理 - 4.3&lt;/a&gt; (Wilson 定理)</h4>
<p>$$
(p-1)!\equiv-1\pmod p
$$</p>
<h5>&lt;a href="#t-4.3" id="p-t-4.3"&gt;证明&lt;/a&gt;</h5>
<p>当 $p=2$ 时, 定理显然成立, 以下设 $p\geqslant 3$, 令 $\mathbb{Z}_p:={\overline{0},\overline{1},...,\overline{p-1}}$ 即证 $\mathbb{Z}_p/{0}$ 中所有元素之积为 $\overline{-1}$</p>
<p>我们知道, $\mathbb{Z}_p/{0}$ 中每个元素都是可逆的, 即 $\forall a\in\mathbb{Z}_p/{0},~a^{-1}\in\mathbb{Z}_p/{0}$, 显然 $a^{-1}$ 的逆元为 $a$</p>
<p>而 $aa^{-1}=\overline{1}$, 故 $\mathbb{Z}_p/{0}$ 中彼此互逆的元素每对乘积为 $1$</p>
<p>之后考虑 $a=a^{-1}$ 的情况, 此时有 $a^2=\overline{1}$, 即 $a=\overline{1}$ 或 $a=\overline{-1}$</p>
<p>故 $(p-1)!\equiv-1\pmod p$</p>
<p>&lt;a href="#p-t-4.3" id="end-t-4.3"&gt;$\Box$&lt;/a&gt;</p>
<blockquote>
<p>在讲到原根时会给出另一个证明</p>
</blockquote>
<h4>&lt;a href="#end-t-4.4" id="t-4.4"&gt;定理 - 4.4&lt;/a&gt; (Euler 定理)</h4>
<p>若 $(a,m)=1$, 则</p>
<p>$$
a^{\varphi(m)}\equiv1\pmod m
$$</p>
<h5>&lt;a href="#t-4.4" id="p-t-4.4"&gt;证明&lt;/a&gt;</h5>
<p>设 $\mathbb{Z}<em>m^*:={a\in\mathbb{Z}_m|(a,m)=1}={a_0,a_1,\dots,a</em>{\varphi(m)}}$</p>
<p>由 $(a,m)=1$ 可知 $\overline{a}\in\mathbb{Z}<em>m^*$, 从而 $\mathbb{Z}_m^*={aa_0,aa_1,\dots,aa</em>{\varphi(m)}}$</p>
<p>从而在群 $\mathbb{Z}_m^*$ 中</p>
<p>$$
\prod_{i=1}^{\varphi(m)}a_i=\prod_{i=1}^{\varphi(m)}aa_i=a^{\varphi(m)}\prod_{i=1}^{\varphi(m)}a_i
$$</p>
<p>两边约去 $\prod_{i=1}^{\varphi(m)}a_i$, 即得 $a^{\varphi(m)}\equiv1\pmod m$</p>
<p>&lt;a href="#p-t-4.4" id="end-t-4.4"&gt;$\Box$&lt;/a&gt;</p>
<h3>例题</h3>
<ul>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P4942">P4942 小凯的数字</a></li>
<li>HDU <a href="https://vjudge.net/problem/HDU-2973/origin">2973 YAPTCHA</a></li>
</ul>
<h2>逆元</h2>
<p>设 $m$ 为正整数, $(a,m)=1$, 称 $a$ 的逆元为方程 $ax\equiv 1\pmod m$ 的解, 记作 $a^{-1}$</p>
<p>可以看出, 模剩余类下的逆元就像是有理数意义下一个数的倒数</p>
<h3>性质</h3>
<ol>
<li><p>若 $(a,m)=(b,m)=1$, 则 $a\equiv b\pmod m\iff a^{-1}\equiv b^{-1}\pmod m$</p>
<blockquote>
<p>这条性质等价于:</p>
<ul>
<li>对一个数求逆元, 其结果唯一</li>
<li>方程 $ax\equiv 1\pmod m,~(a,m)=1$ 的解唯一</li>
</ul>
</blockquote>
</li>
</ol>
<h3>求法</h3>
<ol>
<li><p>exgcd</p>
<p>扩欧求的是 $ax+by=c$ 的解, 此时我们令 $b=m$, $c=(a,m)=1$, 则有</p>
<p>$$
ax+my=1
$$</p>
<p>即</p>
<p>$$
ax\equiv 1\pmod m
$$</p>
<p>这个 $x$ 就是 $a$ 的逆元</p>
<p>时间复杂度:$O(\log m)$</p>
</li>
<li><p>Fermat 小定理 / Euler 定理</p>
<p>由 $a^{\varphi(m)}\equiv 1\pmod m$ 可知 $a^{\varphi(m)-1}\equiv a^{-1}\pmod m$, 故所求逆元即为 $a^{\varphi(m)-1}$</p>
<p>时间复杂度:$O(\log m)$</p>
<p>一般来说更推荐用扩欧求逆元, 因为计算 $\varphi(m)$ 相对麻烦一些</p>
</li>
<li><p>筛法</p>
<p>用于求 $[1,n]$ 模 $p$ 逆元的方法</p>
<p>首先, $1$ 的逆元是 $1$</p>
<p>然后考虑 $p$ 对 $i$ 做带余除法 $p=ki+j,j\in[0,i)\cap\mathbb{N}$, 在模 $p$ 意义下即有</p>
<p>$$
\begin{aligned}
ki+j&amp;\equiv0\pmod p\
i^{-1}&amp;\equiv-kj^{-1}\pmod p\
i^{-1}&amp;\equiv-\left(\frac{p}{i}\right)(p\bmod i)^{-1}\pmod p
\end{aligned}
$$</p>
<p>&lt;details open&gt;
&lt;summary&gt;&lt;font color='orange'&gt;Show code&lt;/font&gt;&lt;/summary&gt;</p>
<p>{% include_code lang:cpp nt-1/inverse_n1.cpp %}</p>
<p>&lt;/details&gt;</p>
</li>
<li><p>求任意 $n$ 个数模 $p$ 的逆元</p>
<p>对于任意 $n$ 个数 $a_1,a_2,\dots,a_n$, 我们可以这样求出其逆元</p>
<ol>
<li>令 $s_i=\prod_{j=1}^ia_j$</li>
<li>求出 $s_n$ 的逆元, 记作 $v_n$</li>
<li>注意到
$$
\begin{cases}
v_{i-1}&amp;=v_ia_i\
a_i^{-1}&amp;=v_is_{i-1}
\end{cases},i=1,2,...,n-1
$$
故此时 $a_1,a_2,\dots,a_n$ 的逆元便可求得</li>
</ol>
<p>&lt;details open&gt;
&lt;summary&gt;&lt;font color='orange'&gt;Show code&lt;/font&gt;&lt;/summary&gt;</p>
<p>{% include_code lang:cpp nt-1/inverse_n2.cpp %}</p>
<p>&lt;/details&gt;</p>
<p>时间复杂度:$O(n+\log p)$</p>
</li>
</ol>
<h3>例题</h3>
<ul>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P1593">P1593 因子和</a></li>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P3811">P3811 【模板】乘法逆元</a></li>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P5431">P5431 【模板】乘法逆元 2</a></li>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P7887">P7887 「MCOI-06」Existence of Truth</a> -&gt; {% post_link luogu-p7887 题解 %}</li>
<li>LOJ <a href="https://loj.ac/problem/161">161 乘法逆元 2</a></li>
</ul>
<h2>中国剩余定理</h2>
<p>用于求解一类线性同余方程组的方法</p>
<h3>&lt;a href="#end-t-6.1" id="t-6.1"&gt;定理 - 6.1&lt;/a&gt; (中国剩余定理)</h3>
<p>设 $m_1,m_2,\dots,m_k$ 是两两互素的正整数, 则对任意整数 $b_1,b_2,\dots,b_k$, 方程组</p>
<p>$$
\begin{cases}
x\equiv b_i\pmod{m_i}\
i=1,2,...,k
\end{cases}\tag{6.1-1}
$$</p>
<p>必有解, 且其全部解模 $\prod_{i=1}^k m_i$ 同余</p>
<h4>&lt;a href="#t-6.1" id="p-t-6.1"&gt;证明&lt;/a&gt;</h4>
<p>令 $M=\prod_{i=1}^km_i$</p>
<p>证明是构造性的, 我们首先尝试求解方程组</p>
<p>$$
\begin{cases}
x\equiv1\pmod{m_i}\
x\equiv0\pmod{m_j}~(j\ne i)
\end{cases}
$$</p>
<p>容易发现 $x\mid M_i:=\frac{M}{m_i}$, 令 $x=M_iy$, 则可得到方程</p>
<p>$$
M_iy\equiv1\pmod{m_i}
$$</p>
<p>显然 $y\equiv M_i^{-1}\pmod{m_i}$, 令 $N_i=y$, 则 $x=M_iN_i$</p>
<p>此时我们进行大胆猜想: 最后结果可能是</p>
<p>$$
x\equiv\sum_{i=1}^kb_iM_iN_i\pmod M
$$</p>
<p>容易验证其确实是方程组 $(6.1-1)$ 的解, 令其为 $A$</p>
<p>假设 $x\equiv B\pmod M$ 也是方程组 $(6.1-1)$ 的解, 则有</p>
<p>$$
A-B\equiv0\pmod{m_i},~i=1,2,...,k
$$</p>
<p>这说明方程组 $(6.1-1)$ 的全部解模 $M$ 同余</p>
<p>&lt;a href="#p-t-6.1" id="end-t-6.1"&gt;$\Box$&lt;/a&gt;</p>
<h3>扩展中国剩余定理 (exCRT)</h3>
<p>为什么 CRT 要求其模数必须两两互素?</p>
<p>因为我们在 &lt;a href="#t-6.1"&gt;定理 - 6.1&lt;/a&gt; 证明过程中即可发现, CRT 的关键便是构造这样的方程组</p>
<p>$$
\begin{cases}
x\equiv1\pmod{m_i}\
x\equiv0\pmod{m_j}~(j\ne i)
\end{cases}
$$</p>
<p>此时的 $x=M_iN_i$, $M_i=\prod_{j=1,j\ne i}^km_j$, 而 $N_i$ 是 $M_i$ 关于 $m_i$ 的<strong>逆元</strong></p>
<p>我们知道, 如果一个整数 $a$ 在模 $m$ 意义下有逆元, 其前提之一便是 $(a,m)=1$</p>
<p>在此处便是 $(M_i,m_i)=1$</p>
<p>故由最大公约数的性质, 此处的 $k$ 个模数 $m_1,m_2,\dots,m_k$ 必须两两互素</p>
<p>那么我们能不能摆脱这个限制条件呢?</p>
<p>当然可以!</p>
<p>这就要求我们在构建解的时候绕开 CRT 的证明, 另辟蹊径</p>
<p>我们观察下面的式子</p>
<p>$$
\begin{cases}
x\equiv b_1\pmod{m_1}\
x\equiv b_2\pmod{m_2}
\end{cases}
$$</p>
<p>由同余定义, 我们有</p>
<p>$$
\begin{cases}
m_1\mid x-b_1\
m_2\mid x-b_2
\end{cases}
$$</p>
<p>即存在整数 $k_1,k_2$ 使得</p>
<p>$$
x=m_1k_1+b_1=m_2k_2+b_2
$$</p>
<p>整理一下, 便有</p>
<p>$$
m_1k_1-m_2k_2=b_2-b_1\tag{*}
$$</p>
<p>此时我们便可以通过扩欧去解决 $(*)$ 式的可解性和一组可行解</p>
<p>更重要的是: 此时不需要 $(m_1,m_2)=1$</p>
<p>求出 $k_1,k_2$ 之后便可得到</p>
<p>$$
x\equiv m_1k_1+b_1\equiv m_2k_2+b_2\pmod{[m_1,m_2]}
$$</p>
<p>&lt;details open&gt;
&lt;summary&gt;&lt;font color='orange'&gt;Show code&lt;/font&gt;&lt;/summary&gt;</p>
<p>{% include_code lang:cpp excrt/EXCRT.hpp %}</p>
<p>&lt;/details&gt;</p>
<h3>例题</h3>
<ul>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P3868">P3868 [TJOI2009]猜数字</a></li>
<li>洛谷 <a href="https://www.luogu.com.cn/problem/P4774">P4774 [NOI2018] 屠龙勇士</a></li>
</ul>
<hr/>
<h2>参考</h2>
<ul>
<li>冯克勤, 初等数论及应用, 北京师范大学出版社, 2003.7</li>
<li><a href="https://oi-wiki.org/math/prime/">https://oi-wiki.org/math/prime/</a></li>
<li><a href="https://oi-wiki.org/math/sieve/">https://oi-wiki.org/math/sieve/</a></li>
<li><a href="https://oi-wiki.org/math/inverse">https://oi-wiki.org/math/inverse</a></li>
</ul>
